<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no"/>
  <title>THE PIXEL WAR — Normies RPG</title>
  <link rel="icon" href="https://www.normies.art/favicon.ico"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>

<!-- ════════════════ TITLE ════════════════ -->
<div id="screen-title" class="screen active">
  <div class="title-inner">
    <canvas id="logo-canvas" width="320" height="107"></canvas>
    <p class="tagline">Every dot is a soul. They are coming for ours.</p>
    <div class="title-divider"></div>
    <p class="sub-text">A pixel RPG built on the Normies NFT collection.<br>Connect your wallet or use Demo Mode to begin.</p>
    <div id="wallet-addr" class="wallet-addr"></div>
    <div id="wallet-help" class="wallet-help hidden">
      No Web3 wallet detected. Install
      <a href="https://metamask.io" target="_blank">MetaMask</a> or
      <a href="https://www.coinbase.com/wallet" target="_blank">Coinbase Wallet</a>, then refresh.
    </div>
    <div class="btn-row">
      <button id="btn-connect" class="btn-primary">Connect Wallet</button>
      <button id="btn-demo" class="btn-ghost">Demo Mode</button>
    </div>
    <p class="fine-print">Read-only · No signing required</p>
    <span id="demo-pill" class="demo-pill">DEMO</span>
  </div>
</div>

<!-- ════════════════ INTRO ════════════════ -->
<div id="screen-intro" class="screen">
  <div class="intro-inner">
    <div class="intro-chapter">CHAPTER I — THE PIXEL WAR</div>
    <div id="intro-text" class="intro-text"></div>
    <div id="intro-page" class="intro-page"></div>
    <div class="intro-btns">
      <button id="btn-intro-next" class="btn-primary">Continue →</button>
      <button id="btn-intro-skip" class="btn-ghost">Skip</button>
    </div>
  </div>
</div>

<!-- ════════════════ PARTY SELECT ════════════════ -->
<div id="screen-party" class="screen">
  <div class="party-layout">

    <!-- Sticky top: header + party slots -->
    <div class="party-top">
      <div class="party-header-row">
        <div class="party-title-block">
          <div class="party-title">Select Your Party</div>
          <div class="party-subtitle">Choose up to 5 Normies · Tap a card to add · Tap slot to remove</div>
        </div>
        <div class="party-actions">
          <span id="party-count">0 / 5</span>
          <button id="btn-back-title" class="btn-back">← Back</button>
          <button id="btn-start" class="btn-primary" disabled>Enter World →</button>
        </div>
      </div>

      <div class="slots-section">
        <div class="slots-label">Your Party</div>
        <div id="party-slots" class="party-slots"></div>
      </div>
    </div>

    <!-- Scrollable grid -->
    <div class="party-bottom">
      <div class="grid-header-row">
        <span class="grid-title">Your Collection <span id="col-count"></span></span>
      </div>
      <div id="normie-grid" class="normie-grid">
        <div class="grid-loading">Loading Normies…</div>
      </div>
    </div>

  </div>
</div>

<!-- ════════════════ GAME ════════════════ -->
<div id="screen-game" class="screen">
  <canvas id="world-canvas"></canvas>

  <!-- Zone bar -->
  <div id="zone-bar">
    <span id="zone-name">—</span>
    <span class="zone-hint">WASD · E Interact · I Menu</span>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div id="hud-lead">
      <div class="hud-name" id="hud-lead-name">—</div>
      <div class="hud-type" id="hud-lead-type"></div>
      <div class="hud-bars">
        <div class="bar-track"><div id="hud-hp-bar" class="bar-hp" style="width:100%"></div></div>
        <div class="bar-track"><div id="hud-mp-bar" class="bar-mp" style="width:100%"></div></div>
      </div>
      <div class="hud-val" id="hud-hp-val"></div>
    </div>
    <div id="hud-right">
      <span class="hud-gold" id="hud-gold">0</span>
      <span class="hud-pot" id="hud-pot">×3</span>
      <button class="hud-btn" id="btn-open-menu" title="Menu (I)">☰</button>
    </div>
  </div>

  <!-- Mobile d-pad -->
  <div id="mobile-dpad" style="position:absolute;bottom:70px;left:12px;z-index:15;display:none">
    <style>
      #mobile-dpad button{
        position:absolute;width:40px;height:40px;
        background:rgba(72,73,75,.7);color:#e3e5e4;
        border:1px solid rgba(227,229,228,.3);font-size:14px;
        padding:0;display:flex;align-items:center;justify-content:center;
        font-family:monospace;cursor:pointer;
      }
      #btn-dp-up   {top:0;left:40px}
      #btn-dp-left {top:40px;left:0}
      #btn-dp-act  {top:40px;left:40px;font-size:10px;letter-spacing:0}
      #btn-dp-right{top:40px;left:80px}
      #btn-dp-down {top:80px;left:40px}
    </style>
    <div style="position:relative;width:120px;height:120px">
      <button id="btn-dp-up">▲</button>
      <button id="btn-dp-left">◀</button>
      <button id="btn-dp-act">E</button>
      <button id="btn-dp-right">▶</button>
      <button id="btn-dp-down">▼</button>
    </div>
  </div>

  <!-- Dialogue box -->
  <div id="dialogue" class="dialogue hidden">
    <div class="dlg-inner">
      <div id="dlg-portrait" class="dlg-portrait" style="display:none"></div>
      <div class="dlg-text-area">
        <div id="dlg-speaker" class="dlg-speaker"></div>
        <div id="dlg-text" class="dlg-text"></div>
        <div class="dlg-footer">
          <span id="dlg-page" class="dlg-page"></span>
          <span class="dlg-prompt">▶ continue</span>
        </div>
      </div>
    </div>
  </div>

  <!-- BATTLE overlay -->
  <div id="battle" class="overlay hidden">
    <div class="battle-wrap">

      <!-- Result screen -->
      <div id="bat-result" class="bat-result hidden">
        <div id="bat-result-title" class="result-title"></div>
        <div id="bat-result-sub"   class="result-sub"></div>
        <div id="bat-result-gold"  class="result-gold"></div>
        <div class="result-btns">
          <button id="btn-bat-world" class="btn-primary">Return to World</button>
          <button id="btn-bat-party" class="btn-ghost">Change Party</button>
        </div>
      </div>

      <!-- Main battle UI -->
      <div id="bat-main">
        <div class="bat-header">
          <div>
            <div id="bat-zone" class="bat-zone"></div>
            <div class="bat-title">ENCOUNTER</div>
          </div>
          <div id="bat-round" class="bat-round">Round 1</div>
        </div>

        <div class="arena" id="arena">
          <div id="bat-party" class="bat-party"></div>
          <div class="arena-vs">VS</div>
          <div class="bat-enemy-wrap">
            <canvas id="enemy-canvas" width="72" height="72"></canvas>
            <div id="enemy-name"    class="enemy-name"></div>
            <div id="enemy-hp-text" class="enemy-hp-text"></div>
            <div class="enemy-bar-track"><div id="enemy-hp-bar" class="enemy-hp-bar" style="width:100%"></div></div>
          </div>
        </div>

        <div id="enemy-lore-text" class="enemy-lore"></div>
        <div id="bat-log" class="bat-log"></div>

        <div class="bat-actions">
          <div id="bat-action-label" class="bat-action-label">Choose an action…</div>
          <div class="bat-btns">
            <button id="btn-atk"   class="bat-btn">Attack<small></small></button>
            <button id="btn-skill" class="bat-btn ghost">Skill<small></small></button>
            <button id="btn-ult"   class="bat-btn ghost">Ultimate<small></small></button>
            <button id="btn-bpot"  class="bat-btn ghost">Potion<small></small></button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- MENU overlay -->
  <div id="menu-overlay" class="overlay hidden">
    <div class="menu-wrap">
      <div class="menu-header">
        <div class="menu-tabs">
          <button class="menu-tab active" data-tab="inventory">Items</button>
          <button class="menu-tab" data-tab="quests">Quests</button>
          <button class="menu-tab" data-tab="party">Party</button>
          <button class="menu-tab" data-tab="journal">Journal</button>
        </div>
        <button id="btn-close-menu" class="btn-back">✕ Close</button>
      </div>
      <div class="menu-gold-bar" id="menu-gold">0</div>
      <div class="menu-content">
        <div id="menu-inv"     class="menu-tab-content" style="display:block"></div>
        <div id="menu-quests"  class="menu-tab-content"></div>
        <div id="menu-party"   class="menu-tab-content"></div>
        <div id="menu-journal" class="menu-tab-content"></div>
      </div>
    </div>
  </div>

  <!-- SHOP overlay -->
  <div id="shop" class="overlay hidden">
    <div class="shop-wrap">
      <div class="shop-header">
        <div class="shop-title">PIXEL SHOP</div>
        <div style="display:flex;gap:12px;align-items:center">
          <span class="shop-gold" id="shop-gold">0</span>
          <button id="btn-close-shop" class="btn-back">✕ Close</button>
        </div>
      </div>
      <div id="shop-items" class="shop-items"></div>
    </div>
  </div>

</div><!-- end #screen-game -->

<!-- ════════════════ ENDING ════════════════ -->
<div id="screen-ending" class="screen">
  <div class="ending-inner">
    <div class="ending-chapter">EPILOGUE</div>
    <h2 class="ending-title">THE GRID IS SAVED.</h2>
    <p class="ending-text">
      NULLBYTE has fallen. The pixels he consumed pour back into the world —
      millions of tiny squares of light, each one a restored soul.<br><br>
      Normie <span id="ending-normie-id">#0001</span> stands at the center
      of the relit Grid, the Render Flame still warm in hand.<br><br>
      Not all battles are over. The edges of the chain are still dark.
      But today, the first pixel was relit. And that changes everything.
    </p>
    <div class="ending-stats">
      <div>Battles Won: <strong><span id="ending-battles">0</span></strong></div>
      <div>Gold Earned: <strong><span id="ending-gold">0</span></strong></div>
    </div>
    <button id="btn-ending-play-again" class="btn-primary">Play Again</button>
  </div>
</div>

<script type="module" src="./game.js"></script>

<!-- Mobile dpad visibility -->
<script>
  if ('ontouchstart' in window) {
    document.getElementById('mobile-dpad').style.display = 'block';
  }
</script>

</body>
</html>
