(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const Lt="https://api.normies.art",_e={};async function Ut(e){if(_e[`meta_${e}`])return _e[`meta_${e}`];const i=await(await fetch(`${Lt}/normie/${e}/metadata`)).json();return _e[`meta_${e}`]=i,i}async function Kt(e){if(_e[`px_${e}`])return _e[`px_${e}`];const i=await(await fetch(`${Lt}/normie/${e}/pixels`)).json();return _e[`px_${e}`]=i,i}function mt(e,o,i=1){const t=e.attributes||[],n=Ve=>{var Me;return((Me=t.find(Re=>Re.trait_type===Ve))==null?void 0:Me.value)||""},s=n("Type")||"Human",l=n("Expression")||"Neutral",c=n("Accessory")||"No Accessories",g=n("Background")||"",h=o?(o.match(/1/g)||[]).length:800,E={Human:{hp:0,mp:0,def:0,spd:0,atk:0},Cat:{hp:-5,mp:5,def:-1,spd:3,atk:2},Alien:{hp:0,mp:8,def:1,spd:-1,atk:1},Agent:{hp:5,mp:3,def:3,spd:1,atk:3}},_={"Top Hat":{mp:3},Fedora:{spd:1},"Cowboy Hat":{def:1},Beanie:{def:1},Cap:{spd:1},"Cap Forward":{spd:2},Hoodie:{def:3},"Gold Chain":{mp:4},"Silver Chain":{mp:2},"Bow Tie":{mp:1},Headband:{spd:2},Bandana:{def:2,spd:1},"Eye Patch":{def:3},"VR Headset":{mp:6},Headphones:{mp:2}},I={Confident:.14,Serious:.1,"Slight Smile":.07,Friendly:.06,Neutral:.04,Content:.04,Peaceful:.03},B={Gold:{goldMult:.2},Red:{atkMult:.1},Blue:{mpBonus:2},Purple:{critBonus:.03},Green:{hpMult:.05}},O=E[s]||E.Human,$=_[c]||{},C=B[g]||{},H=1+(i-1)*.12,q=Math.round((80+(O.hp||0)+Math.floor(h/10))*H),oe=12+(O.mp||0)+($.mp||0)+(i-1)*2+(C.mpBonus||0),ee=Math.floor((Math.floor(h/80)+(O.def||0)+i)*H),L=5+(O.spd||0)+($.spd||0)+i,F=(I[l]||.04)+(C.critBonus||0),ne=Math.round((10+(O.atk||0)+i*5)*H),We=Math.round((16+(O.atk||0)+i*7)*H),Le=Math.round((28+(O.atk||0)+i*12)*H),Ae={Human:["Render Strike","Pixel Burst","Render Nova"],Cat:["Claw Swipe","Void Scratch","Phase Pounce"],Alien:["Null Beam","Grid Override","Grid Collapse"],Agent:["Protocol Breach","System Crash","System Crash"]},[$e,U,Fe]=Ae[s]||Ae.Human,Ge=1+(C.goldMult||0);return{maxHp:q,hp:q,maxMp:oe,mp:oe,def:ee,spd:L,crit:F,atkBasic:ne,atkSkill:We,atkUltimate:Le,sk1:$e,sk2:U,sk3:Fe,type:s,expression:l,accessory:c,background:g,px:h,goldMult:Ge}}async function At(e){try{const[o,i]=await Promise.all([Ut(e),Kt(e)]),t=(i==null?void 0:i.pixels)||(i==null?void 0:i.data)||i||"",n=mt(o,t),s=o.name||`Normie #${e}`;return{id:e,name:s,pixels:t,alive:!0,lv:1,xp:0,xpToNext:100,skillPoints:0,unlockedSkills:{},equippedItems:{},...n}}catch(o){return console.warn(`fetchNormieFull(${e}) failed:`,o),Mt(e)}}function Mt(e){const o=["Human","Cat","Alien","Agent"],i=["Neutral","Confident","Serious","Friendly","Peaceful"],t=["No Accessories","Gold Chain","Hoodie","Bandana","VR Headset"],n=o[e%4],s=i[e%5],l=t[e%5],c=jt(e),h=mt({attributes:[{trait_type:"Type",value:n},{trait_type:"Expression",value:s},{trait_type:"Accessory",value:l}]},c);return{id:e,name:`Normie #${e}`,pixels:c,alive:!0,lv:1,xp:0,xpToNext:100,skillPoints:0,unlockedSkills:{},equippedItems:{},...h}}function jt(e){let o="";const i=e*7+3;function t(n){let s=(i+n)*1664525+1013904223;return s&=2147483647,s/2147483647}for(let n=0;n<40;n++)for(let s=0;s<40;s++){const l=n*40+s,c=20,g=18,h=14;if(!((s-c)**2+(n-g)**2<=h*h)){o+="0";continue}const _=s>11&&s<16&&n>14&&n<18||s>24&&s<29&&n>14&&n<18,I=n>23&&n<26&&s>13&&s<27;(s-c)**2+(n-g)**2>=(h-1)**2||_||I?o+="1":o+=t(l)<.18?"1":"0"}return o}function Zt(e){return Math.round(100*Math.pow(e,1.6))}function Qt(e,o){e.xp=(e.xp||0)+o;const i=[];for(;e.xp>=(e.xpToNext||100);){e.xp-=e.xpToNext,e.lv=(e.lv||1)+1,e.xpToNext=Zt(e.lv),e.skillPoints=(e.skillPoints||0)+1;const t={name:e.name,attributes:[{trait_type:"Type",value:e.type},{trait_type:"Expression",value:e.expression},{trait_type:"Accessory",value:e.accessory}]},n=mt(t,e.pixels,e.lv),s=n.maxHp-e.maxHp;Object.assign(e,n),e.hp=Math.min(e.hp+s,e.maxHp),e.mp=Math.min(e.mp+3,e.maxMp),i.push(`${e.name} reached Lv.${e.lv}! +1 Skill Point`)}return i}const Jt="0x9Eb6E2025B64f340691e424b7fe7022fFDE12438",zt=["function balanceOf(address owner) view returns (uint256)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)"];function rt(){var o;const e=[];return window.ethereum&&(window.ethereum.isMetaMask?e.push({id:"metamask",name:"MetaMask",provider:window.ethereum}):window.ethereum.isCoinbaseWallet?e.push({id:"coinbase",name:"Coinbase Wallet",provider:window.ethereum}):window.ethereum.isRabby?e.push({id:"rabby",name:"Rabby",provider:window.ethereum}):window.ethereum.isBraveWallet?e.push({id:"brave",name:"Brave Wallet",provider:window.ethereum}):e.push({id:"injected",name:"Browser Wallet",provider:window.ethereum})),(o=window.ethereum)!=null&&o.providers&&window.ethereum.providers.forEach(i=>{i.isMetaMask&&!e.find(t=>t.id==="metamask")&&e.push({id:"metamask",name:"MetaMask",provider:i}),i.isCoinbaseWallet&&!e.find(t=>t.id==="coinbase")&&e.push({id:"coinbase",name:"Coinbase Wallet",provider:i})}),e}async function xt(e=null){const o=rt();let i;if(o.length===0)throw new Error("NO_WALLET");const t=e?o.find(c=>c.id===e):o[0];i=(t||o[0]).provider,await i.request({method:"eth_requestAccounts"});const n=new ethers.BrowserProvider(i),l=await(await n.getSigner()).getAddress();return{provider:n,address:l,walletName:(t||o[0]).name}}async function eo(e,o,i){const t=new ethers.Contract(Jt,zt,o),n=Number(await t.balanceOf(e));if(n===0)return[];const s=[];for(let c=0;c<Math.min(n,30);c++)s.push(Number(await t.tokenOfOwnerByIndex(e,c)));const l=[];for(const c of s){const g=await At(c);l.push(g),i&&i([...l]),await Rt(350)}return l}const to=[1,7,42,100,256,420,888,1e3,1337,2e3,3e3,3333,4e3,5e3,6e3,7e3,8e3,9e3,9500,9999];async function oo(e){const o=[];for(const i of to){let t;try{t=await At(i)}catch{t=Mt(i)}o.push(t),e&&e([...o]),await Rt(150)}return o}const Rt=e=>new Promise(o=>setTimeout(o,e)),no=16,N="#0e0e0f",w="#383838",b="#707070",T="#aaaaaa",R="#e4e4e0";function Bt(){const e=document.createElement("canvas");return e.width=16,e.height=16,e}function S(e,o,i,t){o<0||i<0||o>=16||i>=16||(e.fillStyle=t,e.fillRect(o,i,1,1))}function y(e,o,i,t,n,s){e.fillStyle=s,e.fillRect(o,i,t,n)}function V(e,o){y(e,0,0,16,16,o)}function ut(e,o,i){y(e,0,o,16,1,i)}function st(e,o,i){y(e,o,0,1,16,i)}function j(e,o,i,t,n,s,l,c){const g=[[0,.5],[.75,.25]];for(let h=0;h<n;h++)for(let E=0;E<t;E++)S(e,o+E,i+h,c>g[h%2][E%2]?l:s)}function ao(e,o,i,t,n,s,l){for(let c=0;c<n;c++)j(e,o,i+c,t,1,s,l,c/Math.max(1,n-1))}function le(e,o,i,t,n){let s=n*2654435761+1>>>0;for(let l=0;l<16;l++)for(let c=0;c<16;c++)s=(s^c*1234567+l*7654321+99999)>>>0,s=s*2246822519>>>0,s/4294967295<t?S(e,c,l,i):S(e,c,l,o)}function io(e){V(e,b),le(e,b,w,.18,0),[[2,1,T],[5,3,R],[9,1,T],[12,4,R],[1,8,T],[6,7,R],[10,9,T],[14,2,R],[3,12,T],[8,11,R],[13,13,T],[4,14,R],[11,14,T],[0,5,R],[15,10,T]].forEach(([i,t,n])=>S(e,i,t,n)),j(e,0,14,16,2,b,w,.5)}function ro(e){V(e,b),le(e,b,w,.12,1),S(e,5,4,T),S(e,6,3,R),S(e,7,4,T),S(e,8,3,T),S(e,6,5,T),S(e,6,4,R),S(e,6,6,w),S(e,6,7,w),S(e,11,2,R),S(e,12,1,R),S(e,13,9,T),S(e,2,11,T),S(e,1,3,R),S(e,14,12,T),j(e,0,14,16,2,b,w,.5)}function so(e){V(e,b),le(e,b,w,.1,2),y(e,9,8,3,2,b),j(e,9,8,3,1,b,T,.7),S(e,8,9,w),S(e,12,8,w),S(e,10,7,w),S(e,9,10,w),S(e,11,10,w),S(e,2,3,R),S(e,3,2,R),S(e,13,12,T),S(e,14,11,T),S(e,0,6,R),S(e,15,4,T),j(e,0,14,16,2,b,w,.5)}function lo(e){V(e,w),le(e,w,N,.2,3),[[2,1,b],[7,3,w],[3,8,b],[10,5,w],[13,11,b],[5,13,w],[1,14,b],[9,2,b],[15,7,w],[6,15,b]].forEach(([o,i,t])=>S(e,o,i,t)),j(e,0,12,16,4,w,N,.6)}function co(e){V(e,T),le(e,T,b,.12,4),[[1,1,4,3],[7,1,4,3],[12,1,3,3],[0,5,4,3],[5,5,5,3],[11,5,4,3],[1,9,4,3],[6,9,5,3],[12,9,3,3],[0,13,4,2],[5,13,5,2],[11,13,4,2]].forEach(([i,t,n,s])=>{y(e,i+1,t+1,n-1,s-1,b),S(e,i+1,t+1,T),y(e,i+1,t+s-1,n-1,1,w),y(e,i+n-1,t+1,1,s-1,w)})}function fo(e){V(e,b),y(e,6,10,4,6,w),j(e,6,10,2,6,w,N,.4),S(e,6,10,N),S(e,9,10,N),y(e,7,11,2,5,b),y(e,2,6,12,6,w),y(e,3,4,10,4,w),y(e,4,2,8,4,b),y(e,5,1,6,2,T),j(e,5,1,6,3,T,R,.5),j(e,2,10,12,2,w,N,.6),S(e,4,5,T),S(e,6,3,R),S(e,9,4,T),S(e,11,6,b),S(e,5,7,b),S(e,12,5,w),S(e,3,8,w)}function mo(e){V(e,b);for(let o=0;o<16;o+=4){const i=o/4%2===0?0:4;y(e,0,o+3,16,1,w);for(let t=i-4;t<16;t+=8)y(e,t+1,o,6,3,T),S(e,t+1,o,b),y(e,t+1,o+2,6,1,b),y(e,t+7,o,1,3,w)}}function uo(e){V(e,w);for(let o=0;o<16;o+=4)for(let i=0;i<16;i+=4)y(e,i,o,4,4,b),S(e,i,o,T),S(e,i+1,o,T),S(e,i,o+1,T),y(e,i,o+3,4,1,w),y(e,i+3,o,1,4,w);y(e,0,0,16,2,T),S(e,0,0,R),S(e,1,0,R),ut(e,1,b)}function ho(e){V(e,T),le(e,T,b,.08,5),[[0,0,5,4],[6,0,5,4],[12,0,4,4],[0,5,4,4],[5,5,6,4],[12,5,4,4],[0,10,6,5],[7,10,4,5],[12,10,4,5]].forEach(([i,t,n,s])=>{y(e,i+1,t+1,n-1,s-1,b),S(e,i+1,t+1,R),y(e,i+1,t+s-1,n-1,1,w),y(e,i+n-1,t+1,1,s-1,w)})}function po(e){V(e,b),y(e,7,8,2,8,w),S(e,7,8,b),y(e,2,2,12,7,w),y(e,3,2,10,6,T),S(e,3,2,R),y(e,3,7,10,1,w),y(e,13,2,1,7,w),y(e,5,4,6,1,b),y(e,5,6,6,1,b)}function go(e){V(e,T);for(let o=0;o<16;o+=4){y(e,0,o,16,3,b),S(e,0,o,T),y(e,1,o,15,1,T),y(e,0,o+3,16,1,w);for(let i=0;i<16;i+=5)S(e,i,o+1,w)}}function yo(e){V(e,w);for(let o=0;o<16;o+=4)for(let i=o/4%2===0?0:2;i<16;i+=4)S(e,i,o,b),S(e,i+1,o,b),S(e,i,o+1,b);ut(e,0,b),st(e,0,b)}function vo(e){y(e,1,1,14,4,w),y(e,1,1,14,1,b),y(e,1,1,1,4,b),y(e,2,2,12,2,b),S(e,2,2,T),y(e,3,2,11,1,T),y(e,1,5,14,9,b),y(e,1,5,14,1,T),y(e,1,5,1,9,T),y(e,14,5,1,9,w),y(e,1,13,14,1,w),y(e,3,6,6,4,R),y(e,3,6,6,1,R),y(e,3,6,1,4,R),j(e,3,9,6,1,R,T,.5),y(e,10,6,4,3,T),j(e,1,10,14,3,b,T,.4)}function bo(e){y(e,0,0,16,16,w),y(e,0,0,16,1,b),y(e,0,0,1,16,b),y(e,15,0,1,16,N),y(e,0,15,16,1,N),y(e,1,5,14,1,b),y(e,1,10,14,1,b),[[1,3,R],[2,4,T],[4,4,b],[6,3,R],[8,4,T],[10,3,b],[12,4,R],[14,3,T]].forEach(([n,s,l])=>y(e,n,1,s,4,l));for(let n=1;n<15;n+=2)y(e,n,1,1,4,w);[[1,2,T],[3,3,b],[6,2,R],[8,3,T],[11,2,b],[13,2,R]].forEach(([n,s,l])=>y(e,n,6,s,4,l));for(let n=1;n<15;n+=2)y(e,n,6,1,4,w);[[1,4,b],[5,3,T],[8,4,R],[12,3,b]].forEach(([n,s,l])=>y(e,n,11,s,3,l));for(let n=1;n<15;n+=3)y(e,n,11,1,3,w)}function wo(e){y(e,1,0,14,16,w),y(e,1,0,1,16,b),y(e,1,0,14,1,b),y(e,2,1,12,14,b),y(e,2,1,12,1,T),y(e,2,1,1,14,T),y(e,3,3,5,4,w),y(e,3,3,5,1,b),y(e,3,3,1,4,b),y(e,9,3,5,4,w),y(e,9,3,5,1,b),y(e,9,3,1,4,b),y(e,3,9,5,4,w),y(e,3,9,5,1,b),y(e,3,9,1,4,b),y(e,9,9,5,4,w),y(e,9,9,5,1,b),y(e,9,9,1,4,b),y(e,12,7,2,2,T),S(e,12,7,R),S(e,13,8,b)}function Eo(e){V(e,w),[[0,12,16,4],[2,8,14,4],[4,4,12,4],[6,0,10,4]].forEach(([i,t,n,s],l)=>{y(e,i,t,n,s,b),y(e,i,t,n,1,T),y(e,i,t,1,s,T),y(e,i+n-1,t,1,s,w),y(e,i,t+s-1,n,1,w),S(e,i,t,R)}),j(e,0,12,16,4,w,N,.4)}function qe(e,o){V(e,w),ao(e,0,0,16,16,w,N);const i=o*3;for(let n=0;n<16;n+=4){const s=(n+i)%16;for(let l=0;l<16;l++){const c=Math.sin((l+i*2)/3)*1.5,g=Math.round(s+c);g>=0&&g<16&&S(e,l,g%16,n===0?T:b)}}[[3,2,R],[8,6,T],[13,1,R],[1,10,T],[11,14,R],[6,12,T]].forEach(([n,s,l])=>{(n+o*2)%4<2&&S(e,n,s,l)}),y(e,0,0,16,1,b),j(e,0,0,16,1,b,T,.4)}function So(e){V(e,w),le(e,w,N,.15,6),[[2,3,4,1,N],[8,1,3,1,N],[1,7,2,1,N],[10,9,4,1,N],[5,12,3,1,N],[12,14,3,1,N]].forEach(([o,i,t,n,s])=>y(e,o,i,t,n,s)),[[4,6,b],[9,4,b],[7,10,b],[13,8,w],[2,14,b]].forEach(([o,i,t])=>{S(e,o,i,t),S(e,o+1,i,t),S(e,o,i+1,t)}),S(e,4,6,T),S(e,9,4,T),S(e,7,10,T),j(e,0,14,16,2,w,N,.5)}function _o(e){V(e,N),le(e,N,w,.2,7),y(e,0,0,6,5,w),y(e,0,0,6,1,b),y(e,0,0,1,5,b),y(e,7,0,5,4,w),y(e,7,0,5,1,b),y(e,13,0,3,6,w),y(e,13,0,3,1,b),y(e,0,6,4,5,w),y(e,0,6,1,5,b),y(e,5,5,6,5,w),y(e,5,5,6,1,b),y(e,5,5,1,5,b),y(e,12,7,4,4,w),y(e,12,7,4,1,b),y(e,0,12,7,4,w),y(e,0,12,1,4,b),y(e,0,12,7,1,b),y(e,8,12,8,4,w),y(e,8,12,8,1,b),S(e,3,4,N),S(e,3,5,w),S(e,10,5,N),S(e,10,6,w)}function Ye(e,o){V(e,N),le(e,N,w,.2+Math.sin(o)*.05,8+o),[[3,2],[7,5],[11,1],[1,9],[14,7],[5,13],[9,11],[13,14],[2,6],[8,15]].forEach(([t,n],s)=>{(t*3+n*7+o*4)%8<3&&(S(e,t,n,b),S(e,t,(n+1)%16,w))}),o%3===0&&(S(e,5,5,b),S(e,10,10,b)),o%3===1&&(S(e,11,3,T),S(e,4,12,T)),j(e,0,0,16,4,N,w,.3)}function ko(e){V(e,w),le(e,w,b,.06,9),y(e,0,14,16,2,N),y(e,0,14,16,1,w),st(e,0,b),st(e,15,N),ut(e,0,b)}function To(e){V(e,b);for(let o=0;o<16;o+=4){y(e,0,o,16,3,T),y(e,1,o,15,1,R),y(e,0,o+3,16,1,w);const i=o*3%12+2;S(e,i,o+1,b),S(e,i+1,o+2,b),y(e,o*4%16,o,1,3,b)}}function G(e){const o=Bt(),i=o.getContext("2d");return i.imageSmoothingEnabled=!1,e(i),o.toDataURL()}function fe(e,o=4){return Array.from({length:o},(i,t)=>{const n=Bt(),s=n.getContext("2d");return s.imageSmoothingEnabled=!1,e(s,t),n.toDataURL()})}const gt={bed_floor:G(go),bed_wall:G(yo),stairs_dn:G(Eo),bed:G(vo),bookshelf:G(bo),door:G(wo),grass0:G(io),grass1:G(ro),grass2:G(so),dark_grass:G(lo),path:G(co),tree:G(fo),house_wall:G(mo),roof:G(uo),town_floor:G(ho),sign:G(po),water0:fe(qe)[0],water1:fe(qe)[1],water2:fe(qe)[2],water3:fe(qe)[3],cave_floor:G(So),cave_wall:G(_o),void0:fe(Ye)[0],void1:fe(Ye)[1],void2:fe(Ye)[2],void3:fe(Ye)[3],wall:G(ko),inn_floor:G(To)},d={BED_FLOOR:0,BED_WALL:1,STAIRS_DN:2,BED:3,BOOKSHELF:4,DOOR:5,GRASS0:6,GRASS1:7,GRASS2:8,DARK_GRASS:9,PATH:10,TREE:11,HOUSE_WALL:12,ROOF:13,TOWN_FLOOR:14,SIGN:15,WATER:16,CAVE_FLOOR:17,CAVE_WALL:18,VOID:19,WALL:20,INN_FLOOR:21},Io=["bed_floor","bed_wall","stairs_dn","bed","bookshelf","door","grass0","grass1","grass2","dark_grass","path","tree","house_wall","roof","town_floor","sign","water0","cave_floor","cave_wall","void0","wall","inn_floor"],Ke={};function Co(e,o){const i=new Image;i.onload=()=>{Ke[e]=i},i.src=o}Object.keys(gt).forEach(e=>{Co(e,gt[e])});let lt=0,dt=0,nt=0,at=0;function Lo(e){nt+=e,at+=e,nt>200&&(lt=(lt+1)%4,nt=0),at>180&&(dt=(dt+1)%4,at=0)}function Ao(e){if(e===d.WATER)return Ke[`water${lt}`]||null;if(e===d.VOID)return Ke[`void${dt}`]||null;const o=Io[e];return o&&Ke[o]||null}const Mo={intro:[`The year is Block 9,847,221.
You are a Normie — a 40×40 pixel being rendered on The Ledger, the eternal blockchain. Every Normie is unique. Every pixel matters.`,`The Grid is the world you know.
Mountains, towns, rivers — all made of pixels, all recorded on The Ledger forever. You cannot be deleted. You cannot be copied. You simply exist.`,`Then came The Void.
Nobody knows where it started. A corrupted transaction. A bad block. A zero where there should have been a one. It spread through the chain like static across a dying screen.`,`NULLBYTE leads the Void.
He was once Pixel Zero — the very first bit rendered when The Grid began. He fell to corruption before the Grid could even wake. Now he consumes everything, converting living pixels into raw power.`,`The Grid is dying.
Entire maps have gone dark. Towns erased. Normies consumed, their pixels drained. The Ledger still records them, but they no longer move. They are memory now, not life.`,`You wake up in your bedroom.
Something inside you vibrates — a frequency you've never felt. Downstairs, your mother is calling. She sounds frightened.

The Pixel War has come to Render Street.
And you are the only one with the Render Mark.`]},Ro={Human:{icon:"◈",branches:[{id:"render_force",name:"Render Force",icon:"⬛",desc:"Raw pixel power — direct combat mastery",skills:[{id:"power_strike",name:"Power Strike",cost:1,desc:"+20% Attack damage permanently.",effect:{atkMult:.2}},{id:"pixel_surge",name:"Pixel Surge",cost:2,desc:"Skill attacks deal +35% damage and cost 1 less MP.",effect:{skillMult:.35,mpDiscount:1}},{id:"render_nova",name:"Render Nova",cost:3,desc:"Ultimate hits all enemies (multi-battle wave). +50% Ult damage.",effect:{ultMult:.5,ultAoe:!0}}]},{id:"grid_resilience",name:"Grid Resilience",icon:"◫",desc:"Defensive coding — survival and endurance",skills:[{id:"bit_armor",name:"Bit Armor",cost:1,desc:"+15% max HP. Start each battle with a 20HP shield.",effect:{hpMult:.15,shield:20}},{id:"render_heal",name:"Render Heal",cost:2,desc:"Potions heal 25% more. Restore 5% HP every 3 steps.",effect:{potionBonus:.25,regenSteps:3}},{id:"last_pixel",name:"Last Pixel",cost:3,desc:"Once per battle: survive a killing blow at 1HP.",effect:{deathDefiance:!0}}]},{id:"chain_protocol",name:"Chain Protocol",icon:"◉",desc:"Support and utility — the backbone of the party",skills:[{id:"party_link",name:"Party Link",cost:1,desc:"All party members gain +5% of this Normie's DEF stat.",effect:{partyDefShare:.05}},{id:"render_aura",name:"Render Aura",cost:2,desc:"After each battle: restore 8% HP to all living party members.",effect:{postBattleHeal:.08}},{id:"full_rerender",name:"Full Rerender",cost:3,desc:"Once per map: revive one fallen party member at 50% HP.",effect:{mapRevive:!0}}]}]},Cat:{icon:"◇",branches:[{id:"void_claw",name:"Void Claw",icon:"◈",desc:"Precise strikes — critical hit mastery",skills:[{id:"sharp_pixel",name:"Sharp Pixel",cost:1,desc:"+10% crit chance. Crits deal 2.5× instead of 2×.",effect:{critChance:.1,critMult:.5}},{id:"ambush",name:"Ambush",cost:2,desc:"First action each battle always crits.",effect:{firstHitCrit:!0}},{id:"nine_lives",name:"Nine Lives",cost:3,desc:"Survive lethal hits up to 3 times per full rest.",effect:{nineLives:3}}]},{id:"shadow_step",name:"Shadow Step",icon:"◫",desc:"Speed and evasion — untouchable in the Grid",skills:[{id:"quick_paws",name:"Quick Paws",cost:1,desc:"+3 SPD. Always acts before enemies of equal speed.",effect:{spdBonus:3,spdTiebreak:!0}},{id:"dodge_static",name:"Dodge Static",cost:2,desc:"15% chance to evade any enemy attack.",effect:{evasion:.15}},{id:"phase_pounce",name:"Phase Pounce",cost:3,desc:"Flee always succeeds. When fleeing, deal 50% ATK to enemy first.",effect:{fleeGuaranteed:!0,fleeAttack:.5}}]},{id:"purr_protocol",name:"Purr Protocol",icon:"◎",desc:"MP mastery — skill-spamming specialist",skills:[{id:"mp_efficiency",name:"MP Efficiency",cost:1,desc:"All skills cost 1 less MP (minimum 1).",effect:{mpDiscount:1}},{id:"mana_claw",name:"Mana Claw",cost:2,desc:"Basic attacks restore 1 MP on hit.",effect:{mpRegen:1}},{id:"void_purr",name:"Void Purr",cost:3,desc:"At turn start: gain +3 MP. Skills deal bonus damage = 2× MP spent.",effect:{turnMpRegen:3,mpDamageBonus:2}}]}]},Alien:{icon:"◌",branches:[{id:"null_beam",name:"Null Beam",icon:"◈",desc:"Elemental power — void-energy manipulation",skills:[{id:"void_affinity",name:"Void Affinity",cost:1,desc:"Take 15% less damage from Void-type enemies.",effect:{voidResist:.15}},{id:"beam_amplify",name:"Beam Amplify",cost:2,desc:"Skills deal +40% damage to Void-type enemies.",effect:{voidBonus:.4}},{id:"grid_collapse",name:"Grid Collapse",cost:3,desc:"Ultimate: reduce enemy DEF to 0 for 3 turns. Piercing damage.",effect:{ultDefStrip:!0}}]},{id:"psi_render",name:"Psi Render",icon:"◬",desc:"Mental superiority — high MP output",skills:[{id:"alien_mind",name:"Alien Mind",cost:1,desc:"+5 max MP. Regenerate 2 MP per round automatically.",effect:{mpBonus:5,mpPerRound:2}},{id:"override",name:"Override",cost:2,desc:"25% chance each turn: enemy skips their next action.",effect:{stunChance:.25}},{id:"grid_override",name:"Grid Override",cost:3,desc:"Once per battle: copy enemy's last move and use it against them.",effect:{copyAbility:!0}}]},{id:"xenoform",name:"Xenoform",icon:"◔",desc:"Adaptability — changes based on enemies faced",skills:[{id:"pixel_scan",name:"Pixel Scan",cost:1,desc:"Battle start: reveal enemy weaknesses in the log.",effect:{enemyScan:!0}},{id:"adapt",name:"Adapt",cost:2,desc:"After taking a hit: gain +10% resistance to that damage type.",effect:{adaptResist:.1}},{id:"xenomorph",name:"Xenomorph",cost:3,desc:"Transform: gain +50% ATK and +30% DEF for 4 turns.",effect:{transformBuff:{atk:.5,def:.3,turns:4}}}]}]},Agent:{icon:"◆",branches:[{id:"protocol_breach",name:"Protocol Breach",icon:"◈",desc:"System hacking — exploit enemy weaknesses",skills:[{id:"exploit",name:"Exploit",cost:1,desc:"Attacks ignore 20% of enemy DEF.",effect:{defPierce:.2}},{id:"backdoor",name:"Backdoor",cost:2,desc:"30% chance: your attack hits twice.",effect:{doubleHit:.3}},{id:"system_crash",name:"System Crash",cost:3,desc:"Ultimate: applies Corrupted status to enemy (−30% ATK for 5 turns).",effect:{ultCorrupt:!0}}]},{id:"field_ops",name:"Field Ops",icon:"◩",desc:"Tactical superiority — control the battlefield",skills:[{id:"tactical_move",name:"Tactical Move",cost:1,desc:"+2 DEF. Fleeing never costs a turn.",effect:{defBonus:2,freeFlee:!0}},{id:"cover_fire",name:"Cover Fire",cost:2,desc:"Protect the lowest-HP ally: redirect 30% of their damage to this Agent.",effect:{coverAlly:.3}},{id:"extraction",name:"Extraction",cost:3,desc:"After any ally falls: immediately revive them at 25% HP (once per battle).",effect:{battleRevive:!0}}]},{id:"dark_data",name:"Dark Data",icon:"▣",desc:"Bonus economy — gold, drops, and rare finds",skills:[{id:"loot_scan",name:"Loot Scan",cost:1,desc:"+25% gold from all battles. +10% item drop chance.",effect:{goldBonus:.25,dropBonus:.1}},{id:"black_market",name:"Black Market",cost:2,desc:"Shop prices reduced by 20%. Items occasionally found in chests.",effect:{shopDiscount:.2}},{id:"deep_archive",name:"Deep Archive",cost:3,desc:"Once per session: access a hidden shop with rare items.",effect:{secretShop:!0}}]}]}},te={prologue_home:{id:"prologue_home",name:"Rise and Fall",chapter:0,desc:"Mom is calling from downstairs. Something is wrong.",steps:[{id:"go_downstairs",text:"Go downstairs",done:!1},{id:"talk_mom_down",text:"Speak to Mom",done:!1}],reward:{gold:0,items:[],xp:5},lore:"A morning that started like any other. It won't end that way."},prologue_outside:{id:"prologue_outside",name:"First Steps",chapter:0,desc:"Pix the Neighbor is waiting outside. Go see what they know.",steps:[{id:"leave_home",text:"Leave your home",done:!1},{id:"talk_pix",text:"Speak to Pix the Neighbor",done:!1}],reward:{gold:10,items:["compass"],xp:15},lore:"The street that felt safe yesterday looks different in static light."},ch1_soldier:{id:"ch1_soldier",name:"The Soldier's Warning",chapter:1,desc:"Speak to the Grid Soldier near the river crossing.",steps:[{id:"talk_soldier",text:"Speak to the Grid Soldier",done:!1}],reward:{gold:15,items:[],xp:20},lore:"The soldier has seen things the maps don't show. Listen."},ch1_find_oracle:{id:"ch1_find_oracle",name:"The Oracle of Bit",chapter:1,desc:"Travel east to Pixel Town and find the Oracle.",steps:[{id:"reach_town",text:"Reach Pixel Town",done:!1},{id:"talk_oracle",text:"Speak to the Oracle of Bit",done:!1}],reward:{gold:25,items:["pixel_shard"],xp:50},lore:"The Oracle has been reading the chain for forty years. She knows NULLBYTE's patterns. She has been waiting for the Render Mark."},ch1_bit_shards:{id:"ch1_bit_shards",name:"Fragments of the Grid",chapter:1,desc:"Collect 3 Pixel Shards from Void Scouts in the dark grass.",steps:[{id:"collect_shards",text:"Defeat Void Scouts (0/3)",done:!1,progress:0,target:3}],reward:{gold:35,items:["render_key"],xp:80},lore:"Every Void Scout carries a stolen piece of the Grid. Take them back."},ch2_cave:{id:"ch2_cave",name:"The Cave of First Bits",chapter:2,desc:"Enter the Cave, find the Render Flame, defeat the Guardian.",steps:[{id:"enter_cave",text:"Enter the Cave of First Bits",done:!1},{id:"talk_spirit",text:"Speak to the Grid Spirit",done:!1},{id:"defeat_guardian",text:"Defeat the Cave Guardian",done:!1}],reward:{gold:60,items:["render_flame"],xp:200},lore:"The Render Flame is the first pixel ever lit. The Guardian has been corrupted to protect it for NULLBYTE. It must be stopped."},ch3_void_march:{id:"ch3_void_march",name:"The Void March",chapter:3,desc:"Push through the Corrupted Lands and reach the Void Citadel.",steps:[{id:"cross_void",text:"Cross the Corrupted Lands",done:!1},{id:"find_survivor",text:"Find the Last Survivor",done:!1},{id:"reach_citadel",text:"Reach the Void Citadel",done:!1}],reward:{gold:100,items:[],xp:350},lore:"Three days of static. Two days of silence. The Corrupted Lands eat the light and spit out nothing. Stay on the path. Whatever you do — stay on the path."},ch3_upgrade:{id:"ch3_upgrade",name:"Power Before the Storm",chapter:3,desc:"Ensure your party is ready. Upgrade at least one Normie's skill tree.",steps:[{id:"unlock_skill",text:"Unlock at least 1 skill for any Normie",done:!1}],reward:{gold:40,items:["antivoid","antivoid"],xp:100},lore:"The Citadel guards are unlike anything you've faced in the fields. Every advantage matters."},finale:{id:"finale",name:"Rerender the World",chapter:4,desc:"Confront NULLBYTE and restore the Grid.",steps:[{id:"breach_citadel",text:"Fight through the Citadel",done:!1},{id:"defeat_commander",text:"Defeat the Void Commander",done:!1},{id:"defeat_nullbyte",text:"Defeat NULLBYTE",done:!1}],reward:{gold:0,items:["grid_restored"],xp:1e3},lore:`"You cannot rewrite what has already been consumed."
— NULLBYTE

He is wrong.`}},He={potion:{id:"potion",name:"Render Potion",rarity:"common",desc:"Restores 40% HP to the most wounded Normie. Pure rendered light in a bottle.",icon:"⬜",stackable:!0,use:e=>{const o=e.filter(t=>t.alive).sort((t,n)=>t.hp/t.maxHp-n.hp/n.maxHp)[0];if(!o)return null;const i=Math.floor(o.maxHp*.4);return o.hp=Math.min(o.maxHp,o.hp+i),`${o.name} recovered ${i} HP.`}},mp_crystal:{id:"mp_crystal",name:"MP Crystal",rarity:"common",desc:"Restores 8 MP to the party leader. Crystallized render energy.",icon:"◆",stackable:!0,use:e=>{const o=e.filter(t=>t.alive)[0];if(!o)return null;const i=Math.min(8,o.maxMp-o.mp);return o.mp+=i,`${o.name} recovered ${i} MP.`}},pixel_shard:{id:"pixel_shard",name:"Pixel Shard",rarity:"quest",desc:"A fragment of the Grid torn from the terrain. Still vibrates faintly.",icon:"◇",stackable:!0,questItem:!0},compass:{id:"compass",name:"Render Compass",rarity:"uncommon",desc:"Points toward VOID energy concentrations. Pix gave this to you.",icon:"◎",stackable:!1,questItem:!1,passive:"Reveals strong enemy locations on the minimap."},render_key:{id:"render_key",name:"Render Key",rarity:"quest",desc:"Forged by the Oracle from 3 Pixel Shards. Opens the Cave of First Bits.",icon:"⬡",stackable:!1,questItem:!0},render_flame:{id:"render_flame",name:"Render Flame",rarity:"legendary",desc:"The first pixel ever lit. Cannot be corrupted. +15% damage to all Void enemies.",icon:"◈",stackable:!1,questItem:!1,passive:"+15% damage to all VOID-type enemies."},antivoid:{id:"antivoid",name:"Anti-Void Salve",rarity:"uncommon",desc:"Prevents VOID terrain damage for 30 steps.",icon:"▣",stackable:!0,passive:"Protects against VOID terrain drain."},full_render:{id:"full_render",name:"Full Render",rarity:"rare",desc:"Fully restores all HP and MP to the entire party.",icon:"■",stackable:!0,use:e=>(e.forEach(o=>{o.hp=o.maxHp,o.mp=o.maxMp,o.alive=!0}),"All Normies fully restored!")},void_core:{id:"void_core",name:"Void Core",rarity:"rare",desc:"Crystallized void energy. Sell for 80G or craft into armor.",icon:"◉",stackable:!0},grid_restored:{id:"grid_restored",name:"The Grid: Restored",rarity:"legendary",desc:"You did it. This is not an item. This is proof.",icon:"★",stackable:!1,questItem:!0}},ze=[{id:"mom_up",mapId:"home_up",x:3,y:2,sprite:"elder_f",name:"Mom",lines:["WAKE UP! The static is bad — really bad. Get up and come downstairs, now. Something is happening to the Grid.","Don't dawdle. I need you downstairs. Your breakfast is getting cold and I have things to tell you."],questTrigger:null},{id:"mom_down",mapId:"home_down",x:3,y:2,sprite:"elder_f",name:"Mom",lines:["There you are. Listen — I don't want to scare you, but the pixels in the eastern blocks have been going dark for three days. Last night it reached Render Street.","Your grandfather always said: 'When the first pixel dims, run toward it, not away.' I never understood that until I saw the Render Mark on your hand this morning.","The Oracle in Pixel Town will know what it means. She's the only one who reads the chain in real time. You need to go to her. Take your potions from the shelf.","I love you. Be careful. Whatever is happening to the Grid — I believe you can help. You're a Normie. The first ones rendered. Never forget that."],questTrigger:{stepComplete:"talk_mom_down",start:"prologue_outside"}},{id:"home_shelf",mapId:"home_down",x:7,y:1,sprite:"merchant",name:"Supply Shelf",lines:["A modest shelf of supplies. Mom has left 3 Render Potions and a note: 'Don't skip meals. Fight smart.'"],questTrigger:null},{id:"pix",mapId:"overworld",x:28,y:22,sprite:"neighbor",name:"Pix",lines:["FINALLY! Did you see the sky to the east? That's not storm clouds — that's VOID spread. Three entire map-sectors just went dark overnight.","My cousin Dot lives near the Corrupted Lands. She sent me a message two days ago: 'The pixels here are falling like rain.' Then nothing. I think her whole block was consumed.","The Oracle in Pixel Town has been tracking NULLBYTE for years. She predicted all of this. You NEED to go to her, now. I'll hold things down here."],questTrigger:{stepComplete:"talk_pix",start:"ch1_find_oracle"}},{id:"soldier",mapId:"overworld",x:22,y:18,sprite:"guard",name:"Grid Soldier Krix",lines:["Halt, Citizen. The path east is under threat. VOID Scouts have been spotted in the dark grass beyond the river bridge.","Stay on the stone path — VOID corruption can't take root in rendered stone. Dark grass is where they hide.","If you're heading to Pixel Town, go. The Oracle needs to know the spread has reached Render Street. And — if you see any Void Scouts — take their Pixel Shards. They're stolen Grid fragments. They shouldn't be with those things."],questTrigger:{stepComplete:"talk_soldier",start:"ch1_soldier"}},{id:"merchant_plains",mapId:"overworld",x:18,y:26,sprite:"merchant",name:"Merchant Gram",shop:!0,shopInventory:["potion","mp_crystal","antivoid"],lines:["Business is booming in the worst possible way. Anti-Void Salve, potions, crystals — people are stocking up before they run.","Twenty steps on corrupted ground and your pixels start to bleed. Buy an Anti-Void Salve if you're heading past the river.","Buy low, sell... actually, don't sell. Hold everything. You'll need it all."],questTrigger:null},{id:"elder_hermit",mapId:"overworld",x:8,y:10,sprite:"elder_f",name:"Elder Vex",lines:["I remember when this field had no dark grass. Every pixel green and rendered fresh. Now look at it.","NULLBYTE was a mistake. The chain's first corrupted block. We sealed him away in Block Zero for ten thousand cycles. Someone opened it.","The Ledger records all things. Even the mistakes. That's both the tragedy and the hope."],questTrigger:null},{id:"oracle",mapId:"town",x:8,y:5,sprite:"oracle",name:"Oracle of Bit",lines:["The Render Mark. I've been waiting nine years for whoever bore it. I didn't expect a Normie. Of course it's a Normie. Sit.","NULLBYTE has consumed 43% of The Grid. Not just terrain — memories. Blocks of history. When a pixel dies, the thing it remembers dies with it.","You need the Render Flame. Cave of First Bits, south path through town. The cave is sealed with corrupted render-code — I need 3 Pixel Shards from the Scouts in the dark grass to forge you a key.","The Shards are pieces of the Grid itself. The Scouts carry them to power themselves. Take them back. Bring them here. Then go to the cave. Time is not our ally."],questTrigger:{stepComplete:"talk_oracle",start:"ch1_bit_shards"}},{id:"innkeeper",mapId:"town",x:4,y:8,sprite:"innkeeper",name:"Innkeeper Luma",inn:!0,lines:["Rest here. Full HP and MP restored, no charge. Anyone fighting the VOID sleeps free in Luma's inn. Always.","The refugees from the eastern blocks keep coming. Some have only a few pixels left — you can see through them. They flicker when they speak.","I've been writing everything down on paper. Every face I've seen. Just in case the pixels go. Memory on paper outlasts any block."],questTrigger:null},{id:"historian",mapId:"town",x:10,y:7,sprite:"scholar",name:"Historian Dot",lines:["The Grid is 10,000 blocks deep. Each block a moment in time. NULLBYTE consuming blocks means he's erasing HISTORY — not just space.","Here's what the chain tells me: Normies have a stronger render signature than any other entity. That's why they're always the last pixels standing. That's why you're special.","Upgrade your party whenever you can. The skill trees aren't just numbers — they're ways of being. An Agent thinks differently than an Alien. Use that."],questTrigger:null},{id:"blacksmith",mapId:"town",x:12,y:9,sprite:"blacksmith",name:"Render Smith Boro",shop:!0,shopInventory:["potion","mp_crystal","full_render","antivoid"],lines:["I forge rendered matter. Every item here is crystallized from pure chain-hash. Worth more than gold in a world losing pixels.","The Cave Guardian has been undefeated for sixty render-years. Whatever you're planning, bring Full Renders. Buy two.","Come back after the Cave. Render Flame as a crafting base... I have schematics. Just survive long enough."],questTrigger:null},{id:"town_guard",mapId:"town",x:2,y:12,sprite:"guard",name:"Town Guard Stel",lines:["The south gate to the cave path is open. I can't close it — refugees need the route in.","Whatever you find in that cave — be careful. Three full squads went in last month. None came back.","The Guardian — we think it was once one of us. A Normie. That's all I'll say."],questTrigger:null},{id:"cave_spirit",mapId:"cave",x:6,y:4,sprite:"spirit",name:"Grid Spirit",lines:["The Render Key. Good. You carry the Oracle's mark. This cave was rendered at the first block — every pixel here is original. Pre-corruption. Pre-VOID.","The Guardian guards the Render Flame. It was once called Keeper — a noble algorithm, the first autonomous being. NULLBYTE corrupted it. Now it protects the Flame for him.","It still has something of its original self inside. I can feel it. When you fight it — don't hate it. Pity it. Then end its suffering. That's the only mercy left."],questTrigger:{stepComplete:"talk_spirit"}},{id:"survivor",mapId:"void_lands",x:5,y:8,sprite:"survivor",name:"Survivor Wren",lines:["...my village. It's just gone. I watched the pixels drop one at a time. Like sand through fingers. Then nothing. Black.","NULLBYTE moves faster now. He's absorbed enough to accelerate. I counted: the Citadel is maybe 200 pixels east. I can see it glowing from here. Dark glow. Wrong color.","Take everything I have. I'm not going further. I'll stay here and be a memory. That's still something, right?"],questTrigger:{stepComplete:"find_survivor"},giftItem:"full_render"},{id:"void_defector",mapId:"void_lands",x:22,y:8,sprite:"guard",name:"Defector Nil",lines:["I was VOID. I know — don't look at me like that. I was consumed, turned, deployed. Then something in the chain... glitched me back. Partial recovery.","NULLBYTE keeps his main force in the Citadel. A Commander guards the inner gate. Elite. Old. Angry. It hasn't lost in three hundred cycles.","The Citadel core is where he stores consumed pixels. If you destroy the core while NULLBYTE falls, they might come back. Might. No promises. But — might."],questTrigger:null}],Bo={void_scout:{id:"void_scout",name:"VOID SCOUT",tier:0,sprite:"void_scout",voidType:!0,hpBase:55,atkBase:11,def:1,spd:9,lore:"The smallest VOID unit. Scouts ahead of the corruption wave, draining isolated pixels to send coordinates back to NULLBYTE.",dropItem:"pixel_shard",dropChance:1,questDrop:{questId:"ch1_bit_shards",stepId:"collect_shards"},moves:["Pixel Drain","Static Pulse","Corrupt Touch"],xpReward:18},glitch_sprite:{id:"glitch_sprite",name:"GLITCH SPRITE",tier:0,sprite:"glitch",voidType:!0,hpBase:70,atkBase:14,def:2,spd:12,lore:"A Normie whose pixels were 80% consumed. What remains moves on corrupted instinct alone. There may be nothing left to save.",dropItem:"potion",dropChance:.35,moves:["Corrupt Touch","Fragmented Strike","Null Twitch"],xpReward:22},void_soldier:{id:"void_soldier",name:"VOID SOLDIER",tier:1,sprite:"void_heavy",voidType:!0,hpBase:120,atkBase:20,def:5,spd:7,lore:"A fully-formed VOID construct. Carries 256 consumed pixels. Cold. Purposeful. Relentless. It knows your name.",dropItem:"void_core",dropChance:.3,moves:["Null Strike","Pixel Crush","Consume"],xpReward:45},bit_wraith:{id:"bit_wraith",name:"BIT WRAITH",tier:1,sprite:"wraith",voidType:!0,hpBase:100,atkBase:26,def:2,spd:17,lore:"Born from a block of corrupted memory. Attacks by injecting null bytes directly into the target's render stream.",dropItem:"mp_crystal",dropChance:.4,moves:["Null Injection","Phase Shift","Memory Wipe"],xpReward:55},cave_crawler:{id:"cave_crawler",name:"CAVE CRAWLER",tier:2,sprite:"golem",voidType:!1,hpBase:140,atkBase:22,def:8,spd:5,lore:"Not void — simply ancient. Born from the original render-matter of the cave walls. Territorial. Dangerous. Not evil.",dropItem:"potion",dropChance:.5,moves:["Stone Slam","Pixel Grind","Cave Crush"],xpReward:70},cave_guardian:{id:"cave_guardian",name:"CAVE GUARDIAN",tier:2,sprite:"guardian",boss:!0,voidType:!0,hpBase:380,atkBase:36,def:10,spd:6,lore:"Once called Keeper. The first autonomous being rendered on the Grid. Corrupted by NULLBYTE. Something of the original still flickers within its hollow chest.",dropItem:"void_core",dropChance:1,questDrop:{questId:"ch2_cave",stepId:"defeat_guardian"},moves:["Flame Corruption","Grid Slam","Consume Render","Hollow Roar"],preText:"The Cave Guardian turns. Deep within its hollow eyes, the original Render Flame still flickers. Then the VOID overwhelms it.",xpReward:280},void_hulk:{id:"void_hulk",name:"VOID HULK",tier:3,sprite:"void_heavy",voidType:!0,hpBase:280,atkBase:42,def:12,spd:5,lore:"A VOID construct built from entire city blocks. Slow. Massive. Catastrophically powerful. You can hear consumed pixels screaming inside it.",dropItem:"void_core",dropChance:.6,moves:["Block Crush","Pixel Storm","Total Erasure"],xpReward:120},null_specter:{id:"null_specter",name:"NULL SPECTER",tier:3,sprite:"wraith",voidType:!0,hpBase:200,atkBase:55,def:4,spd:20,lore:"A VOID assassin unit. Moves faster than the chain can record. You won't see it until it's already inside your render signature.",dropItem:"mp_crystal",dropChance:.5,moves:["Null Injection","Phase Strike","Signature Rip"],xpReward:130},void_elite:{id:"void_elite",name:"VOID ELITE",tier:3,sprite:"void_heavy",voidType:!0,hpBase:320,atkBase:50,def:16,spd:12,lore:"Hand-built by NULLBYTE from his most loyal converts. Each one contains a thousand consumed pixels. Each one remembers what it used to be.",dropItem:"full_render",dropChance:.2,moves:["Command: Corrupt","Null Protocol","Bit Bomb"],xpReward:160},void_commander:{id:"void_commander",name:"VOID COMMANDER",tier:4,sprite:"commander",boss:!0,voidType:!0,hpBase:560,atkBase:58,def:16,spd:14,lore:"NULLBYTE's general. Three hundred render-cycles old. Has never been defeated. Speaks in null characters. Is understood perfectly.",dropItem:"full_render",dropChance:.8,questDrop:{questId:"finale",stepId:"defeat_commander"},moves:["Command: Corrupt","Total Erasure","Bit Bomb","Zero Protocol"],preText:'THE COMMANDER: "You have come farther than most. That ends now."',xpReward:500},nullbyte:{id:"nullbyte",name:"NULLBYTE",tier:5,sprite:"nullbyte",boss:!0,finalBoss:!0,voidType:!0,hpBase:1200,atkBase:80,def:22,spd:20,lore:"NULLBYTE. The Void made manifest. Pixel Zero — the first bit ever rendered, falling to corruption before the Grid could wake. He wants everything back to the nothing he came from.",dropItem:null,moves:["Total Void","Pixel Storm","Null Protocol","Consume Reality","Zero Hour"],preText:'NULLBYTE: "You are too late. 47% of the Grid is gone. I admire you — you are the last Normie to resist. Let me take those 1,600 pixels personally."',postText:"As NULLBYTE falls, consumed pixels stream back into the Grid. Millions of tiny squares of light. Each one a restored soul. The first pixel re-lit is yours.",xpReward:2e3}},ke={home_up:{id:"home_up",name:"Your Bedroom",encounterRate:0,ambience:"quiet",connections:[]},home_down:{id:"home_down",name:"Home — Downstairs",encounterRate:0,ambience:"quiet",connections:[]},overworld:{id:"overworld",name:"Render Fields",encounterRate:.04,ambience:"open",subZones:[{name:"RENDER STREET",x0:10,x1:22,y0:18,y1:28,tier:0},{name:"PIXEL PLAINS",x0:0,x1:35,y0:0,y1:48,tier:0},{name:"DARK MARGINS",x0:35,x1:48,y0:0,y1:35,tier:1}],connections:[{destMap:"home_up",destX:4,destY:7,triggerX:16,triggerY:22},{destMap:"town",destX:4,destY:10,triggerX:38,triggerY:24}]},town:{id:"town",name:"Pixel Town",encounterRate:0,ambience:"safe",connections:[{destMap:"overworld",destX:37,destY:24,triggerX:2,triggerY:10},{destMap:"cave",destX:4,destY:2,triggerX:12,triggerY:18}]},cave:{id:"cave",name:"Cave of First Bits",encounterRate:.065,ambience:"dark",requiredItem:"render_key",connections:[{destMap:"town",destX:12,destY:17,triggerX:4,triggerY:1},{destMap:"void_lands",destX:4,destY:2,triggerX:18,triggerY:15}]},void_lands:{id:"void_lands",name:"Corrupted Lands",encounterRate:.085,voidDamage:!0,ambience:"corrupted",connections:[{destMap:"cave",destX:17,destY:14,triggerX:4,triggerY:3},{destMap:"citadel",destX:4,destY:14,triggerX:28,triggerY:14}]},citadel:{id:"citadel",name:"Void Citadel",encounterRate:.075,voidDamage:!1,ambience:"dark",connections:[{destMap:"void_lands",destX:27,destY:14,triggerX:2,triggerY:14}]}};function xe(e){let o=e*1664525+1013904223&2147483647;return()=>(o=o*1664525+1013904223&2147483647,o/2147483647)}function be(e,o,i=d.GRASS0){return Array.from({length:o},()=>new Array(e).fill(i))}function Po(){const i=be(12,10,d.BED_FLOOR);for(let t=0;t<12;t++)i[0][t]=d.BED_WALL,i[9][t]=d.BED_WALL;for(let t=0;t<10;t++)i[t][0]=d.BED_WALL,i[t][11]=d.BED_WALL;return i[1][1]=d.BED,i[1][2]=d.BED,i[1][9]=d.BOOKSHELF,i[1][10]=d.BOOKSHELF,i[8][5]=d.STAIRS_DN,i[8][6]=d.STAIRS_DN,i[0][4]=d.BED_WALL,i[0][5]=d.BED_WALL,{tiles:i,w:12,h:10}}function Ho(){const i=be(12,10,d.INN_FLOOR);for(let t=0;t<12;t++)i[0][t]=d.WALL,i[9][t]=d.WALL;for(let t=0;t<10;t++)i[t][0]=d.WALL,i[t][11]=d.WALL;return i[1][5]=d.STAIRS_DN,i[1][6]=d.STAIRS_DN,i[9][5]=d.DOOR,i[9][6]=d.DOOR,i[1][9]=d.BOOKSHELF,i[1][10]=d.BOOKSHELF,i[4][5]=d.BED,i[4][6]=d.BED,{tiles:i,w:12,h:10}}function No(){const i=xe(31337),t=be(48,48,d.GRASS0);for(let n=1;n<47;n++)for(let s=1;s<47;s++){const l=i();l<.12?t[n][s]=d.GRASS1:l<.22?t[n][s]=d.GRASS2:l<.26&&(t[n][s]=d.DARK_GRASS)}for(let n=0;n<48;n++)for(let s=38;s<48;s++)t[n][s]=i()<.65?d.DARK_GRASS:d.GRASS1;for(let n=0;n<48;n++)t[0][n]=d.TREE,t[47][n]=d.TREE;for(let n=0;n<48;n++)t[n][0]=d.TREE,t[n][47]=d.TREE;for(let n=5;n<42;n++)t[15][n]=d.WATER,t[16][n]=d.WATER;t[15][20]=d.PATH,t[16][20]=d.PATH,t[15][21]=d.PATH,t[16][21]=d.PATH,[[5,5,4,4],[30,8,5,5],[8,30,3,4],[35,35,4,3],[12,40,3,3]].forEach(([n,s,l,c])=>{for(let g=0;g<c;g++)for(let h=0;h<l;h++)i()<.7&&n+h<47&&s+g<47&&(t[s+g][n+h]=d.TREE)});for(let n=1;n<47;n++)t[22][n]!==d.WATER&&(t[22][n]=d.PATH);for(let n=1;n<47;n++)t[n][22]!==d.WATER&&(t[n][22]=d.PATH);for(let n=30;n<46;n++)t[24][n]=d.PATH;for(let n=19;n<26;n++)for(let s=12;s<22;s++)t[n][s]=d.PATH;for(let n=19;n<22;n++)for(let s=14;s<18;s++)t[n][s]=d.HOUSE_WALL;t[21][15]=d.DOOR,t[21][16]=d.DOOR;for(let n=14;n<18;n++)t[18][n]=d.ROOF;for(let n=20;n<23;n++)for(let s=24;s<28;s++)t[n][s]=d.HOUSE_WALL;t[22][25]=d.DOOR;for(let n=24;n<28;n++)t[19][n]=d.ROOF;for(let n=8;n<11;n++)for(let s=6;s<10;s++)t[n][s]=d.HOUSE_WALL;t[10][7]=d.DOOR;for(let n=6;n<10;n++)t[7][n]=d.ROOF;return t[23][17]=d.SIGN,t[24][37]=d.SIGN,t[24][38]=d.SIGN,{tiles:t,w:48,h:48}}function Oo(){const i=be(26,22,d.TOWN_FLOOR);for(let t=0;t<26;t++)i[0][t]=d.WALL,i[21][t]=d.WALL;for(let t=0;t<22;t++)i[t][0]=d.WALL,i[t][25]=d.WALL;i[10][0]=d.PATH,i[11][0]=d.PATH;for(let t=1;t<7;t++)for(let n=5;n<15;n++)i[t][n]=d.INN_FLOOR;for(let t=5;t<15;t++)i[1][t]=d.WALL;for(let t=1;t<7;t++)i[t][5]=d.WALL,i[t][14]=d.WALL;i[6][9]=d.DOOR,i[6][10]=d.DOOR;for(let t=7;t<13;t++)for(let n=1;n<7;n++)i[t][n]=d.INN_FLOOR;for(let t=1;t<7;t++)i[7][t]=d.WALL;for(let t=7;t<13;t++)i[t][1]=d.WALL,i[t][6]=d.WALL;i[12][3]=d.DOOR,i[12][4]=d.DOOR;for(let t=7;t<15;t++)for(let n=17;n<24;n++)i[t][n]=d.INN_FLOOR;for(let t=17;t<24;t++)i[7][t]=d.WALL;for(let t=7;t<15;t++)i[t][17]=d.WALL,i[t][23]=d.WALL;i[14][20]=d.DOOR,i[14][21]=d.DOOR;for(let t=1;t<7;t++)for(let n=17;n<24;n++)i[t][n]=d.INN_FLOOR;for(let t=17;t<24;t++)i[1][t]=d.WALL;for(let t=1;t<7;t++)i[t][17]=d.WALL,i[t][23]=d.WALL;i[6][19]=d.DOOR,i[6][20]=d.DOOR;for(let t=15;t<21;t++)for(let n=9;n<17;n++)i[t][n]=d.PATH;return i[21][12]=d.PATH,i[21][13]=d.PATH,[[2,15],[3,2],[22,2],[22,14],[2,3],[22,3]].forEach(([t,n])=>i[t][n]=d.TREE),i[15][8]=d.SIGN,i[15][17]=d.SIGN,{tiles:i,w:26,h:22}}function Do(){const i=xe(55555),t=be(24,20,d.CAVE_FLOOR);for(let n=0;n<24;n++)t[0][n]=d.CAVE_WALL,t[19][n]=d.CAVE_WALL;for(let n=0;n<20;n++)t[n][0]=d.CAVE_WALL,t[n][23]=d.CAVE_WALL;for(let n=2;n<18;n++)for(let s=2;s<22;s++)i()<.18&&(t[n][s]=d.CAVE_WALL);for(let n=2;n<22;n++)t[9][n]=d.CAVE_FLOOR,t[10][n]=d.CAVE_FLOOR;for(let n=2;n<18;n++)t[n][4]=d.CAVE_FLOOR,t[n][5]=d.CAVE_FLOOR;for(let n=2;n<18;n++)t[n][18]=d.CAVE_FLOOR,t[n][19]=d.CAVE_FLOOR;for(let n=4;n<12;n++)for(let s=15;s<22;s++)t[n][s]=d.CAVE_FLOOR;for(let n=15;n<22;n++)t[4][n]=d.CAVE_WALL,t[11][n]=d.CAVE_WALL;t[5][15]=d.CAVE_WALL,t[10][15]=d.CAVE_WALL;for(let n=2;n<6;n++)for(let s=3;s<8;s++)t[n][s]=d.CAVE_FLOOR;return t[1][4]=d.CAVE_FLOOR,t[1][5]=d.CAVE_FLOOR,t[19][18]=d.CAVE_FLOOR,t[19][19]=d.CAVE_FLOOR,t[6][10]=d.WATER,t[6][11]=d.WATER,t[13][6]=d.WATER,{tiles:t,w:24,h:20}}function Wo(){const i=xe(99999),t=be(34,30,d.DARK_GRASS);for(let n=0;n<30;n++)for(let s=0;s<34;s++)t[n][s]=i()<.55?d.VOID:d.DARK_GRASS;for(let n=2;n<32;n++)t[14][n]=d.PATH,t[15][n]=d.PATH;for(let n=6;n<26;n++)t[n][4]=d.PATH,t[n][5]=d.PATH;[[5,7,5,4],[8,18,4,3],[15,22,5,4]].forEach(([n,s,l,c])=>{for(let g=0;g<c;g++)for(let h=0;h<l;h++)t[n+g][s+h]=i()<.6?d.WALL:d.CAVE_FLOOR});for(let n=6;n<10;n++)for(let s=3;s<8;s++)t[n][s]=d.CAVE_FLOOR;for(let n=6;n<10;n++)for(let s=20;s<26;s++)t[n][s]=d.CAVE_FLOOR;for(let n=0;n<34;n++)t[0][n]=d.CAVE_WALL,t[29][n]=d.CAVE_WALL;for(let n=0;n<30;n++)t[n][0]=d.CAVE_WALL,t[n][33]=d.CAVE_WALL;return t[14][0]=d.PATH,t[15][0]=d.PATH,t[14][33]=d.PATH,t[15][33]=d.PATH,{tiles:t,w:34,h:30}}function $o(){const i=xe(11111),t=be(22,20,d.CAVE_FLOOR);for(let n=0;n<22;n++)t[0][n]=d.CAVE_WALL,t[19][n]=d.CAVE_WALL;for(let n=0;n<20;n++)t[n][0]=d.CAVE_WALL,t[n][21]=d.CAVE_WALL;for(let n=1;n<19;n++)for(let s=1;s<21;s++)i()<.3&&(t[n][s]=d.VOID);for(let n=1;n<21;n++)t[9][n]=d.PATH,t[10][n]=d.PATH;for(let n=1;n<19;n++)t[n][11]=d.PATH;for(let n=2;n<9;n++)for(let s=15;s<20;s++)t[n][s]=d.CAVE_FLOOR;for(let n=15;n<20;n++)t[2][n]=d.CAVE_WALL;for(let n=2;n<9;n++)t[n][15]=d.CAVE_WALL,t[n][19]=d.CAVE_WALL;return t[9][0]=d.PATH,t[10][0]=d.PATH,{tiles:t,w:22,h:20}}const Fo=new Set([d.BED_WALL,d.BOOKSHELF,d.TREE,d.HOUSE_WALL,d.ROOF,d.WALL,d.CAVE_WALL,d.BED,d.WATER]),Go=e=>Fo.has(e),Vo={home_up:Po,home_down:Ho,overworld:No,town:Oo,cave:Do,void_lands:Wo,citadel:$o},Se={home_up:{x:5,y:5},home_down:{x:5,y:3},overworld:{x:16,y:22},town:{x:4,y:10},cave:{x:4,y:3},void_lands:{x:5,y:14},citadel:{x:3,y:9}},u="#0e0e0f",m="#383838",f="#707070",v="#aaaaaa",k="#e4e4e0";function ge(e,o){const i=document.createElement("canvas");return i.width=e,i.height=o,i}function p(e,o,i,t){o<0||i<0||o>=e.canvas.width||i>=e.canvas.height||(e.fillStyle=t,e.fillRect(o,i,1,1))}function a(e,o,i,t,n,s){e.fillStyle=s,e.fillRect(o,i,t,n)}function D(e,o,i,t,n,s,l,c){const g=[[0,.5],[.75,.25]];for(let h=0;h<n;h++)for(let E=0;E<t;E++)p(e,o+E,i+h,c>g[h%2][E%2]?l:s)}function qo(e){const i=[];for(let t=0;t<8;t++){const n=ge(e,12),s=n.getContext("2d");s.imageSmoothingEnabled=!1,a(s,1,0,e-2,3,m),a(s,1,0,e-2,1,f);const l=t/8*Math.PI*2,c=Math.round(Math.sin(l)*2),g=-c,h=Math.abs(Math.sin(l))>.7?1:0,E=Math.abs(Math.sin(l+Math.PI))>.7?1:0,_=Math.floor(e*.15);a(s,_,3,3,3+h,m),a(s,_,3,1,3+h,f),a(s,_+Math.round(c*.4),6+h,3,2,m),a(s,_+Math.round(c*.7)-1,8+h,4,1,u),p(s,_+Math.round(c*.7),8+h,f);const I=Math.floor(e*.6);a(s,I,3,3,3+E,m),a(s,I,3,1,3+E,f),a(s,I+Math.round(g*.4),6+E,3,2,m),a(s,I+Math.round(g*.7)-1,8+E,4,1,u),p(s,I+Math.round(g*.7),8+E,f),i.push(n)}return i}function Yo(e,o){const i=ge(o,o),t=i.getContext("2d");t.imageSmoothingEnabled=!1,t.clearRect(0,0,o,o);const n=40,s=o/n;if(e&&e.length>=1600){t.fillStyle=u;for(let l=0;l<1600;l++)if(e[l]==="1"){const c=l%n,g=Math.floor(l/n);t.fillRect(Math.floor(c*s),Math.floor(g*s),Math.max(1,Math.ceil(s)),Math.max(1,Math.ceil(s)))}}else{t.fillStyle=k,t.fillRect(0,0,o,o),t.fillStyle=u,t.fillRect(4,4,o-8,o-8),t.fillStyle=k,t.fillRect(5,5,o-10,o-10);const l=Math.max(1,Math.floor(o/8));t.fillStyle=u,t.fillRect(Math.floor(o*.25),Math.floor(o*.35),l,l),t.fillRect(Math.floor(o*.6),Math.floor(o*.35),l,l),t.fillRect(Math.floor(o*.3),Math.floor(o*.6),Math.floor(o*.4),Math.max(1,Math.floor(o/14)))}return i}function Pt(e){const s=Yo(e,26),l=qo(26),c=ge(26*2,38*2);function g(h){const E=c.getContext("2d");E.imageSmoothingEnabled=!1,E.clearRect(0,0,26*2,38*2),E.drawImage(s,0,0,26*2,26*2);const _=l[h%l.length];E.drawImage(_,0,26*2,26*2,12*2)}return g(0),{canvas:c,render:g,width:26*2,height:38*2}}function Ht(e){const i=ge(40,40),t=i.getContext("2d");if(t.imageSmoothingEnabled=!1,t.fillStyle=k,t.fillRect(0,0,40,40),e&&e.length>=1600){t.fillStyle=u;for(let n=0;n<1600;n++)e[n]==="1"&&t.fillRect(n%40,Math.floor(n/40),1,1);t.globalAlpha=.07,t.fillStyle=k;for(let n=0;n<20;n++)for(let s=0;s<20;s++)(s+n)%2===0&&t.fillRect(s,n,1,1);t.globalAlpha=1}else t.fillStyle=m,t.fillRect(8,2,24,8),t.fillStyle=k,t.fillRect(6,10,28,20),t.fillStyle=m,t.fillRect(10,14,8,5),t.fillRect(22,14,8,5),t.fillStyle=u,t.fillRect(12,15,2,2),t.fillRect(24,15,2,2),t.fillStyle=m,t.fillRect(14,25,12,3);return t.fillStyle=u,t.fillRect(0,0,40,1),t.fillRect(0,39,40,1),t.fillRect(0,0,1,40),t.fillRect(39,0,1,40),t.fillStyle=f,t.fillRect(1,1,38,1),t.fillRect(1,1,1,38),i}const yt={elder_f:e=>{a(e,5,0,6,2,m),a(e,6,0,4,3,u),a(e,3,2,10,8,k),a(e,2,3,12,5,k),a(e,3,2,1,8,f),a(e,12,2,1,8,u),a(e,2,3,1,5,f),a(e,13,3,1,5,u),a(e,4,4,3,2,u),a(e,9,4,3,2,u),p(e,5,4,k),p(e,10,4,k),p(e,5,5,v),p(e,10,5,v),p(e,4,6,v),p(e,11,6,v),a(e,6,7,4,1,m),p(e,5,7,f),p(e,10,7,f),a(e,2,10,12,12,f),a(e,2,10,12,1,v),a(e,2,10,1,12,v),a(e,13,10,1,12,u),a(e,4,10,8,10,v),a(e,4,10,8,1,k),a(e,4,10,1,10,k),a(e,0,11,2,8,m),a(e,0,11,1,8,f),a(e,14,11,2,8,m),a(e,15,11,1,8,f),a(e,0,19,2,2,v),a(e,14,19,2,2,v),a(e,3,22,4,2,m),a(e,9,22,4,2,m),a(e,3,22,2,1,f),a(e,9,22,2,1,f)},neighbor:e=>{a(e,4,0,8,2,u);for(let o=0;o<4;o++)a(e,4+o*2,0,1,3-o%2,u);a(e,2,2,12,8,k),a(e,1,3,14,5,k),a(e,2,2,1,8,f),a(e,13,2,1,8,u),a(e,1,3,1,5,f),a(e,14,3,1,5,u),a(e,3,4,3,2,u),a(e,9,4,3,2,u),p(e,4,4,k),p(e,10,4,k),p(e,4,5,v),p(e,10,5,v),a(e,6,7,5,1,m),p(e,10,7,f),a(e,2,10,12,12,m),a(e,2,10,12,1,f),a(e,2,10,1,12,f),a(e,13,10,1,12,u),a(e,7,10,2,12,u),p(e,7,11,f),p(e,7,14,f),p(e,7,17,f),a(e,4,10,4,3,f),a(e,8,10,4,3,f),a(e,0,11,2,9,m),a(e,0,11,1,9,f),a(e,14,11,2,9,m),a(e,15,11,1,9,f),a(e,3,22,4,2,f),a(e,9,22,4,2,f),a(e,3,22,2,1,v),a(e,9,22,2,1,v)},guard:e=>{a(e,3,0,10,4,m),a(e,2,3,12,2,u),a(e,3,2,10,2,u),a(e,4,2,4,1,m),a(e,8,2,4,1,m),p(e,4,2,f),p(e,5,2,f),a(e,3,4,10,5,m),a(e,3,4,10,1,f),a(e,2,9,12,13,m),a(e,2,9,12,1,f),a(e,2,9,1,13,f),a(e,13,9,1,13,u),a(e,4,10,8,8,f),a(e,4,10,8,1,v),a(e,4,10,1,8,v),a(e,7,12,2,4,u),a(e,5,13,6,2,u),a(e,7,12,1,4,m),a(e,5,13,3,1,m),a(e,0,9,3,5,m),a(e,0,9,2,5,f),a(e,13,9,3,5,m),a(e,15,9,2,5,f),a(e,0,14,2,6,m),a(e,0,14,1,6,f),a(e,14,14,2,6,m),a(e,15,14,1,6,f),a(e,3,22,4,2,u),a(e,9,22,4,2,u),a(e,3,22,2,1,m),a(e,9,22,2,1,m)},merchant:e=>{a(e,5,0,6,4,u),a(e,5,0,6,1,m),a(e,3,3,10,2,u),a(e,3,3,10,1,m),a(e,3,5,10,7,k),a(e,2,6,12,5,k),a(e,3,5,1,7,f),a(e,12,5,1,7,u),a(e,2,6,1,5,f),a(e,13,6,1,5,u),a(e,4,7,3,2,u),a(e,9,7,3,2,u),p(e,5,7,m),p(e,10,7,m);for(let o=-1;o<=1;o++)for(let i=-1;i<=1;i++)Math.abs(o)+Math.abs(i)===1&&p(e,10+o,7+i,u);a(e,5,10,6,1,m),a(e,2,12,12,10,m),a(e,2,12,12,1,f),a(e,2,12,1,10,f),a(e,13,12,1,10,u),a(e,5,12,3,5,f),a(e,8,12,3,5,f),a(e,5,12,6,10,f),a(e,5,12,1,10,v),a(e,7,15,2,1,v),a(e,0,13,2,6,m),a(e,0,13,1,6,f),a(e,14,13,2,6,m),a(e,15,13,1,6,f)},oracle:e=>{for(let o=0;o<6;o++)a(e,2+o*2,Math.max(0,-(o%3)),2,3+o%2,u);a(e,3,0,10,3,m),a(e,3,3,10,7,k),a(e,2,4,12,5,k),a(e,3,3,1,7,f),a(e,12,3,1,7,u),a(e,2,4,1,5,f),a(e,13,4,1,5,u),a(e,3,5,4,3,u),a(e,9,5,4,3,u),a(e,4,5,2,3,k),a(e,10,5,2,3,k),p(e,5,6,v),p(e,11,6,v),p(e,4,6,f),p(e,10,6,f),a(e,5,9,6,1,m),p(e,4,9,f),p(e,11,9,f),a(e,2,10,12,13,f),a(e,2,10,12,1,v),a(e,2,10,1,13,v),a(e,13,10,1,13,u),[[5,13],[11,16],[7,19],[10,21],[4,18]].forEach(([o,i])=>{p(e,o,i,k),p(e,o-1,i,v),p(e,o+1,i,v),p(e,o,i-1,v),p(e,o,i+1,v)}),a(e,0,11,2,9,f),D(e,0,14,2,6,f,m,.5),a(e,14,11,2,9,f),D(e,14,14,2,6,f,m,.5)},innkeeper:e=>{a(e,4,0,8,3,m),a(e,3,1,10,2,m),a(e,3,2,10,8,k),a(e,2,3,12,6,k),a(e,3,2,1,8,f),a(e,12,2,1,8,u),a(e,2,3,1,6,f),a(e,13,3,1,6,u),a(e,3,5,3,2,v),a(e,10,5,3,2,v),a(e,4,4,3,3,u),a(e,9,4,3,3,u),p(e,5,5,k),p(e,10,5,k),p(e,5,6,v),p(e,10,6,v),a(e,5,8,6,1,m),p(e,4,8,f),p(e,11,8,f),p(e,5,9,f),p(e,10,9,f),a(e,2,10,12,12,m),a(e,2,10,12,1,f),a(e,2,10,1,12,f),a(e,13,10,1,12,u),a(e,4,10,8,11,k),a(e,4,10,8,1,v),a(e,4,10,1,11,v),p(e,3,10,v),p(e,12,10,v),a(e,0,11,2,8,m),a(e,0,11,1,8,f),a(e,14,11,2,8,m),a(e,15,11,1,8,f),a(e,0,18,2,3,v),a(e,14,18,2,3,v),a(e,0,19,2,1,k),a(e,14,19,2,1,k),a(e,3,22,4,2,m),a(e,9,22,4,2,m),a(e,3,22,2,1,f),a(e,9,22,2,1,f)},scholar:e=>{a(e,4,0,8,3,u),a(e,8,0,1,3,v),a(e,3,1,10,2,u),a(e,3,3,10,8,k),a(e,2,4,12,6,k),a(e,3,3,1,8,f),a(e,12,3,1,8,u),a(e,2,4,1,6,f),a(e,13,4,1,6,u),a(e,3,5,4,3,u),a(e,9,5,4,3,u),a(e,4,5,2,3,v),a(e,10,5,2,3,v),p(e,4,6,k),p(e,10,6,k),a(e,7,6,2,1,u),p(e,5,6,m),p(e,11,6,m),a(e,6,9,4,1,m),p(e,5,9,f),p(e,10,9,f),a(e,2,11,12,11,f),a(e,2,11,12,1,v),a(e,2,11,1,11,v),a(e,13,11,1,11,u),a(e,4,13,8,8,m),a(e,4,13,8,1,f),a(e,4,13,1,8,f),a(e,11,13,1,8,u);for(let o=0;o<3;o++)a(e,5,14+o*2,6,1,v);a(e,2,13,2,8,f),a(e,12,13,2,8,f),a(e,3,22,4,2,m),a(e,9,22,4,2,m)},blacksmith:e=>{a(e,3,0,10,2,u),a(e,2,2,12,8,k),a(e,1,3,14,6,k),a(e,2,2,1,8,f),a(e,13,2,1,8,u),a(e,1,3,1,6,f),a(e,14,3,1,6,u),a(e,3,3,5,2,m),a(e,8,3,5,2,m),a(e,4,5,3,2,u),a(e,9,5,3,2,u),p(e,5,5,m),p(e,10,5,m),a(e,3,9,10,1,v),a(e,6,6,1,4,v),a(e,1,10,14,13,m),a(e,1,10,14,1,f),a(e,1,10,1,13,f),a(e,14,10,1,13,u),a(e,3,10,10,13,u),a(e,3,10,10,1,m),a(e,3,10,1,13,m),a(e,4,13,3,2,f),a(e,9,13,3,2,f),a(e,0,10,1,10,f),a(e,15,10,1,10,f),a(e,13,14,3,2,u),a(e,14,16,1,6,m),a(e,13,14,1,2,m),a(e,15,14,1,2,f),a(e,2,22,5,2,u),a(e,9,22,5,2,u),a(e,2,22,2,2,m),a(e,9,22,2,2,m)},spirit:e=>{D(e,4,0,8,3,"rgba(0,0,0,0)",m,.3),a(e,3,3,10,8,"rgba(112,112,112,0.7)"),a(e,2,4,12,6,"rgba(112,112,112,0.75)"),a(e,4,5,4,4,u),a(e,8,5,4,4,u),p(e,5,7,m),p(e,6,7,m),p(e,9,7,m),p(e,10,7,m),p(e,5,6,v),p(e,10,6,v),a(e,5,9,6,1,u),D(e,3,11,10,5,"rgba(0,0,0,0)",f,.65),D(e,4,14,8,5,"rgba(0,0,0,0)",f,.5),D(e,0,12,3,5,"rgba(0,0,0,0)",m,.5),D(e,13,12,3,5,"rgba(0,0,0,0)",m,.5)},survivor:e=>{a(e,4,0,8,3,m);for(let o=0;o<5;o++)p(e,4+o,o%2,u);a(e,3,1,10,2,u),a(e,3,2,10,8,k),a(e,2,3,12,6,k),a(e,3,2,1,8,f),a(e,12,2,1,8,u),a(e,2,3,1,6,f),a(e,13,3,1,6,u),a(e,4,4,3,3,u),a(e,9,4,3,3,u),p(e,5,5,m),p(e,10,5,m),a(e,4,7,2,1,m),a(e,9,7,2,1,m),p(e,3,6,f),p(e,12,6,f),a(e,6,8,4,1,u),p(e,5,8,m),p(e,10,8,m),a(e,2,10,12,12,m),a(e,2,10,12,1,f),a(e,2,10,1,12,f),a(e,13,10,1,12,u),a(e,6,12,2,2,u),a(e,10,16,2,3,u),a(e,4,20,2,2,u),a(e,0,12,2,4,k),a(e,14,12,2,4,k),a(e,3,22,4,2,u),a(e,9,22,4,2,u)}};function Xo(e,o=2){const n=ge(16,24),s=n.getContext("2d");s.imageSmoothingEnabled=!1,s.clearRect(0,0,16,24),(yt[e]||yt.neighbor)(s);const l=ge(16*o,24*o),c=l.getContext("2d");return c.imageSmoothingEnabled=!1,c.drawImage(n,0,0,16*o,24*o),l}let je=12345;function z(){return je=je*1664525+1013904223&2147483647,je/2147483647}const vt={void_scout:e=>{D(e,8,0,16,32,u,m,.6),a(e,10,2,12,10,m),a(e,10,2,12,1,f),a(e,10,2,1,10,f),a(e,21,2,1,10,u),a(e,11,4,4,4,u),a(e,17,4,4,4,u),a(e,12,4,2,4,m),a(e,18,4,2,4,m),p(e,12,6,v),p(e,19,6,v),D(e,9,12,14,12,u,m,.75),a(e,11,12,10,10,m),a(e,11,12,10,1,f),a(e,11,12,1,10,f),a(e,6,14,5,3,m),a(e,6,14,2,3,u);for(let o=0;o<4;o++)a(e,3+o,16+o%2,2,3,u);a(e,21,14,5,3,m),a(e,24,14,2,3,u);for(let o=0;o<4;o++)a(e,27-o,16+o%2,2,3,u);for(let o=0;o<8;o++)p(e,Math.floor(z()*24)+4,Math.floor(z()*24)+4,z()<.5?f:v);D(e,10,22,12,8,m,u,.6)},glitch:e=>{a(e,4,4,24,24,m),a(e,4,4,24,1,f),a(e,4,4,1,24,f),a(e,27,4,1,24,u),a(e,6,6,20,20,f);for(let o=0;o<5;o++){const i=8+o*4,t=4+Math.floor(z()*6);a(e,t,i,20-Math.floor(z()*8),2,z()<.5?u:v)}a(e,8,10,6,4,u),a(e,18,10,6,4,u),a(e,9,10,4,4,m),a(e,19,10,4,4,m),p(e,10,12,k),p(e,11,12,k),p(e,20,12,k),p(e,21,12,k);for(let o=0;o<12;o++)a(e,4+Math.floor(z()*22),4+Math.floor(z()*22),2,2,z()<.5?u:k);a(e,10,18,12,2,u);for(let o=10;o<22;o+=3)p(e,o,18,m);a(e,7,22,18,4,u),p(e,8,23,f),p(e,9,23,f),p(e,11,23,f),p(e,15,23,f)},void_heavy:e=>{a(e,4,0,24,32,m),a(e,4,0,24,1,f),a(e,4,0,1,32,f),a(e,27,0,1,32,u),a(e,6,0,20,8,u),a(e,5,2,22,6,m),a(e,7,3,18,3,u),a(e,8,3,5,2,m),a(e,16,3,5,2,m),p(e,8,4,f),p(e,9,4,f),p(e,16,4,f),p(e,17,4,f),a(e,10,8,12,3,m),a(e,10,8,12,1,f),a(e,5,11,22,14,f),a(e,5,11,22,1,v),a(e,5,11,1,14,v),a(e,26,11,1,14,u),a(e,7,13,18,10,m),a(e,7,13,18,1,v),a(e,7,13,1,10,v),a(e,24,13,1,10,u),a(e,14,15,4,8,u),a(e,11,18,10,3,u),a(e,14,15,2,8,m),a(e,11,18,5,2,m),a(e,1,10,5,7,m),a(e,1,10,3,7,f),a(e,26,10,5,7,m),a(e,29,10,3,7,f),a(e,2,17,4,8,m),a(e,2,17,2,8,f),a(e,26,17,4,8,m),a(e,28,17,2,8,f),a(e,1,24,5,4,u),a(e,26,24,5,4,u),a(e,1,24,3,4,m),a(e,26,24,3,4,m),a(e,6,25,8,6,m),a(e,18,25,8,6,m),a(e,6,25,5,6,f),a(e,18,25,5,6,f),a(e,5,30,10,2,u),a(e,17,30,10,2,u)},wraith:e=>{D(e,6,0,20,4,u,m,.5),a(e,8,2,16,8,m),a(e,8,2,16,1,f),a(e,8,2,1,8,f),a(e,23,2,1,8,u),a(e,9,3,14,8,u),a(e,10,3,12,7,m),a(e,10,5,5,4,u),a(e,17,5,5,4,u),a(e,11,5,3,4,m),a(e,18,5,3,4,m),p(e,12,7,v),p(e,13,7,v),p(e,19,7,v),p(e,20,7,v),a(e,10,9,12,2,u);for(let o=10;o<22;o+=2)a(e,o,9,1,2,m);a(e,7,11,18,8,m),a(e,7,11,18,1,f),a(e,7,11,1,8,f),D(e,8,14,16,4,m,u,.4),D(e,9,18,14,5,m,u,.6),D(e,10,22,12,5,u,m,.7),D(e,11,26,10,4,u,"rgba(0,0,0,0)",.7),a(e,2,12,6,4,m),D(e,2,14,6,4,m,u,.5),a(e,24,12,6,4,m),D(e,24,14,6,4,m,u,.5);for(let o=0;o<5;o++)D(e,10+o*2,28,2,3,u,"rgba(0,0,0,0)",.5)},guardian:e=>{a(e,2,0,28,32,m),a(e,2,0,28,1,f),a(e,2,0,1,32,f),a(e,29,0,1,32,u),a(e,6,0,20,8,f),a(e,6,0,20,1,v),a(e,6,0,1,8,v),a(e,25,0,1,8,u);for(let o=0;o<6;o++)a(e,7+o*3,2,2,1,v);a(e,8,2,6,5,u),a(e,18,2,6,5,u),a(e,9,2,4,5,m),a(e,19,2,4,5,m),p(e,10,4,k),p(e,11,4,k),p(e,20,4,k),p(e,21,4,k),p(e,10,5,v),p(e,11,5,v),p(e,20,5,v),p(e,21,5,v),a(e,4,8,24,16,f),a(e,4,8,24,1,v),a(e,4,8,1,16,v),a(e,27,8,1,16,u),a(e,6,10,20,12,m),a(e,6,10,20,1,v),a(e,6,10,1,12,v),[[8,12],[18,12],[13,16],[8,20],[18,20]].forEach(([o,i])=>{a(e,o,i,4,1,v),a(e,o+1,i-1,2,3,v),p(e,o,i-1,f),p(e,o+3,i-1,f)}),a(e,12,14,8,6,u),a(e,13,15,6,4,k),a(e,14,15,4,4,v),a(e,15,16,2,2,k),D(e,12,14,8,1,u,v,.5),a(e,0,8,4,14,m),a(e,0,8,3,14,f),a(e,28,8,4,14,m),a(e,30,8,2,14,f),a(e,0,21,5,5,f),a(e,0,21,3,5,v),a(e,27,21,5,5,f),a(e,29,21,3,5,v),a(e,6,24,9,8,f),a(e,6,24,6,8,m),a(e,17,24,9,8,f),a(e,17,24,6,8,m),a(e,5,30,11,2,v),a(e,16,30,11,2,v)},golem:e=>{a(e,4,4,24,24,f),a(e,4,4,24,1,v),a(e,4,4,1,24,v),a(e,27,4,1,24,u);for(let o=4;o<28;o+=4)a(e,4,o,24,1,m);for(let o=4;o<28;o+=4)a(e,o,4,1,24,m);a(e,8,8,16,10,m),a(e,8,8,16,1,f),a(e,8,8,1,10,f),a(e,23,8,1,10,u),a(e,9,10,5,5,u),a(e,18,10,5,5,u),a(e,10,10,3,5,v),a(e,19,10,3,5,v),a(e,10,11,2,3,k),a(e,19,11,2,3,k),a(e,10,17,12,2,u);for(let o=10;o<22;o+=2)p(e,o,17,m);a(e,1,4,4,6,f),a(e,1,4,3,6,v),a(e,27,4,4,6,f),a(e,29,4,2,6,v),a(e,0,9,5,12,m),a(e,0,9,3,12,f),a(e,27,9,5,12,m),a(e,29,9,2,12,f),a(e,0,20,6,6,f),a(e,0,20,4,6,v),a(e,26,20,6,6,f),a(e,28,20,4,6,v),a(e,7,27,7,4,f),a(e,7,27,5,4,v),a(e,18,27,7,4,f),a(e,18,27,5,4,v)},commander:e=>{for(let o=0;o<6;o++){const i=6+o*4,t=4-o%2*3;a(e,i,t,2,6-t,m),p(e,i,t,v),p(e,i+1,t,f)}a(e,6,5,20,4,m),a(e,6,5,20,1,f),a(e,6,5,1,4,f),a(e,25,5,1,4,u),a(e,8,8,16,8,m),a(e,8,8,16,1,f),a(e,8,8,1,8,f),a(e,23,8,1,8,u),a(e,10,10,4,3,u),a(e,18,10,4,3,u),p(e,11,11,k),p(e,12,11,k),p(e,19,11,k),p(e,20,11,k),p(e,11,12,v),p(e,12,12,v),p(e,19,12,v),p(e,20,12,v),a(e,11,14,10,2,u),a(e,11,14,10,1,m),a(e,6,16,20,14,m),a(e,6,16,20,1,f),a(e,6,16,1,14,f),a(e,25,16,1,14,u),a(e,9,17,14,8,f),a(e,9,17,14,1,v),a(e,9,17,1,8,v),a(e,11,19,10,4,m),a(e,12,19,8,1,v);for(let o=0;o<3;o++)p(e,12+o*3,20,k);a(e,2,15,5,6,m),a(e,2,15,3,6,f),a(e,25,15,5,6,m),a(e,28,15,2,6,f),a(e,1,16,4,15,f),D(e,0,20,4,11,f,m,.5),a(e,27,16,4,15,f),D(e,28,20,4,11,f,m,.5),a(e,10,24,12,4,u),a(e,10,24,12,1,m);for(let o=0;o<4;o++)p(e,11+o*3,25,v);a(e,8,29,6,3,u),a(e,18,29,6,3,u),a(e,8,29,4,3,m),a(e,18,29,4,3,m)},nullbyte:e=>{D(e,0,0,32,32,u,m,.65),a(e,3,2,26,28,m),a(e,3,2,26,2,f),a(e,3,2,2,28,f),a(e,28,2,1,28,u);for(let o=0;o<25;o++)p(e,Math.floor(z()*24)+4,Math.floor(z()*24)+3,z()<.6?f:v);a(e,5,4,6,5,u),a(e,13,3,6,6,u),a(e,21,4,6,5,u),a(e,6,5,4,3,m),a(e,7,5,2,3,f),p(e,7,6,k),p(e,8,6,k),a(e,14,4,4,4,m),a(e,15,4,2,4,f),p(e,15,5,k),p(e,16,5,k),a(e,22,5,4,3,m),a(e,23,5,2,3,f),p(e,23,6,k),p(e,24,6,k),a(e,10,9,4,4,u),a(e,11,9,2,4,m),p(e,11,11,k),a(e,5,14,22,10,u),a(e,6,15,20,1,m);for(let o=5;o<27;o+=3)a(e,o,14,2,4,f),a(e,o+1,14,1,4,v);for(let o=6;o<26;o+=3)a(e,o,20,2,4,f),a(e,o+1,21,1,3,v);a(e,0,6,4,4,m),D(e,0,8,4,5,m,u,.55),a(e,28,6,4,4,m),D(e,28,8,4,5,m,u,.55),a(e,0,14,3,5,m),D(e,0,17,3,5,m,u,.65),a(e,29,14,3,5,m),D(e,29,17,3,5,m,u,.65),a(e,4,24,24,6,u),[[5,25],[5,26],[5,27],[5,28],[6,28],[7,25],[7,26],[7,27],[7,28],[9,25],[9,28],[10,28],[11,25],[11,28],[13,25],[13,26],[13,27],[13,28],[14,28],[15,25],[15,28],[17,25],[17,26],[17,27],[18,25],[19,26],[19,27],[19,28]].forEach(([o,i])=>p(e,o,i,k)),a(e,12,14,8,8,u),a(e,13,15,6,6,m),a(e,14,16,4,4,f),a(e,15,17,2,2,k)}};function Uo(e){je=12345+((e||"").charCodeAt(0)||0)*7;const o=32,i=32,t=2,n=ge(o,i),s=n.getContext("2d");s.imageSmoothingEnabled=!1,s.clearRect(0,0,o,i),(vt[e]||vt.void_scout)(s);const l=ge(o*t,i*t),c=l.getContext("2d");return c.imageSmoothingEnabled=!1,c.drawImage(n,0,0,o*t,i*t),l}const Ko=no,jo=4,M=Ko*jo,r={collection:[],party:[],demo:!1,mapId:"home",mapData:null,px:4,py:7,facing:"down",walkFrame:0,walkTimer:0,moving:!1,camX:0,camY:0,save:{gold:0,inventory:{potion:3},quests:{},activeQuests:[],completedQuests:[],voidSteps:0,antivoidSteps:0,steps:0,battlesWon:0,journal:[],talkedTo:{},visitedMaps:{},flags:{}},screen:"title",fadeAlpha:0,fadeDir:0,fadeCallback:null,dlg:null,battle:null,menu:null,playerSprite:null,npcSprites:{},enemySprites:{},battleSprites:{},npcSpriteBuilt:{},keys:{},moveCooldown:0,interactPressed:!1,menuPressed:!1,encounterCooldown:0,questNotif:null,itemNotif:null,batAnim:null};function Nt(){Object.entries(te).forEach(([e,o])=>{r.save.quests[e]={id:e,steps:o.steps.map(i=>({...i})),complete:!1}})}let Y=null,P=0,W=0,se=null,bt=0,Te=null,Ie=null,X=null,Xe=null,Pe=null,we=null;const it={},Z={};let K=null,ce=null,wt=null,ie=null,re=null,me=null,x=null;const Et={home:[1.05,1,.9,0],home_up:[1.05,1,.9,0],home_down:[1.04,1,.88,0],overworld:[1,1.02,.95,0],town:[1.02,1,1,0],cave:[.7,.8,1.1,0],void_lands:[.75,.7,1.1,0],citadel:[.6,.6,1.15,0]};let Ee=null;function Zo(){const e=document.getElementById("world-canvas");P=window.innerWidth,W=window.innerHeight,Y=new PIXI.Application({width:P,height:W,backgroundColor:1710876,antialias:!1,resolution:window.devicePixelRatio||1,autoDensity:!0}),e.parentNode.replaceChild(Y.view,e),Y.view.id="world-canvas",Te=new PIXI.Container,Ie=new PIXI.Container,Xe=new PIXI.Container,X=new PIXI.Container,Pe=new PIXI.Container,we=new PIXI.Container,Y.stage.addChild(Te),Y.stage.addChild(Ie),Y.stage.addChild(Xe),Y.stage.addChild(X),Y.stage.addChild(Pe),Y.stage.addChild(we),Ee=new PIXI.ColorMatrixFilter,Te.filters=[Ee],Ie.filters=[Ee],Xe.filters=[Ee],X.filters=[Ee],wt=new PIXI.Graphics,Pe.addChild(wt),x=new PIXI.Graphics,x.beginFill(0,1),x.drawRect(0,0,P,W),x.endFill(),x.alpha=0,we.addChild(x),me=new PIXI.Graphics,re=new PIXI.Text("",{fontFamily:"Space Mono, monospace",fontSize:11,fontWeight:"bold",fill:14935524}),re.anchor.set(.5,.5),we.addChild(me),we.addChild(re),ie=new PIXI.Text("",{fontFamily:"Space Mono, monospace",fontSize:9,fill:14935524}),ie.anchor.set(1,0),we.addChild(ie),ce=new PIXI.Graphics,Xe.addChild(ce),window.addEventListener("resize",Qo),Y.ticker.stop()}function Qo(){P=window.innerWidth,W=window.innerHeight,Y&&(Y.renderer.resize(P,W),x&&(x.clear(),x.beginFill(0,1),x.drawRect(0,0,P,W),x.endFill()))}const Ot=new Set([16,19]);function St(e){const o=Ao(e);if(!o)return null;if(Ot.has(e)){const n=PIXI.Texture.from(o);return n.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,n}const i=o.src||o.currentSrc||o.tagName+e;if(it[i])return it[i];const t=PIXI.Texture.from(o);return t.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,it[i]=t,t}const Jo=new Set([11,12,13,4,1,20,18]);function zo(){window.addEventListener("keydown",e=>{r.keys[e.code]=!0,(e.code==="KeyE"||e.code==="Enter"||e.code==="Space")&&(r.interactPressed=!0),(e.code==="KeyI"||e.code==="Escape"||e.code==="KeyM")&&(r.menuPressed=!0)}),window.addEventListener("keyup",e=>{r.keys[e.code]=!1}),document.addEventListener("click",e=>{r.screen==="game"&&(e.target.closest("#dialogue, #battle, #menu-overlay, #shop, #hud, #zone-bar")||(r.interactPressed=!0))})}function Dt(e,o,i){r.mapId=e,r.mapData=Vo[e](),r.px=o!==void 0?o:Se[e].x,r.py=i!==void 0?i:Se[e].y,r.encounterCooldown=8,r.save.visitedMaps[e]=!0;for(const t in pe){const n=pe[t];n.ground&&(Te.removeChild(n.ground),n.ground.destroy()),n.object&&(Ie.removeChild(n.object),n.object.destroy()),delete pe[t]}for(const t in Z){const n=Z[t];n.spr&&X.removeChild(n.spr),n.label&&X.removeChild(n.label),n.labelBg&&X.removeChild(n.labelBg),delete Z[t]}ze.filter(t=>t.mapId===e).forEach(t=>{r.npcSpriteBuilt[t.id]||(r.npcSprites[t.id]=Xo(t.sprite,2),r.npcSpriteBuilt[t.id]=!0)}),e==="cave"&&ue("ch2_cave","enter_cave"),e==="citadel"&&ue("ch3_void_march","reach_citadel"),e==="town"&&ue("ch1_find_oracle","reach_town"),e==="void_lands"&&ue("ch3_void_march","cross_void"),e==="home_down"&&ue("prologue_home","go_downstairs")}function Be(e,o,i){_t(1,()=>{Dt(e,o,i),_t(-1,null)})}function _t(e,o){r.fadeDir=e,r.fadeCallback=o,e>0?r.fadeAlpha=0:r.fadeAlpha=1}function xo(e){r.fadeDir!==0&&(r.fadeAlpha+=r.fadeDir*e*.005,r.fadeDir>0&&r.fadeAlpha>=1?(r.fadeAlpha=1,r.fadeDir=0,r.fadeCallback&&(r.fadeCallback(),r.fadeCallback=null)):r.fadeDir<0&&r.fadeAlpha<=0&&(r.fadeAlpha=0,r.fadeDir=0))}function ue(e,o,i=1){const t=r.save.quests[e];if(!t||t.complete||!r.save.activeQuests.includes(e))return!1;const n=t.steps.find(s=>s.id===o);if(!n||n.done)return!1;if(n.target!==void 0){n.progress=Math.min(n.target,(n.progress||0)+i);const s=te[e].steps.find(l=>l.id===o).text;n.text=s.replace(/\(\d+\/\d+\)/,`(${n.progress}/${n.target})`),n.progress>=n.target&&(n.done=!0)}else n.done=!0;if(t.steps.every(s=>s.done)){t.complete=!0,r.save.completedQuests.push(e),r.save.activeQuests=r.save.activeQuests.filter(l=>l!==e);const s=te[e];s.reward&&(s.reward.gold&&(r.save.gold+=s.reward.gold),(s.reward.items||[]).forEach(l=>tt(l,1))),Je(`Quest Complete: ${te[e].name}`),De(`[Quest Complete] ${te[e].name}`),en(e)}else n.done&&Je(n.text);return J(),!0}function et(e){r.save.activeQuests.includes(e)||r.save.completedQuests.includes(e)||(r.save.activeQuests.push(e),Je(`New Quest: ${te[e].name}`),De(`[New Quest] ${te[e].name}: ${te[e].desc}`),J())}function en(e){({prologue_home:["prologue_outside"],prologue_outside:["ch1_soldier"],ch1_soldier:["ch1_find_oracle"],ch1_find_oracle:["ch1_bit_shards"],ch1_bit_shards:["ch2_cave"],ch2_cave:["ch3_void_march"],ch3_void_march:["ch3_upgrade"],ch3_upgrade:["finale"]}[e]||[]).forEach(et)}function tt(e,o=1){r.save.inventory[e]=(r.save.inventory[e]||0)+o;const i=He[e];i&&Ce(`Got: ${i.icon} ${i.name}`)}function ct(e){return(r.save.inventory[e]||0)>0}function Je(e){r.questNotif={text:e,timer:220}}function Ce(e){r.itemNotif={text:e,timer:180}}function De(e){const o=`Step ${r.save.steps}`;r.save.journal.unshift(`${o}: ${e}`),r.save.journal.length>60&&r.save.journal.pop()}function tn(e){var _;if(r.dlg||r.battle||r.menu||r.fadeDir||(r.moveCooldown-=e,r.moveCooldown>0))return;let o=0,i=0;if(r.keys.ArrowLeft||r.keys.KeyA)o=-1,r.facing="left";else if(r.keys.ArrowRight||r.keys.KeyD)o=1,r.facing="right";else if(r.keys.ArrowUp||r.keys.KeyW)i=-1,r.facing="up";else if(r.keys.ArrowDown||r.keys.KeyS)i=1,r.facing="down";else{r.moving=!1;return}const t=r.px+o,n=r.py+i,{tiles:s,w:l,h:c}=r.mapData;if(t<0||n<0||t>=l||n>=c)return;const g=s[n][t];if(Go(g)){r.moving=!1;return}const h=ke[r.mapId];if(h!=null&&h.connections){for(const I of h.connections)if(t===I.triggerX&&n===I.triggerY){if(I.destMap==="cave"&&!ct("render_key")&&!r.save.completedQuests.includes("ch1_bit_shards")){Ne("CAVE ENTRANCE",["The cave entrance is sealed with ancient render-code.","It can only be opened with a Render Key.","Defeat 3 Void Scouts in the plains and bring their Pixel Shards to the Oracle."]);return}Be(I.destMap,I.destX,I.destY),r.moveCooldown=300;return}}if(r.mapId==="home_up"&&g===d.STAIRS_DN){Be("home_down",Se.home_down.x,Se.home_down.y),r.moveCooldown=400;return}if(r.mapId==="home_down"){if(g===d.DOOR){ue("prologue_outside","leave_home"),Be("overworld",16,23),r.moveCooldown=400;return}if(g===d.STAIRS_DN){Be("home_up",Se.home_up.x,Se.home_up.y),r.moveCooldown=400;return}}if(r.mapId==="home"&&g===d.DOOR){Be("overworld",16,23),r.moveCooldown=400;return}if(r.px=t,r.py=n,r.moving=!0,r.moveCooldown=110,r.save.steps++,r.encounterCooldown=Math.max(0,r.encounterCooldown-1),(_=ke[r.mapId])!=null&&_.voidDamage&&(g===d.VOID||g===d.DARK_GRASS)&&(r.save.antivoidSteps>0?r.save.antivoidSteps--:(r.save.voidSteps++,r.save.voidSteps%4===0&&(r.party.filter(I=>I.alive).forEach(I=>{const B=Math.max(1,Math.floor(I.maxHp*.04));I.hp=Math.max(1,I.hp-B)}),Ce("VOID DRAIN: -4% HP"),J()))),[d.GRASS0,d.GRASS1,d.GRASS2,d.DARK_GRASS,d.VOID,d.CAVE_FLOOR].includes(g)&&r.encounterCooldown===0){const I=ke[r.mapId],B=(I==null?void 0:I.encounterRate)||0,O=g===d.DARK_GRASS||g===d.VOID?1.4:1;if(Math.random()<B*O){r.encounterCooldown=22,dn();return}}on(e),J()}function on(e){r.walkTimer+=e,r.walkTimer>100&&(r.walkFrame=(r.walkFrame+1)%8,r.walkTimer=0),r.playerSprite&&r.playerSprite.render(r.moving?r.walkFrame:0)}function nn(){var o,i;if(!r.interactPressed||(r.interactPressed=!1,r.battle))return;if(r.menu){ht();return}if(r.dlg){Wt();return}const e=[[0,0],[0,-1],[0,1],[-1,0],[1,0]];for(const[t,n]of e){const s=r.px+t,l=r.py+n,c=ze.find(g=>g.mapId===r.mapId&&g.x===s&&g.y===l);if(c){an(c);return}}for(const[t,n]of e){const s=r.px+t,l=r.py+n;if(((i=(o=r.mapData)==null?void 0:o.tiles[l])==null?void 0:i[s])===d.SIGN){Ne("SIGNPOST",[r.mapId==="overworld"?`← Your Home   |   → Pixel Town
Stay on the path.
Void Scouts in the dark grass.`:r.mapId==="town"?`↑ Oracle (N)  |  ↓ Cave Path (S)
← Overworld   |  → Shop / Library`:"You are deep in the Grid. Be careful."]);return}}}function an(e){r.save.talkedTo[e.id]=(r.save.talkedTo[e.id]||0)+1;const o=r.save.talkedTo[e.id]%e.lines.length,i=[e.lines[o]];if(e.inn&&(r.party.forEach(t=>{t.hp=t.maxHp,t.mp=t.maxMp,t.alive=!0}),De(`Rested at ${e.name}`),J(),i.push("All Normies fully restored.")),e.shop){Ne(e.name,i,r.npcSprites[e.id],()=>sn(e));return}if(e.giftItem&&!r.save.flags[`gift_${e.id}`]&&(r.save.flags[`gift_${e.id}`]=!0,tt(e.giftItem,1)),e.questTrigger){const t=e.questTrigger;if(t.stepComplete){const n=r.save.activeQuests.find(s=>{const l=r.save.quests[s];return l&&l.steps.some(c=>c.id===t.stepComplete)})||Object.keys(r.save.quests).find(s=>{var l;return(l=r.save.quests[s])==null?void 0:l.steps.some(c=>c.id===t.stepComplete)});n&&ue(n,t.stepComplete)}t.start&&et(t.start)}Ne(e.name,i,r.npcSprites[e.id])}function Ne(e,o,i=null,t=null){r.dlg={speaker:e,lines:Array.isArray(o)?o:[o],lineIdx:0,portrait:i,onClose:t},$t()}function Wt(){if(r.dlg)if(r.dlg.lineIdx++,r.dlg.lineIdx>=r.dlg.lines.length){const e=r.dlg.onClose;r.dlg=null,document.getElementById("dialogue").classList.add("hidden"),e&&e()}else $t()}function $t(){if(!r.dlg)return;document.getElementById("dialogue").classList.remove("hidden"),document.getElementById("dlg-speaker").textContent=r.dlg.speaker,document.getElementById("dlg-text").textContent=r.dlg.lines[r.dlg.lineIdx],document.getElementById("dlg-page").textContent=r.dlg.lines.length>1?`${r.dlg.lineIdx+1}/${r.dlg.lines.length}`:"";const o=document.getElementById("dlg-portrait");if(r.dlg.portrait){o.innerHTML="";const i=document.createElement("canvas");i.width=40,i.height=40;const t=i.getContext("2d");t.imageSmoothingEnabled=!1,t.drawImage(r.dlg.portrait,0,0,40,40),o.appendChild(i),o.style.display="block"}else o.style.display="none"}const rn={potion:12,antivoid:18,full_render:60};function sn(e){document.getElementById("shop").classList.remove("hidden");const i=document.getElementById("shop-items");i.innerHTML="",(e.shopInventory||[]).forEach(t=>{const n=He[t];if(!n)return;const s=rn[t]||15,l=document.createElement("div");l.className="shop-row",l.innerHTML=`<span class="shop-icon">${n.icon}</span>
      <span class="shop-name">${n.name}</span>
      <span class="shop-desc">${n.desc}</span>
      <span class="shop-price">${s}G</span>
      <button class="btn-buy" data-item="${t}" data-price="${s}">Buy</button>`,i.appendChild(l)}),document.getElementById("shop-gold").textContent=r.save.gold,document.querySelectorAll(".btn-buy").forEach(t=>{t.onclick=()=>{const n=t.dataset.item,s=parseInt(t.dataset.price);r.save.gold>=s?(r.save.gold-=s,tt(n,1),document.getElementById("shop-gold").textContent=r.save.gold,J(),Ce(`Bought: ${He[n].name} for ${s}G`)):Ce("Not enough Gold.")}})}function ln(){const e=ke[r.mapId];if(!(e!=null&&e.subZones))return((e==null?void 0:e.encounterRate)||0)>.2?2:0;for(const o of e.subZones)if(r.px>=o.x0&&r.px<o.x1&&r.py>=o.y0&&r.py<o.y1)return o.tier;return e.id==="cave"?2:e.id==="void_lands"?3:e.id==="citadel"?4:0}const kt=[["void_scout","glitch_sprite"],["void_soldier","bit_wraith"],["cave_crawler","cave_guardian"],["void_hulk","null_specter"],["void_elite","void_commander"],["nullbyte"]];function dn(e){const o=ln(),i=kt[Math.min(o,kt.length-1)],t=i[Math.floor(Math.random()*i.length)],n=Bo[t],l=.5+(r.party.filter(h=>h.alive).length||1)*.1+o*.08,c={...n,maxHp:Math.round(n.hpBase*l),hp:Math.round(n.hpBase*l),atk:Math.round(n.atkBase*l),animX:0,shakeTimer:0,flashTimer:0};r.enemySprites[t]||(r.enemySprites[t]=Uo(n.sprite||t,t.length*37+o)),r.party.forEach(h=>{r.battleSprites[h.id]||(r.battleSprites[h.id]=Ht(h.pixels))});const g=[...r.party.filter(h=>h.alive).map(h=>({...h,isPlayer:!0,animX:0,flashTimer:0})),{...c,isEnemy:!0}].sort((h,E)=>E.spd-h.spd);r.battle={enemy:c,fighters:g,turn:0,round:1,over:!1,result:null,log:[],animQueue:[],animPlaying:!1,actionLocked:!1},n.preText&&r.battle.log.push({text:n.preText,cls:"log-lore"}),r.battle.log.push({text:`${c.name} appeared!`,cls:"log-em"}),r.battle.log.push({text:n.lore,cls:"log-lore"}),De(`Encountered: ${c.name}`),cn()}function cn(){document.getElementById("battle").classList.remove("hidden"),document.getElementById("bat-result").classList.add("hidden"),document.getElementById("bat-main").classList.remove("hidden"),he(),Ft()}function he(){var B,O,$;if(!r.battle)return;const{enemy:e,fighters:o,turn:i}=r.battle,t=((B=ke[r.mapId])==null?void 0:B.name)||"";document.getElementById("bat-zone").textContent=t.toUpperCase();const n=document.getElementById("bat-round");n&&(n.textContent="Round "+r.battle.round);const s=document.getElementById("enemy-canvas"),l=r.enemySprites[e.id];s.width=72,s.height=72;const c=s.getContext("2d");c.imageSmoothingEnabled=!1,l&&c.drawImage(l,e.animX||0,0,72,72),e.flashTimer>0&&(c.globalAlpha=.5,c.fillStyle="#fff",c.fillRect(0,0,72,72),c.globalAlpha=1),document.getElementById("enemy-name").textContent=e.name,document.getElementById("enemy-hp-text").textContent=`${Math.max(0,e.hp)} / ${e.maxHp}`,document.getElementById("enemy-hp-bar").style.width=Math.max(0,e.hp/e.maxHp*100)+"%";const g=document.getElementById("bat-party");g.innerHTML="";const h=o[i];r.party.forEach(C=>{const H=(h==null?void 0:h.isPlayer)&&h.id===C.id,q=document.createElement("div");q.className="bnorm"+(C.alive?"":" dead")+(H?" active":""),q.id="bfighter_"+C.id;const oe=r.battleSprites[C.id];if(oe){const ee=document.createElement("canvas");ee.width=40,ee.height=40;const L=ee.getContext("2d");L.imageSmoothingEnabled=!1,L.drawImage(oe,0,0,40,40);const F=o.find(ne=>ne.isPlayer&&ne.id===C.id);(F==null?void 0:F.flashTimer)>0&&(L.globalAlpha=.6,L.fillStyle="#fff",L.fillRect(0,0,40,40),L.globalAlpha=1),q.appendChild(ee)}q.innerHTML+=`<div class="bnorm-name">#${C.id}</div>
      <div class="bnorm-type">${C.type}</div>
      <div class="bnorm-bar-wrap"><div class="bnorm-bar-hp" style="width:${Math.max(0,C.hp/C.maxHp*100)}%"></div></div>
      <div class="bnorm-bar-wrap"><div class="bnorm-bar-mp" style="width:${Math.max(0,C.mp/C.maxMp*100)}%"></div></div>
      <div class="bnorm-hp">${C.hp}/${C.maxHp}</div>`,g.appendChild(q)});const E=document.getElementById("bat-log");E.innerHTML="",r.battle.log.slice(-8).forEach(C=>{const H=document.createElement("div");H.className=C.cls||"log-normal",H.textContent=C.text,E.appendChild(H)}),E.scrollTop=E.scrollHeight;const _=o.find(C=>C.isPlayer&&C===o[i]),I=r.battle.actionLocked||!_||r.battle.over;if(["btn-atk","btn-skill","btn-ult","btn-bpot","btn-flee"].forEach(C=>{const H=document.getElementById(C);H&&(H.disabled=I)}),_){document.getElementById("btn-skill").disabled=I||_.mp<3,document.getElementById("btn-ult").disabled=I||_.mp<6,document.getElementById("btn-bpot").disabled=I||(r.save.inventory.potion||0)<=0;const C=document.getElementById("btn-flee");C&&(C.disabled=I||((O=r.battle.enemy)==null?void 0:O.tier)>=4),document.getElementById("bat-action-label").textContent=`${_.name} — ATK:${_.atkBasic} SKL:${_.atkSkill} ULT:${_.atkUltimate} | ${_.hp}/${_.maxHp}HP ${_.mp}/${_.maxMp}MP`}else document.getElementById("bat-action-label").textContent=($=o[r.battle.turn])!=null&&$.isEnemy?`${e.name} is acting…`:"—"}function Q(e,o="log-normal"){r.battle.log.push({text:e,cls:o}),r.battle.log.length>30&&r.battle.log.shift()}function Ze(e,o,i,t=.05,n=!1){const s=Math.max(1,o-Math.floor(i*(n?.4:.5))),l=Math.random()<t,c=Math.max(1,Math.round(s*(.85+Math.random()*.3)*(l?1.65:1)));return e.hp=Math.max(0,e.hp-c),e.flashTimer=8,fn(c,l,e.isEnemy),{dmg:c,crit:l}}function fn(e,o,i){const t=document.getElementById("arena"),n=document.createElement("div");n.className="fdmg"+(o?" crit-flash":""),n.textContent=(o?"★ ":"")+"-"+e,n.style.cssText=i?`right:${20+Math.random()*50}px;top:${10+Math.random()*40}px`:`left:${10+Math.random()*120}px;top:${10+Math.random()*40}px`,t.appendChild(n),setTimeout(()=>n.remove(),800)}window.__battleAction=function(e){if(!r.battle||r.battle.over||r.battle.actionLocked)return;const{fighters:o,turn:i,enemy:t}=r.battle,n=o[i];if(!n||!n.isPlayer)return;if(r.battle.actionLocked=!0,e==="flee"){if(t.tier>=4){Q(`${t.name} won't let you escape!`,"log-big"),r.battle.actionLocked=!1,he(),setTimeout(()=>{Qe()},600);return}const c=Math.max(.25,.7-(t.tier||0)*.1);Math.random()<c?(Q("Got away safely!","log-em"),r.encounterCooldown=18,setTimeout(()=>{r.battle=null,document.getElementById("battle").classList.add("hidden"),J()},800)):(Q("Can't escape!","log-big"),r.battle.actionLocked=!1,he(),setTimeout(()=>{r.battle.actionLocked=!1,!ft()&&Qe()},700));return}if(e==="attack"){const{dmg:l,crit:c}=Ze(t,n.atkBasic,t.def,n.crit);n.mp=Math.min(n.maxMp,n.mp+2),Q(`${n.name} attacks — ${l} dmg${c?" CRIT!":""}`,c?"log-crit":"log-normal")}else if(e==="skill"){if(n.mp<3){r.battle.actionLocked=!1;return}n.mp-=3;const l=ct("render_flame")&&t.tier>=1?1.15:1,{dmg:c,crit:g}=Ze(t,Math.floor(n.atkSkill*l),t.def,n.crit+.05);Q(`${n.name}: ${n.sk1} — ${c}${g?" CRIT!":""}!`,"log-em")}else if(e==="ult"){if(n.mp<6){r.battle.actionLocked=!1;return}n.mp-=6;const l=ct("render_flame")&&t.tier>=1?1.15:1,{dmg:c,crit:g}=Ze(t,Math.floor(n.atkUltimate*l),Math.floor(t.def*.4),n.crit+.15);Q(`${n.name}: ${n.sk2} — ${c}${g?" CRIT!!":"!!!"}`,"log-big")}else if(e==="potion"){if(!r.save.inventory.potion){r.battle.actionLocked=!1;return}r.save.inventory.potion--;const l=r.party.filter(c=>c.alive).sort((c,g)=>c.hp/c.maxHp-g.hp/g.maxHp)[0];if(l){const c=Math.floor(l.maxHp*.35);l.hp=Math.min(l.maxHp,l.hp+c),Q(`Potion → ${l.name} +${c}HP`)}}const s=o.find(l=>l.isPlayer&&l.id===n.id);s&&(s.mp=n.mp,s.hp=n.hp),setTimeout(()=>{r.battle.actionLocked=!1,!ft()&&Qe()},400),he()};function Ft(){if(!r.battle||r.battle.over)return;const e=r.battle.fighters[r.battle.turn];e&&e.isEnemy&&(r.battle.actionLocked=!0,he(),setTimeout(mn,900))}function mn(){if(!r.battle||r.battle.over)return;const{enemy:e,fighters:o}=r.battle,i=r.party.filter(E=>E.alive);if(!i.length)return;const t=i.sort((E,_)=>E.hp/E.maxHp-_.hp/_.maxHp)[0],n=e.moves[Math.floor(Math.random()*e.moves.length)],s=Math.random()<.25,l=s?Math.round(e.atk*1.6):e.atk,c=o.find(E=>E.isPlayer&&E.id===t.id),{dmg:g,crit:h}=Ze(t,l,t.def,.06);c&&(c.hp=t.hp),t.hp<=0&&(t.alive=!1),Q(`${e.name}: ${n} → ${t.name} ${g}${h?" CRIT!":""}`,s||h?"log-big":"log-normal"),setTimeout(()=>{r.battle.actionLocked=!1,!ft()&&Qe()},400),he()}function Qe(){if(!r.battle)return;const{fighters:e}=r.battle;let o=(r.battle.turn+1)%e.length;for(let i=0;i<e.length;i++){const t=e[o];if(t.isEnemy||t.isPlayer&&t.alive)break;o=(o+1)%e.length}o<=r.battle.turn&&r.battle.round++,r.battle.turn=o,e.forEach(i=>{i.flashTimer>0&&i.flashTimer--}),r.battle.enemy.flashTimer=Math.max(0,(r.battle.enemy.flashTimer||0)-1),he(),setTimeout(Ft,100)}function ft(){if(!r.battle)return!1;const{enemy:e}=r.battle;return e.hp<=0?(Tt("victory"),!0):r.party.some(o=>o.alive)?!1:(Tt("defeat"),!0)}function Tt(e){var i;r.battle.over=!0,r.battle.result=e;const{enemy:o}=r.battle;if(e==="victory"){const t=Math.round(12+Math.random()*18+o.tier*8);r.save.gold+=t,r.save.battlesWon++,Q(`${o.name} defeated! +${t}G`,"log-big"),De(`Defeated ${o.name} — +${t}G`);const n=o.xpReward||15+o.tier*20,s=[];if(r.party.filter(l=>l.alive).forEach(l=>{const c=Qt(l,n);c.length&&(s.push(...c.map(g=>`${l.name}: ${g}`)),l===r.party[0]&&(r.playerSprite=Pt(l.pixels),K&&(X.removeChild(K),K=null)))}),n>0&&Q(`+${n} XP`,"log-em"),s.forEach(l=>{Q(l,"log-big"),Je(l)}),o.dropItem&&Math.random()<(o.dropChance||.3)&&(tt(o.dropItem,1),Q(`Dropped: ${((i=He[o.dropItem])==null?void 0:i.name)||o.dropItem}`,"log-em")),o.questDrop){const{questId:l,stepId:c}=o.questDrop;ue(l,c,1)}if(r.party.filter(l=>l.alive).forEach(l=>{l.hp=Math.min(l.maxHp,l.hp+Math.floor(l.maxHp*.1)),l.mp=Math.min(l.maxMp,l.mp+Math.floor(l.maxMp*.2))}),r.party.filter(l=>!l.alive).forEach(l=>{l.alive=!0,l.hp=Math.max(1,Math.floor(l.maxHp*.05))}),o.finalBoss){setTimeout(()=>{r.battle=null,document.getElementById("battle").classList.add("hidden"),kn()},1500);return}setTimeout(It,600)}else Q("All Normies fell.","log-big"),r.party.forEach(t=>{t.alive=!0,t.hp=Math.max(1,Math.floor(t.maxHp*.08))}),setTimeout(It,600);he(),J()}function It(){document.getElementById("bat-main").classList.add("hidden"),document.getElementById("bat-result").classList.remove("hidden");const e=r.battle.result;document.getElementById("bat-result-title").textContent=e==="victory"?"VICTORY":"DEFEATED",document.getElementById("bat-result-sub").textContent=e==="victory"?`${r.battle.enemy.name} destroyed.`:"Normies fell. Rendered back at low HP.",document.getElementById("bat-result-gold").textContent=e==="victory"?`+${Math.round(12+r.battle.enemy.tier*8)}G`:"",J()}function un(){if(r.menuPressed&&(r.menuPressed=!1,!(r.battle||r.dlg))){if(r.menu){ht();return}Gt("inventory")}}function Gt(e){r.menu=e,document.getElementById("menu-overlay").classList.remove("hidden"),Vt(e),document.querySelectorAll(".menu-tab").forEach(o=>{o.classList.toggle("active",o.dataset.tab===e)})}function ht(){r.menu=null,document.getElementById("menu-overlay").classList.add("hidden"),document.getElementById("shop").classList.add("hidden")}function Vt(e){const o={inventory:"menu-inv",quests:"menu-quests",party:"menu-party",journal:"menu-journal"};Object.values(o).forEach(t=>{const n=document.getElementById(t);n&&(n.style.display="none")});const i=o[e];if(i){const t=document.getElementById(i);t&&(t.style.display="block")}e==="inventory"?qt():e==="journal"?hn():e==="party"?pn():e==="quests"&&yn()}function qt(){const e=document.getElementById("menu-inv");e.innerHTML="";let o=!1;Object.entries(r.save.inventory).forEach(([i,t])=>{if(!t)return;o=!0;const n=He[i];if(!n)return;const s=document.createElement("div");if(s.className="inv-row",s.innerHTML=`<span class="inv-icon">${n.icon}</span>
      <div class="inv-info">
        <div class="inv-name">${n.name} ×${t}</div>
        <div class="inv-desc">${n.desc}</div>
        ${n.passive?`<div class="inv-passive">◉ ${n.passive}</div>`:""}
      </div>`,n.use&&!n.questItem){const l=document.createElement("button");l.className="btn-use",l.textContent="Use",l.onclick=()=>{const c=n.use(r.party);c&&(r.save.inventory[i]=Math.max(0,t-1),Ce(c),J(),qt())},s.appendChild(l)}e.appendChild(s)}),o||(e.innerHTML='<div class="inv-empty">Your bag is empty.</div>'),document.getElementById("menu-gold").textContent=`◆ ${r.save.gold} Gold`}function hn(){const e=document.getElementById("menu-journal");if(e.innerHTML="",!r.save.journal.length){e.innerHTML='<div class="journal-empty">No entries yet. Your story is just beginning.</div>';return}r.save.journal.forEach(o=>{const i=document.createElement("div");i.className="journal-entry",i.textContent=o,e.appendChild(i)})}function pn(){const e=document.getElementById("menu-party");e.innerHTML="",r.party.forEach(o=>{const i=document.createElement("div");i.className="party-card";const t=r.battleSprites[o.id];let n="";if(t){const E=document.createElement("canvas");E.width=40,E.height=40;const _=E.getContext("2d");_.imageSmoothingEnabled=!1,_.drawImage(t,0,0,40,40),n=E.outerHTML}const s=o.xp||0,l=o.lv||1,c=o.xpToNext||100,g=Math.min(100,Math.round(s/c*100)),h=o.skillPoints||0;i.innerHTML=`${n}
      <div class="pc-info">
        <div class="pc-name">${o.name} <span class="pc-type">${o.type}</span></div>
        <div class="pc-level">Lv${l} · ${o.px}px · ${o.expression}</div>
        <div class="pc-level-bar">XP ${s}/${c}</div>
        <div class="pc-xp-bar"><div class="pc-xp-fill" style="width:${g}%"></div></div>
        ${h>0?`<div class="pc-sp">★ ${h} Skill Point${h>1?"s":""} available</div>`:""}
        <div class="pc-acc">${o.accessory!=="No Accessories"?o.accessory:"No Accessory"}</div>
        <div class="pc-stats">HP ${o.hp}/${o.maxHp} · MP ${o.mp}/${o.maxMp} · DEF ${o.def} · SPD ${o.spd} · CRIT ${Math.round(o.crit*100)}%</div>
        <div class="pc-moves">${o.sk1} (${o.atkSkill}dmg) · ${o.sk2} (${o.atkUltimate}dmg)</div>
        <div style="margin-top:6px"><button class="btn-use" data-id="${o.id}">Skill Tree →</button></div>
      </div>`,e.appendChild(i)}),e.querySelectorAll("[data-id]").forEach(o=>{o.onclick=i=>{i.stopPropagation();const t=r.party.find(n=>n.id===o.dataset.id);t&&Yt(t)}})}function Yt(e){const o=document.getElementById("skill-tree-modal");if(!o)return;o.classList.remove("hidden");const i=document.getElementById("st-normie-info"),t=e.lv||1;i.innerHTML=`<strong>#${e.id}</strong> &nbsp;${e.type} &nbsp;Lv${t} &nbsp;HP ${e.hp}/${e.maxHp} &nbsp;ATK ${e.atkBasic}`;const n=document.getElementById("st-points");function s(){n.textContent=`${e.skillPoints||0} SP`}s();const l=document.getElementById("st-branches");l.innerHTML="";const c=window.__SKILL_TREES||{},g=e.type||"Human",h=c[g]||c.Human||{};h.branches&&((h.branches||[]).forEach(E=>{const _=document.createElement("div");_.className="st-branch",_.innerHTML=`<div class="st-branch-name">${E.icon||""} ${E.name}</div>
      <div class="st-branch-desc">${E.desc||""}</div>`,(E.skills||[]).forEach((I,B)=>{const O=!!(e.unlockedSkills||{})[I.id],$=I.cost||1,C=(e.skillPoints||0)>=$,H=B===0||!!(e.unlockedSkills||{})[(E.skills[B-1]||{}).id],q=document.createElement("div");q.className="st-skill"+(O?" unlocked":" locked");const oe=O?'<button class="btn-unlock done" disabled>✓ Learned</button>':`<button class="btn-unlock${!C||!H?" disabled":""}"
             ${!C||!H?"disabled":""}
             data-bid="${E.id}" data-tier="${B}">
             ${H?C?"Unlock":"Need SP":"🔒 Locked"}
           </button>`;if(q.innerHTML=`
        <div class="st-skill-name">${B===0?"◆":B===1?"◈":"★"} ${I.name}</div>
        <div class="st-skill-desc">${I.desc}</div>
        <div class="st-skill-cost">${O?"Unlocked":`${$} SP`}</div>
        ${oe}`,!O){const ee=q.querySelector("button:not([disabled])");ee&&(ee.onclick=()=>{e.skillPoints=(e.skillPoints||0)-$,e.unlockedSkills||(e.unlockedSkills={}),e.unlockedSkills[I.id]=!0,gn(e,I),e===r.party[0]&&J(),Ce(`Unlocked: ${I.name}!`),Yt(e)})}_.appendChild(q)}),l.appendChild(_)}),document.getElementById("btn-close-st").onclick=()=>o.classList.add("hidden"))}function gn(e,o){if(!o||!o.effect)return;const i=o.effect;if(i.atkMult&&(e.atkBasic=Math.round((e.atkBasic||10)*(1+i.atkMult))),i.skillMult&&(e.atkSkill=Math.round((e.atkSkill||12)*(1+i.skillMult))),i.ultMult&&(e.atkUltimate=Math.round((e.atkUltimate||16)*(1+i.ultMult))),i.hpMult){const t=Math.round((e.maxHp||50)*i.hpMult);e.maxHp+=t,e.hp=Math.min(e.maxHp,e.hp+t)}i.defBonus&&(e.def=(e.def||0)+i.defBonus),i.spdBonus&&(e.spd=(e.spd||0)+i.spdBonus),i.critChance&&(e.crit=Math.min(.95,(e.crit||.05)+i.critChance)),i.mpDiscount&&(e._mpDiscount=(e._mpDiscount||0)+i.mpDiscount)}function yn(){const e=document.getElementById("menu-quests");e.innerHTML="";const o=r.save.activeQuests,i=r.save.completedQuests;if(o.length){const t=document.createElement("div");t.className="q-section-title",t.textContent="ACTIVE QUESTS",e.appendChild(t),o.forEach(n=>{const s=r.save.quests[n],l=te[n];if(!s||!l)return;const c=document.createElement("div");c.className="q-entry active",c.innerHTML=`<div class="q-name">${l.name}</div>
        <div class="q-desc">${l.desc}</div>
        <div class="q-lore">${l.lore}</div>
        <div class="q-steps">${s.steps.map(g=>`${g.done?"■":"□"} ${g.text}`).join("<br>")}</div>`,e.appendChild(c)})}if(i.length){const t=document.createElement("div");t.className="q-section-title",t.textContent="COMPLETED",e.appendChild(t),i.forEach(n=>{const s=te[n];if(!s)return;const l=document.createElement("div");l.className="q-entry done",l.innerHTML=`<div class="q-name">■ ${s.name}</div>`,e.appendChild(l)})}!o.length&&!i.length&&(e.innerHTML='<div class="q-empty">No quests yet.</div>')}let de=null,A=null,ae=null;function vn(){const e=P/2,o=W/2;if(!de||de.width!==P||de.height!==W){de=document.createElement("canvas"),de.width=P,de.height=W,A=de.getContext("2d"),ae&&(Pe.removeChild(ae),ae.destroy(!0));const i=PIXI.Texture.from(de);ae=new PIXI.Sprite(i),ae.blendMode=PIXI.BLEND_MODES.MULTIPLY,Pe.addChild(ae)}if(A.clearRect(0,0,P,W),r.mapId==="cave"||r.mapId==="citadel"){const i=1+Math.sin(Date.now()*.007)*.035+Math.sin(Date.now()*.021)*.018,t=M*4*i;A.fillStyle="rgba(0,0,0,0.94)",A.fillRect(0,0,P,W),A.save(),A.globalCompositeOperation="destination-out";const n=A.createRadialGradient(e,o,0,e,o,t);n.addColorStop(0,"rgba(0,0,0,0.97)"),n.addColorStop(.35,"rgba(0,0,0,0.88)"),n.addColorStop(.7,"rgba(0,0,0,0.55)"),n.addColorStop(1,"rgba(0,0,0,0.0)"),A.fillStyle=n,A.fillRect(0,0,P,W),A.restore(),A.save(),A.globalCompositeOperation="source-atop";const s=A.createRadialGradient(e,o,0,e,o,t*.6);s.addColorStop(0,"rgba(255,200,80,0.07)"),s.addColorStop(1,"rgba(255,200,80,0.0)"),A.fillStyle=s,A.fillRect(0,0,P,W),A.restore()}else if(r.mapId==="void_lands"){const i=1+Math.sin(Date.now()*.004)*.07,t=M*5.8*i;A.fillStyle="rgba(0,0,0,0.88)",A.fillRect(0,0,P,W),A.save(),A.globalCompositeOperation="destination-out";const n=A.createRadialGradient(e,o,0,e,o,t);n.addColorStop(0,"rgba(0,0,0,0.90)"),n.addColorStop(.5,"rgba(0,0,0,0.60)"),n.addColorStop(.85,"rgba(0,0,0,0.20)"),n.addColorStop(1,"rgba(0,0,0,0.0)"),A.fillStyle=n,A.fillRect(0,0,P,W),A.restore(),A.save(),A.globalCompositeOperation="source-atop";const s=A.createRadialGradient(e,o,t*.3,e,o,t);s.addColorStop(0,"rgba(80,0,160,0.0)"),s.addColorStop(1,"rgba(80,0,160,0.12)"),A.fillStyle=s,A.fillRect(0,0,P,W),A.restore()}else{const i=Math.max(P,W)*.8;A.fillStyle="rgba(0,0,0,0)",A.fillRect(0,0,P,W),A.save(),A.globalCompositeOperation="source-over";const t=A.createRadialGradient(e,o,i*.35,e,o,i);t.addColorStop(0,"rgba(0,0,0,0)"),t.addColorStop(1,"rgba(0,0,0,0.30)"),A.fillStyle=t,A.fillRect(0,0,P,W),A.restore()}ae&&ae.texture&&(ae.texture.baseTexture.resource.source=de,ae.texture.baseTexture.update())}const pe={};function bn(e){const o=Et[e]||Et.overworld;Ee.matrix=[o[0],0,0,0,o[3],0,o[1],0,0,o[3],0,0,o[2],0,o[3],0,0,0,1,0]}function wn(e,o,i,t,n){const s=`${e},${o}`,l=St(i),c=Jo.has(i),g=c?Ie:Te;pe[s]||(pe[s]={ground:null,object:null,lastId:-1,lastOverlap:null});const h=pe[s];if(Ot.has(i)){const _=c?h.object:h.ground;if(_){const I=St(i);I&&(_.texture=I)}}if(h.lastId!==i){if(h.ground&&(Te.removeChild(h.ground),h.ground.destroy(),h.ground=null),h.object&&(Ie.removeChild(h.object),h.object.destroy(),h.object=null),l){const _=new PIXI.Sprite(l);_.width=M,_.height=M,_.texture.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,g.addChild(_),c?h.object=_:h.ground=_}h.lastId=i}const E=c?h.object:h.ground;E&&(E.x=e*M-t,E.y=o*M-n,E.visible=!0)}function En(e){if(!Y||!r.mapData)return;Lo(e);const{tiles:o,w:i,h:t}=r.mapData,n=i*M,s=t*M,l=Math.max(0,Math.min(r.px*M+M/2-P/2,n-P)),c=Math.max(0,Math.min(r.py*M+M/2-W/2,s-W));r.camX+=(l-r.camX)*.14,r.camY+=(c-r.camY)*.14;const g=Math.round(r.camX),h=Math.round(r.camY),E=r.mapId==="cave"||r.mapId==="citadel"?2368806:r.mapId==="void_lands"?1710876:10132378;Y.renderer.backgroundColor=E,bn(r.mapId);for(const L in pe){const F=pe[L];F.ground&&(F.ground.visible=!1),F.object&&(F.object.visible=!1)}const _=Math.max(0,Math.floor(g/M)-1),I=Math.max(0,Math.floor(h/M)-1),B=Math.ceil(P/M)+3,O=Math.ceil(W/M)+3;for(let L=I;L<Math.min(I+O,t);L++)for(let F=_;F<Math.min(_+B,i);F++)wn(F,L,o[L][F],g,h);ce.clear();const $=r.px*M-g,C=r.py*M-h,H=M*1.7,q=H*.6;if(r.playerSprite){if(K)K.texture.update();else{const L=PIXI.Texture.from(r.playerSprite.canvas);L.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST,K=new PIXI.Sprite(L),K.anchor.set(.5,1),X.addChild(K)}K.x=$+M/2,K.y=C+M,K.width=q,K.height=H,K.zIndex=r.py*1e3+500,ce.beginFill(0,.18),ce.drawEllipse($+M/2,C+M-4,q*.38,6),ce.endFill()}const oe=ze.filter(L=>L.mapId===r.mapId),ee=new Set(oe.map(L=>L.id));for(const L in Z)ee.has(L)||(X.removeChild(Z[L].spr),Z[L].label&&X.removeChild(Z[L].label),Z[L].labelBg&&X.removeChild(Z[L].labelBg),delete Z[L]);oe.forEach(L=>{const F=L.x*M-g,ne=L.y*M-h;if(F<-128||ne<-160||F>P+128||ne>W+160)return;const We=Math.sin(Date.now()*.0025+L.id.charCodeAt(0)*.7)*3,Le=M*1.45,Ae=Le*.62,$e=r.npcSprites[L.id];if(!$e)return;if(!Z[L.id]){const Me=PIXI.Texture.from($e);Me.baseTexture.scaleMode=PIXI.SCALE_MODES.NEAREST;const Re=new PIXI.Sprite(Me);Re.anchor.set(.5,1);const pt=new PIXI.Graphics,ot=new PIXI.Text(L.name,{fontFamily:"Space Mono, monospace",fontSize:10,fontWeight:"bold",fill:14935524});ot.anchor.set(.5,1),X.addChild(pt),X.addChild(Re),X.addChild(ot),Z[L.id]={spr:Re,label:ot,labelBg:pt}}const U=Z[L.id];U.spr.x=F+M/2,U.spr.y=ne+M+We,U.spr.width=Ae,U.spr.height=Le,U.spr.zIndex=L.y*1e3;const Fe=F+M/2,Ge=ne+M-Le+We-6,Ve=U.label.width+14;U.label.x=Fe,U.label.y=Ge,U.label.zIndex=L.y*1e3+1,U.labelBg.clear(),U.labelBg.beginFill(1710876,.82),U.labelBg.drawRect(Fe-Ve/2,Ge-14,Ve,14),U.labelBg.endFill(),U.labelBg.zIndex=L.y*1e3-1,ce.beginFill(0,.13),ce.drawEllipse(F+M/2,ne+M-4,Ae*.38,5),ce.endFill()}),X.sortableChildren=!0,X.sortChildren(),vn(),x.alpha=r.fadeAlpha,Sn(),_n(),Y.renderer.render(Y.stage)}function Sn(){let e=null,o=60;if(r.questNotif&&(r.questNotif.timer--,r.questNotif.timer>0?e={text:r.questNotif.text,timer:r.questNotif.timer,y:o}:r.questNotif=null,o+=30),!e&&r.itemNotif&&(r.itemNotif.timer--,r.itemNotif.timer>0?e={text:r.itemNotif.text,timer:r.itemNotif.timer,y:o}:r.itemNotif=null),e){const i=Math.min(1,e.timer/30);re.text=e.text,re.alpha=i,re.x=P/2,re.y=e.y+10;const t=re.width+24;me.clear(),me.beginFill(4737355,.9*i),me.drawRect(P/2-t/2,e.y,t,20),me.endFill(),re.visible=!0,me.visible=!0}else re.visible=!1,me.visible=!1}function _n(){if(!r.save.activeQuests.length){ie.visible=!1;return}const e=r.save.activeQuests[0],o=r.save.quests[e],i=te[e];if(!o||!i){ie.visible=!1;return}const t=o.steps.find(n=>!n.done);if(!t){ie.visible=!1;return}ie.text=`◉ ${t.text}`,ie.x=P-8,ie.y=8,ie.visible=!0}function J(){var s;function e(l,c){const g=document.getElementById(l);g&&(g.textContent=c)}function o(l,c,g){const h=document.getElementById(l);h&&(h.style[c]=g)}e("zone-name",((s=ke[r.mapId])==null?void 0:s.name)||r.mapId),e("hud-gold",r.save.gold),e("hud-pot","⬜×"+(r.save.inventory.potion||0));const i=r.party[0];if(!i)return;const t=Math.max(0,i.hp/i.maxHp*100),n=Math.max(0,i.mp/i.maxMp*100);e("hud-lead-name",i.name),e("hud-lead-type",i.type+" #"+i.id),o("hud-hp-bar","width",t+"%"),o("hud-mp-bar","width",n+"%"),e("hud-hp-val",i.hp+"/"+i.maxHp)}function kn(){var e;ve("ending"),document.getElementById("ending-normie-id").textContent="#"+(((e=r.party[0])==null?void 0:e.id)||"0001"),document.getElementById("ending-battles").textContent=r.save.battlesWon,document.getElementById("ending-steps").textContent=r.save.steps,document.getElementById("ending-gold").textContent=r.save.gold}function Tn(){const e=document.getElementById("logo-canvas");if(!e)return;const o=320,i=107;e.width=o,e.height=i;const t=e.getContext("2d");t.imageSmoothingEnabled=!1,t.fillStyle="#e3e5e4",t.fillRect(0,0,o,i),t.fillStyle="#48494b";const n={T:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],H:[[1,0,1],[1,0,1],[1,1,1],[1,0,1],[1,0,1]],E:[[1,1,1],[1,0,0],[1,1,0],[1,0,0],[1,1,1]]};"THE".split("").forEach((I,B)=>{(n[I]||n.T).forEach(($,C)=>$.forEach((H,q)=>{H&&t.fillRect(14+B*14+q*2,8+C*2,2,2)}))}),t.fillRect(14,22,32,1);const s={P:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0]],I:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[1,1,1]],X:[[1,0,0,1],[1,0,0,1],[0,1,1,0],[1,0,0,1],[1,0,0,1]],E:[[1,1,1,0],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,1,1,0]],L:[[1,0,0],[1,0,0],[1,0,0],[1,0,0],[1,1,1]],W:[[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1]],A:[[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],R:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,1,0,0],[1,0,1,0]]},l=5,g=[["P","I","X","E","L"],["W","A","R"]].map(I=>I.reduce((B,O)=>{var $,C;return B+(((C=($=s[O])==null?void 0:$[0])==null?void 0:C.length)||3)+1},0)-1),h=g[0]*l+16+g[1]*l;let _=Math.floor((o-h)/2);"PIXEL".split("").forEach(I=>{const B=s[I];if(!B){_+=4*l;return}B.forEach((O,$)=>O.forEach((C,H)=>{C&&t.fillRect(_+H*l,30+$*l,l,l)})),_+=(B[0].length+1)*l}),_+=16,"WAR".split("").forEach(I=>{const B=s[I];if(!B){_+=4*l;return}B.forEach((O,$)=>O.forEach((C,H)=>{C&&t.fillRect(_+H*l,30+$*l,l,l)})),_+=(B[0].length+1)*l}),t.font="bold 10px monospace",t.textAlign="center",t.fillStyle="#8a8b8a",t.fillText("A  N O R M I E S  A D V E N T U R E",o/2,97)}function Ct(){const e=Mo.intro;let o=0;ve("intro");const i=document.getElementById("intro-text"),t=document.getElementById("intro-page");function n(){i.textContent=e[o],t.textContent=`${o+1} / ${e.length}`}n(),document.getElementById("btn-intro-next").onclick=()=>{o++,o>=e.length?(ve("party"),Oe(),ye()):n()},document.getElementById("btn-intro-skip").onclick=()=>{ve("party"),Oe(),ye()}}function ye(){const e=document.getElementById("normie-grid"),o=document.getElementById("col-count");if(o&&(o.textContent=r.collection.length?`(${r.collection.length})`:""),!r.collection.length){e.innerHTML='<div class="grid-loading">Loading Normies…</div>';return}e.innerHTML="",r.collection.forEach(i=>{const t=r.party.some(I=>I.id===i.id),n=document.createElement("div");n.className="ncard"+(t?" in-party":"");const s=r.battleSprites[i.id],l=document.createElement("canvas");l.width=48,l.height=48;const c=l.getContext("2d");c.imageSmoothingEnabled=!1,s?c.drawImage(s,0,0,48,48):(c.fillStyle="#e0e0de",c.fillRect(0,0,48,48),c.fillStyle="#999",c.font="9px monospace",c.textAlign="center",c.textBaseline="middle",c.fillText("#"+i.id,24,24)),n.appendChild(l);const g=document.createElement("div");g.className="ncard-id",g.textContent="#"+i.id;const h=document.createElement("div");h.className="ncard-type",h.textContent=i.type;const E=document.createElement("div");E.className="ncard-stat",E.textContent=`HP ${i.maxHp} · SPD ${i.spd}`;const _=document.createElement("div");_.className="ncard-expr",_.textContent=i.expression,n.append(g,h,E,_),t||(n.onclick=()=>{r.party.length>=5||(r.party.push({...i}),Oe(),ye())}),e.appendChild(n)})}function Oe(){const e=document.getElementById("party-slots");e.innerHTML="";const o=document.getElementById("party-count");o&&(o.textContent=`${r.party.length} / 5`);const i=document.getElementById("btn-start");i&&(i.disabled=r.party.length===0);for(let t=0;t<5;t++){const n=r.party[t],s=document.createElement("div");if(s.className="pslot "+(n?"filled":"empty"),n){const l=r.battleSprites[n.id],c=document.createElement("canvas");c.width=40,c.height=40;const g=c.getContext("2d");g.imageSmoothingEnabled=!1,l&&g.drawImage(l,0,0,40,40),s.appendChild(c);const h=document.createElement("div");if(h.className="pslot-info",t===0){const B=document.createElement("div");B.className="pslot-lead",B.textContent="LEAD",h.appendChild(B)}const E=document.createElement("div");E.className="pslot-name",E.textContent="#"+n.id;const _=document.createElement("div");_.className="pslot-type",_.textContent=n.type;const I=document.createElement("div");I.className="pslot-hp",I.textContent=`HP ${n.maxHp}`,h.append(E,_,I),s.appendChild(h),s.title="Click to remove",s.onclick=()=>{r.party.splice(t,1),Oe(),ye()}}else{const l=document.createElement("div");l.className="pslot-num",l.textContent=t+1,s.appendChild(l)}e.appendChild(s)}}function Xt(e=0){var i;const o=Math.min(e-bt,50);bt=e,r.screen==="game"&&(xo(o),!r.battle&&!r.menu&&!r.dlg&&tn(o),nn(),un(),r.battle&&(r.battle.enemy.flashTimer>0&&r.battle.enemy.flashTimer--,(i=r.battle.fighters)==null||i.forEach(t=>{t.flashTimer>0&&t.flashTimer--})),En(o)),se=requestAnimationFrame(Xt)}function ve(e){document.querySelectorAll(".screen").forEach(o=>o.classList.remove("active")),document.getElementById("screen-"+e).classList.add("active"),r.screen=e}window.addEventListener("DOMContentLoaded",async()=>{Tn(),zo(),Nt(),et("prologue_home"),window.__SKILL_TREES=Ro;function e(){const c=document.getElementById("btn-connect"),g=rt();g.length===0?(c.textContent="No Wallet Found",c.title="Install MetaMask, Coinbase Wallet, or another Web3 wallet"):c.textContent=`⬜ Connect ${g[0].name}`}e(),setTimeout(e,800),document.getElementById("btn-connect").onclick=async()=>{document.getElementById("btn-connect");const c=rt();if(c.length===0){i();return}c.length>1?t(c,async g=>{await o(g)}):await o(c[0].id)};async function o(c){const g=document.getElementById("btn-connect");g.disabled=!0,g.textContent="Connecting…";try{const{provider:h,address:E,walletName:_}=await xt(c);r.demo=!1,document.getElementById("wallet-addr").textContent=`${_}: ${E.slice(0,6)}…${E.slice(-4)}`,g.textContent="Loading NFTs…",r.collection=await eo(E,h,I=>{r.collection=I,I.forEach(Ue),ye()}),r.collection.forEach(Ue),r.collection.length===0?(g.textContent="No Normies Found",g.disabled=!1,document.getElementById("wallet-addr").textContent+=" · No Normies found — try Demo Mode"):Ct()}catch(h){g.disabled=!1,e(),h.message==="NO_WALLET"?i():h.code===4001?g.textContent="Rejected — try again":(g.textContent="Failed — retry",console.error(h))}}function i(){const c=document.getElementById("wallet-help");c&&c.classList.remove("hidden")}function t(c,g){const h=document.createElement("div");h.className="wallet-picker-overlay",h.innerHTML=`<div class="wallet-picker">
      <div class="wp-title">Choose Wallet</div>
      ${c.map(E=>`<button class="wp-btn btn-ghost" data-id="${E.id}">${E.name}</button>`).join("")}
      <button class="wp-cancel btn-back">Cancel</button>
    </div>`,document.body.appendChild(h),h.querySelectorAll(".wp-btn").forEach(E=>{E.onclick=()=>{h.remove(),g(E.dataset.id)}}),h.querySelector(".wp-cancel").onclick=()=>h.remove(),h.onclick=E=>{E.target===h&&h.remove()}}document.getElementById("btn-demo").onclick=async()=>{r.demo=!0,r.collection=[],document.getElementById("demo-pill").classList.add("show"),r.collection=await oo(c=>{r.collection=c,c.forEach(Ue),ye()}),r.collection.forEach(Ue),Ct()},document.getElementById("btn-start").onclick=()=>{r.party.length&&In()},document.getElementById("btn-atk").onclick=()=>window.__battleAction("attack"),document.getElementById("btn-skill").onclick=()=>window.__battleAction("skill"),document.getElementById("btn-ult").onclick=()=>window.__battleAction("ult"),document.getElementById("btn-bpot").onclick=()=>window.__battleAction("potion");const n=document.getElementById("btn-flee");n&&(n.onclick=()=>window.__battleAction("flee")),document.getElementById("btn-bat-world").onclick=()=>{r.battle&&(r.battle=null,document.getElementById("battle").classList.add("hidden"),J())},document.getElementById("btn-bat-party").onclick=()=>{r.battle=null,document.getElementById("battle").classList.add("hidden"),r.party.forEach(c=>{c.hp=c.maxHp,c.mp=c.maxMp,c.alive=!0}),se&&(cancelAnimationFrame(se),se=null),r.screen="party",ve("party"),Oe(),ye()},document.querySelectorAll(".menu-tab").forEach(c=>{c.onclick=()=>{Vt(c.dataset.tab),document.querySelectorAll(".menu-tab").forEach(g=>g.classList.toggle("active",g===c))}}),document.getElementById("btn-close-menu").onclick=ht,document.getElementById("btn-close-shop").onclick=()=>document.getElementById("shop").classList.add("hidden");const s=document.getElementById("btn-open-menu");s&&(s.onclick=()=>{r.screen==="game"&&Gt("inventory")}),document.getElementById("dialogue").addEventListener("click",Wt),document.getElementById("btn-back-title").onclick=()=>{se&&(cancelAnimationFrame(se),se=null),ve("title")},document.getElementById("btn-ending-play-again").onclick=()=>location.reload();const l=document.getElementById("skill-tree-modal");l&&l.addEventListener("click",c=>{c.target===l&&l.classList.add("hidden")})});function Ue(e){r.battleSprites[e.id]||(r.battleSprites[e.id]=Ht(e.pixels))}function In(){Y||Zo(),r.save.gold=0,r.save.battlesWon=0,r.save.inventory={potion:3},r.save.journal=["Chapter 1: The First Render — Your story begins."],r.party.forEach(t=>{t.hp=t.maxHp,t.mp=t.maxMp,t.alive=!0}),Nt(),r.save.activeQuests=[],r.save.completedQuests=[],r.save.talkedTo={},r.save.visitedMaps={},r.save.flags={},r.save.steps=0,et("prologue_home"),K&&(X.removeChild(K),K=null);const e=r.party[0];r.playerSprite=Pt(e==null?void 0:e.pixels),Dt("home_up");const o=r.mapData.w*M,i=r.mapData.h*M;r.camX=Math.max(0,Math.min(r.px*M+M/2-P/2,o-P)),r.camY=Math.max(0,Math.min(r.py*M+M/2-W/2,i-W)),ve("game"),J(),setTimeout(()=>{const t=ze.find(n=>n.id==="mom_up");t&&Ne(t.name,t.lines.slice(0,2),r.npcSprites.mom_up)},800),se&&cancelAnimationFrame(se),se=requestAnimationFrame(Xt)}
