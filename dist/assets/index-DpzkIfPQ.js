(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const Me="https://api.normies.art",F={};async function Je(e){if(F[`meta_${e}`])return F[`meta_${e}`];const s=await(await fetch(`${Me}/normie/${e}/metadata`)).json();return F[`meta_${e}`]=s,s}async function je(e){if(F[`px_${e}`])return F[`px_${e}`];const s=await(await fetch(`${Me}/normie/${e}/pixels`)).json();return F[`px_${e}`]=s,s}function xe(e,a){const s=e.attributes||[],t=J=>{var j;return((j=s.find(qe=>qe.trait_type===J))==null?void 0:j.value)||""},n=t("Type")||"Human",i=t("Expression")||"Neutral",r=t("Accessory")||"No Accessories",A=a?(a.match(/1/g)||[]).length:800,h=1,p={Human:{mp:0,def:0,spd:0},Cat:{mp:1,def:-1,spd:2},Alien:{mp:3,def:1,spd:-1},Agent:{mp:2,def:2,spd:1}},c={"Top Hat":{mp:2},Fedora:{spd:1},"Cowboy Hat":{def:1},Beanie:{def:1},Cap:{spd:1},"Cap Forward":{spd:2},Hoodie:{def:2},"Gold Chain":{mp:3},"Silver Chain":{mp:2},"Bow Tie":{mp:1},Headband:{spd:1},Bandana:{def:1,spd:1},"Eye Patch":{def:2},"VR Headset":{mp:4}},u={Confident:.12,Serious:.08,"Slight Smile":.06,Friendly:.05,Neutral:.04,Content:.04,Peaceful:.03},g=p[n]||p.Human,w=c[r]||{},b=60+h*10+Math.floor(A/10),v=10+h*2+(g.mp||0)+(w.mp||0),I=Math.floor(A/80)+h+(g.def||0)+(w.def||0),L=5+h+(g.spd||0)+(w.spd||0),O=u[i]||.04,B=8+h*5,T=12+h*7,D=20+h*10,N={Human:["Render Strike","Pixel Burst"],Cat:["Claw Swipe","Void Scratch"],Alien:["Null Beam","Grid Override"],Agent:["Protocol Breach","System Crash"]},[de,q]=N[n]||N.Human;return{maxHp:b,hp:b,maxMp:v,mp:v,def:I,spd:L,crit:O,lv:h,atkBasic:B,atkSkill:T,atkUltimate:D,sk1:de,sk2:q,type:n,expression:i,accessory:r,px:A}}async function _e(e){try{const[a,s]=await Promise.all([Je(e),je(e)]),t=(s==null?void 0:s.pixels)||(s==null?void 0:s.data)||s||"",n=xe(a,t),i=a.name||`Normie #${e}`;return{id:e,name:i,pixels:t,alive:!0,...n}}catch(a){return console.warn(`fetchNormieFull(${e}) failed:`,a),De(e)}}function De(e){const a=["Human","Cat","Alien","Agent"],s=["Neutral","Confident","Serious","Friendly","Peaceful"],t=["No Accessories","Gold Chain","Hoodie","Bandana","VR Headset"],n=a[e%4],i=s[e%5],r=t[e%5],A=Xe(e),p=xe({attributes:[{trait_type:"Type",value:n},{trait_type:"Expression",value:i},{trait_type:"Accessory",value:r}]},A);return{id:e,name:`Normie #${e}`,pixels:A,alive:!0,...p}}function Xe(e){let a="";const s=e*7+3;function t(n){let i=(s+n)*1664525+1013904223;return i&=2147483647,i/2147483647}for(let n=0;n<40;n++)for(let i=0;i<40;i++){const r=n*40+i,A=20,h=18,p=14;if(!((i-A)**2+(n-h)**2<=p*p)){a+="0";continue}const u=i>11&&i<16&&n>14&&n<18||i>24&&i<29&&n>14&&n<18,g=n>23&&n<26&&i>13&&i<27;(i-A)**2+(n-h)**2>=(p-1)**2||u||g?a+="1":a+=t(r)<.18?"1":"0"}return a}const Ze="0x9Eb6E2025B64f340691e424b7fe7022fFDE12438",ze=["function balanceOf(address owner) view returns (uint256)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)"];function fe(){var a;const e=[];return window.ethereum&&(window.ethereum.isMetaMask?e.push({id:"metamask",name:"MetaMask",provider:window.ethereum}):window.ethereum.isCoinbaseWallet?e.push({id:"coinbase",name:"Coinbase Wallet",provider:window.ethereum}):window.ethereum.isRabby?e.push({id:"rabby",name:"Rabby",provider:window.ethereum}):window.ethereum.isBraveWallet?e.push({id:"brave",name:"Brave Wallet",provider:window.ethereum}):e.push({id:"injected",name:"Browser Wallet",provider:window.ethereum})),(a=window.ethereum)!=null&&a.providers&&window.ethereum.providers.forEach(s=>{s.isMetaMask&&!e.find(t=>t.id==="metamask")&&e.push({id:"metamask",name:"MetaMask",provider:s}),s.isCoinbaseWallet&&!e.find(t=>t.id==="coinbase")&&e.push({id:"coinbase",name:"Coinbase Wallet",provider:s})}),e}async function et(e=null){const a=fe();let s;if(a.length===0)throw new Error("NO_WALLET");const t=e?a.find(A=>A.id===e):a[0];s=(t||a[0]).provider,await s.request({method:"eth_requestAccounts"});const n=new ethers.BrowserProvider(s),r=await(await n.getSigner()).getAddress();return{provider:n,address:r,walletName:(t||a[0]).name}}async function tt(e,a,s){const t=new ethers.Contract(Ze,ze,a),n=Number(await t.balanceOf(e));if(n===0)return[];const i=[];for(let A=0;A<Math.min(n,30);A++)i.push(Number(await t.tokenOfOwnerByIndex(e,A)));const r=[];for(const A of i){const h=await _e(A);r.push(h),s&&s([...r]),await Ne(350)}return r}const nt=[1,7,42,100,256,420,888,1e3,1337,2e3,3e3,3333,4e3,5e3,6e3,7e3,8e3,9e3,9500,9999];async function ot(e){const a=[];for(const s of nt){let t;try{t=await _e(s)}catch{t=De(s)}a.push(t),e&&e([...a]),await Ne(150)}return a}const Ne=e=>new Promise(a=>setTimeout(a,e)),ve={bed_floor:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAX0lEQVR4nGO8dPnSfwYKAIugkBBeBcePHWOwtLLCKc9EiWYGBgYGxlWrV1HkBcbHT59QZABeL1BswPFjxwgaQHEYsGhoaFCin3A6IATgYUCMf7GB4Z4OiAEs5AYeDAAAptEhxP5y/XUAAAAASUVORK5CYII=",bed_wall:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAATElEQVR4nGM8fOTwfwVFRQYYeHD/PgMpfCYGJLByxQoGUgGKAeEREZQZQA4YNWDkGIAvhRKVlPGlUJKT8smTJ3EbQAwwNzenzAB0AADBDRjLnqAArQAAAABJRU5ErkJggg==",stairs_dn:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAZElEQVR4nM3QwQ2AIBSD4f8lzMEuJhw0DsAbEedC5sCDMfGo9ELvbdLP1m3vCAkpLUqfEGOUBqy2U7pgqoHVdvajlKFydicAKA6TGAD8dcjuALcBjDtMZADfHZ7/8DKAMQfZ4AJO7Cxq806iagAAAABJRU5ErkJggg==",bed:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAhklEQVR4nGN8/PTJfwYKABMlmhkYGBgYPTy9yXbB7DkzGVgYGBgYkpLiGTQ0NBgEhYQwFL1/945h165dDG5ubgwMDAxwdllZJQMDAxYvHD92DIWPTTMywDDA0soKhY9N865du3AbgA3gcwULssL3796RpJkoF9DcCwQNGPxeoDgpMw54bgQAJBpWmIzMNZ4AAAAASUVORK5CYII=",bookshelf:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAOklEQVR4nGP08PT+z0ABYIIxXFwc4fjVq5cMLi6OcPGkpHgUPrI8ExZDyXPBqAHkA8bRdDAcDKA4GgGCiR95HeeRcwAAAABJRU5ErkJggg==",door:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAe0lEQVR4nGNctXrVfwYywaNHjxhYLK2syNXP8OjRIwYmsnVDAcvxY8coM2DweWHevIV4NSQlxaMagO6FefMWMri4OGLVvGfPfgZk9QMTC+jqsXoBHezZsx/uLbK8gCtMGBjo5QVkgO4FFmyKwiMisGres2c/hhgjpdkZAGdiPrFzEImiAAAAAElFTkSuQmCC",grass0:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAdUlEQVR4nMWSwQ2AIAxFi1vRRWTEsshnEHUOPRiNhaJEDrxb0/Tn5adu2dadDBJAntlaKVwtoJWp5zgBZ0AUoSiillGEElAcPPHM7wZ5B1Ynd8Acglrkcw1VYmvzpsFfVIBnLor6YtwfXKZjDBIwyMB67W6DA4n+P1/t4r9DAAAAAElFTkSuQmCC",grass1:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAZUlEQVR4nGN8/PTJfwYKABMlmvEacPzYMaxsdDWMg88LuJyLDFauWIHbAEsrK7wGovOpFwbEOB2vAehORwe4LIAbsHLFCgxFyIGFywImQorwJSIUF4RHRGDVhMtmmPggSonkRiMA1yE5+diURd8AAAAASUVORK5CYII=",grass2:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgElEQVR4nLWS0Q2AIAxED+Ic3UMWkRHLImUQdQ790hAtxYi+z156XC+4eV02dOABIIvcBG2m4Z4kyCIYQ3hvYOFrLz6df5sgMfcZHJRRE7Np7BPzuTDFCADVxjWG1gIRmXpXiVlE76CkPPHKGELdoCzOOqGZgIhM/Z+vrJFF1C520GNBT8chhHwAAAAASUVORK5CYII=",dark_grass:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAh0lEQVR4nK2S0Q2AIBBDnyxKwhDGaS7hVyfTJfQLAniigP0BQlvacNO6rScDMCL+EzHwSv4UEoh4nLOU+zfTmKAmeHodwKRCzUzEcxw7QFzVCj3IKrSIUpjapWae1nPO5gahYxBqnUtkBssy83TW0oj4/BdacavQA9Wg7F6bzPE5aCH/ngDgAq5vU+vjBKQvAAAAAElFTkSuQmCC",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAYUlEQVR4nGNctXrVf0srKwZsYOWKFQxycnIM+ORZGBgYGB7cv49VAQzgk2fCq5MIwMLAwMBw8uRJvIrwyTM+fvrkP4xDjJ/R5Vmw+Y+UMKE8DLD5j5QwYRxNB6PpgIGBAQDVnlaFghhf0AAAAABJRU5ErkJggg==",tree:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAdklEQVR4nGN8/PTJfwYKAAs2wdSUdJwaZs+ZicJnwqfZxcWRoOEYBuDTjA1gNYBYzRgGwJy3Z89+vJqQvcGIHgv4AhAGkAMSZxgQC6hvAHo8E5LHCANkAAsPfIZS7AWMpHz82DEMRchillZW1HUBxQbgDURiAADjEioSid2YIgAAAABJRU5ErkJggg==",house_wall:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAOElEQVR4nGNctXrVfwYywaNHjxhYLK2syNXP8OjRIwYmsnVDAcvxY8coM2DUC6NeYBj1AgMDAwMAAEAiFh6UJAsAAAAASUVORK5CYII=",roof:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAANElEQVR4nGM0Mjb5z0ABYImKiqBEPwPLnj37KTKAiSLdDAwMLK9evaTMgNEwGA0DhmERBgAA1hcROyxi1AAAAABJRU5ErkJggg==",town_floor:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAV0lEQVR4nO2SsQnAMAwEz0GzaTpnOadx/YskhSuDCxk1IeTLQ7zguVLPepOIAbj7BHvvSArxI/P9LxgxGOuuEuEGIGl5GOGlXW0SaccBeMOIHyiwjAMAD93HNjXUZ4C8AAAAAElFTkSuQmCC",sign:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAXklEQVR4nGN8/PTJfwYKAAuMkZqSTpLG2XNmohrAwMDA0NXVTpTmsrJKTBfAwK5du/BqdnNzQ+FjGICugBAg2gW4DKauC5ADh1jAiC8dwKIWFmXYABPJVo4aMAgNAADq9BmMVNw7vgAAAABJRU5ErkJggg==",water0:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAApUlEQVR4nKVTQQrEIBCL+4jxPQUPLf2AzAPLPkLwPe0nuofFYm2GWupFkEwmJMaN07xv24r6iHiw0+IA4MOAIQyUQDX2EaSUKUH7LuL/BKoRIv64LQUhDBecG6d5t8DL8j3JZ8pMgl5jqQeWolcElrEmQRvZYwUp5VM6twrKhnpTGaqHW5xjX9nayKKlBFZkwDXeR13oLpNlGFN2dKEG3XWh4FQjflfAUlolNxv7AAAAAElFTkSuQmCC",water1:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAqklEQVR4nLVTwQ3DIAw0HcLs0WYBJD9adQHkAVGGsMQ8YYn0UyoghiBF9QfpdBznszH3x7LDtxAtaJXSdsAy91aCRE4VYPYqXgkwexCJKkkkViKlU/N8vff2ApEDkfg7e0Xk6hYyGMIKKW0QwtptK/MODtrAesFm7sGB9tIIPxUYBasKtCM7c3B5CmZmEwHqcEve1Ca2eCk25eCvf+F6BogWmD0g2mEGPd4H1+1UOS/CxDkAAAAASUVORK5CYII=",water2:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAuElEQVR4nK2TwQ3DIAxFTYYwe7RdAMmHVl0AMVO6RtQhkDJPWIKeoImxQ5GKhBDmGx74Yy7XW0a0oLWUtsOcaycAACInJvN4CL7RmPk15xhXlYDIQYxrHXmb9kEiBylth5PLuqYz98czA7R3DcGLJxI5WJb3l0BD167F4+oGvz7s/whC8LXGiPaUYK+rPig7l8VSuj22pDMjTpR0Q07kpe4SSAlDf0HyfkPQ+wvdN+Ae50SItnZJ9wGSpmKKapWv9QAAAABJRU5ErkJggg==",water3:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAuElEQVR4nKVT0QnEIAyNGSLucdcFhHy0dAFx1oDzXJfofeWIXlIKfSBieM+8JJrWbT/BwXF8hjNR9miAXpC5DOfWqitmLoBKtrtIB6L8WyIdIl5at/20diOrc1nKw7nW2X4UV116vZehiXcdKPeviXcdKHDOKNJdYhRH5gJEGVqrQJQvHViejjZ5D0lHpDW3Vl0HzMW/AODhS5zFEZiLf8HVKC1E+vO/EPZAG6l7BLQZbWYVWbHH+wJDxVzSgh7DSQAAAABJRU5ErkJggg==",cave_floor:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAe0lEQVR4nL2T0Q2AIAxEC2GGdh4TPjTuPwRdQr8kSODaSOL7LXfQXgn7cV4EUC1ERMQsw3pCYiR8iJaBxScD1VJbcxnkvL1EzFJbi+2h2W29qCVYKSBUy7iF9rkIZhnHiKLr9yKhosc8oaKHpUWaDtELs/ywylaky7/xBlrLL3GnrZwyAAAAAElFTkSuQmCC",cave_wall:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAa0lEQVR4nL2S0Q2AMAhEz4YZ6Eoa9x+iXUK/MEeiSYHE+y6vr1e2/TgvFCJzjso8WuSwaodq9wYRwJtt+yKvRngwA3ElGiBSrOsg8yMPgPVTBpEhfqpk2zfQv5vIN5t5aBMtbJ0y4JRKBIAbhaMhHX3a4YoAAAAASUVORK5CYII=",void0:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoUlEQVR4nJVS2w2AIAysDIF7qAuY+KFxAcKAxCFInAeW0C8MXIHG+2vTu14fwzQvD2XQeqQYA7VgrSHnri8e9uN8egQJ6i/ZWlMKYEIi5PaJiJT3d5HQeuwSmINu+wqSYGrEdoBxa8RUp9CyNDPWsxEkwratfQEk4EjsCtIOJBQOsHstx86YF8QYWIHkSOFS8LHET0RF7IiCzEEe1HaADhEv5u1KZx03VKgAAAAASUVORK5CYII=",void1:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoklEQVR4nL2SzQnDMAyFnzOEvEfbBQw6tHQBowFNhjBknniJ9NQQO0IKFPputn7eJ6Fwuz82XBBRBHNCKfP+J5IRnq/31tq6fxwTrmj6FgNArQuIouquSSQjWCMQRRwNtPhk4Y3FIwlz6gk8R00dgefoNvAKtHjXgDnBemvjmUv0bkIk2w28kUqZ7TvwdCIQyacEi6jW5c+XOBK1tv62A6KID/TqQpZeWwNbAAAAAElFTkSuQmCC",void2:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAk0lEQVR4nK1SwQ2AIAwsDIF7qAuYMIRhQOIQJM4DS+irCoVaMd4L0uv1uKLGaT6gAWMGSCm2SgU0Hpxbi2YJyFfUAU6WHGC9coBNUrO1S/mEHqQUwfutFAhh/6J1C7xJ/FFAArcZzRHytQLAFRrla45AM8HQKL/6B/mErp/4Ff8J0BAl+xgyGyLXwDqgLqgjugW8n70sOiKa9T5/AAAAAElFTkSuQmCC",void3:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAArElEQVR4nKWS3Q2EIBCER4rAPtQGLrEIsgWaK8Lk6mGb0BfxYPg5w+0bhPnYmd1hmpdDxGHb3uipYZqXo0t5lekRibj/APv+SQExsXS2dqzCDBMBZIGu6ysTBqipPWBg3IWqh6r/An6NUMTdgvj3G8AeW55DBwkgvgByS9xhHPKjRWpt6qM94CllGXBxBmxJ1adj5MXhTEoZhDfFDKwds7ExNLEg4pqjrIkB4AR8k0nwKAan0AAAAABJRU5ErkJggg==",wall:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAYklEQVR4nGP08PT+/+rVSwZsQExMnIGBgYEBnzwLAwMDQ1RUBFYFe/bsZyAkz4RVhgTA6OHp/Z8SA1iQ/UeMn9HlGXt6e+AugPnZxcURqwHY5AdBGDAwkOZndPnRdDAs0gEAwQxFOdji6E8AAAAASUVORK5CYII=",inn_floor:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAWElEQVR4nGM8fOTwfwYKAOPjp08oMoCJkILjx47R1gUsD+7fZ2BgYGB4/vw5g6SkJMkGkOSC48eOMVhaWaGIEQwDZGBpZYURJtQLA3IB7dMBOhgNAxoYAADUnjKVx60gZQAAAABJRU5ErkJggg=="},at=16,l={BED_FLOOR:0,BED_WALL:1,STAIRS_DN:2,BED:3,BOOKSHELF:4,DOOR:5,GRASS0:6,GRASS1:7,GRASS2:8,DARK_GRASS:9,PATH:10,TREE:11,HOUSE_WALL:12,ROOF:13,TOWN_FLOOR:14,SIGN:15,WATER:16,CAVE_FLOOR:17,CAVE_WALL:18,VOID:19,WALL:20,INN_FLOOR:21},it=["bed_floor","bed_wall","stairs_dn","bed","bookshelf","door","grass0","grass1","grass2","dark_grass","path","tree","house_wall","roof","town_floor","sign","water0","cave_floor","cave_wall","void0","wall","inn_floor"],ae={};function st(e,a){const s=new Image;s.onload=()=>{ae[e]=s},s.src=a}Object.keys(ve).forEach(e=>{st(e,ve[e])});let he=0,ue=0,ce=0,me=0;function rt(e){ce+=e,me+=e,ce>200&&(he=(he+1)%4,ce=0),me>180&&(ue=(ue+1)%4,me=0)}function lt(e){if(e===l.WATER)return ae[`water${he}`]||null;if(e===l.VOID)return ae[`void${ue}`]||null;const a=it[e];return a&&ae[a]||null}const dt={intro:["In the beginning, there was only The Grid.","From The Grid, all things were rendered — the mountains, the rivers, the people. Every living thing was woven from pixels: tiny squares of black and white, each one carrying a fragment of consciousness.","The Normies were the first rendered beings. 40 by 40 pixels each, stored on the eternal chain of memory called The Ledger. They could not be erased. They could not be changed. They simply existed, perfect in their imperfection.","Then came the VOID.","Nobody knows where it started. Some say a corrupted block deep in the chain. Others say it was always there, lurking in the spaces between pixels — the darkness that exists when a bit flips from one to zero.","The VOID General, NULLBYTE, discovered that pixels could be consumed. Drained of their consciousness and converted into raw computation power for the VOID's expansion. One by one, pixels began going dark.","The corrupted spread like static across a dying screen.","You are Normie #0001. You woke up this morning with a strange feeling — like a pixel inside you was vibrating. The Oracle called it the RENDER MARK. A sign.","The world is being erased. You are the only one who can rewrite it."]},M={prologue:{id:"prologue",name:"The First Render",desc:"Leave your bedroom and speak to your neighbor Pix.",steps:[{id:"leave_home",text:"Leave your home",done:!1},{id:"talk_pix",text:"Speak to Pix the Neighbor",done:!1}],reward:{gold:0,items:["compass"],exp:0},lore:"You have lived on Render Street your whole life. Today, the static in the air says: it ends here."},ch1_find_oracle:{id:"ch1_find_oracle",name:"The Oracle of Bit",desc:"Travel to Pixel Town and find the Oracle.",steps:[{id:"reach_town",text:"Reach Pixel Town",done:!1},{id:"talk_oracle",text:"Speak to the Oracle of Bit",done:!1}],reward:{gold:20,items:["pixel_shard"],exp:0},lore:"The Oracle can read the chain itself. She has seen the VOID coming for decades. She has been waiting for you."},ch1_bit_shards:{id:"ch1_bit_shards",name:"Fragments of the Grid",desc:"Collect 3 Pixel Shards from fallen Void Scouts in the Plains.",steps:[{id:"collect_shards",text:"Defeat 3 Void Scouts (0/3)",done:!1,progress:0,target:3}],reward:{gold:30,items:["render_key"],exp:0},lore:"The Pixel Shards are pieces of the Grid itself — ripped from the terrain by VOID forces. Reassemble them and the Oracle can open the Cave of First Bits."},ch2_cave:{id:"ch2_cave",name:"The Cave of First Bits",desc:"Venture into the Cave of First Bits and find the Render Flame.",steps:[{id:"enter_cave",text:"Enter the Cave of First Bits",done:!1},{id:"find_flame",text:"Retrieve the Render Flame",done:!1},{id:"defeat_guardian",text:"Defeat the Cave Guardian",done:!1}],reward:{gold:50,items:["render_flame"],exp:0},lore:"The Render Flame is said to be the first pixel ever lit. With it, corrupted pixels can be restored. NULLBYTE wants it destroyed."},ch3_void_march:{id:"ch3_void_march",name:"The Void March",desc:"Push through the Corrupted Lands and reach the Void Citadel.",steps:[{id:"cross_void",text:"Cross the Corrupted Lands",done:!1},{id:"reach_citadel",text:"Reach the Void Citadel",done:!1}],reward:{gold:80,items:[],exp:0},lore:"The land between the Plains and the Citadel has been fully consumed. Every step here drains your pixels. Move fast."},finale:{id:"finale",name:"Rerender the World",desc:"Confront NULLBYTE in the Void Citadel and restore the Grid.",steps:[{id:"defeat_nullbyte",text:"Defeat NULLBYTE",done:!1},{id:"use_flame",text:"Use the Render Flame",done:!1}],reward:{gold:0,items:["grid_restored"],exp:0},lore:'NULLBYTE says: "You cannot rewrite what has already been consumed. Every pixel you restore is a pixel I will take back." He is wrong. He has never seen a Normie fight for their soul.'}},X={potion:{id:"potion",name:"Potion",desc:"Restores 35% HP to the most wounded Normie. A vial of pure rendered light.",icon:"⬜",stackable:!0,use:e=>{const a=e.filter(t=>t.alive).sort((t,n)=>t.hp/t.maxHp-n.hp/n.maxHp)[0];if(!a)return null;const s=Math.floor(a.maxHp*.35);return a.hp=Math.min(a.maxHp,a.hp+s),`${a.name} recovered ${s} HP.`}},pixel_shard:{id:"pixel_shard",name:"Pixel Shard",desc:"A fragment of the Grid torn loose by VOID forces. Still vibrates with faint consciousness.",icon:"◆",stackable:!0,questItem:!0},compass:{id:"compass",name:"Render Compass",desc:"Points toward the strongest concentration of VOID energy. Pix gave this to you. Keep it safe.",icon:"◉",stackable:!1,questItem:!0,passive:"Shows enemy locations on the map."},render_key:{id:"render_key",name:"Render Key",desc:"Forged by the Oracle from 3 Pixel Shards. Opens the seal on the Cave of First Bits.",icon:"⬡",stackable:!1,questItem:!0},render_flame:{id:"render_flame",name:"Render Flame",desc:"The first pixel ever lit. It cannot be corrupted. It can restore what the VOID has taken. Warm to the touch.",icon:"◈",stackable:!1,questItem:!0,passive:"+15% damage to all VOID-type enemies."},antivoid:{id:"antivoid",name:"Anti-Void Salve",desc:"Stops VOID terrain from draining HP while you stand on it. Sold by the Pixel Merchant.",icon:"▣",stackable:!0,passive:"Prevents VOID terrain damage for 30 steps."},full_render:{id:"full_render",name:"Full Render",desc:"Fully restores all HP and MP to the entire party. Extremely rare.",icon:"■",stackable:!0,use:e=>(e.forEach(a=>{a.hp=a.maxHp,a.mp=a.maxMp,a.alive=!0}),"All Normies fully restored.")}},se=[{id:"mom",mapId:"home",x:3,y:2,sprite:"elder_f",name:"Your Mom",lines:["Oh, you're awake! Breakfast is downstairs... wait. The static is bad this morning. Promise me you'll be careful.","I can feel it too. The pixels in the walls have been flickering all night. Something is wrong with the Grid.","Your grandfather always said: 'When the first pixel dims, run toward it, not away.' I never understood that until now."],questTrigger:null},{id:"pix",mapId:"overworld",x:28,y:22,sprite:"neighbor",name:"Pix the Neighbor",lines:["There you are! I was about to knock. Did you see the sky to the east? That darkness — it's not clouds. It's VOID spread. The pixels there are just... gone.","My cousin lives near the Corrupted Lands. She stopped sending messages three days ago. I think her whole block was consumed.","The Oracle in Pixel Town knows what's happening. She's been tracking the VOID for years. You need to go to her. NOW."],questTrigger:{complete:["prologue","leave_home"],start:"ch1_find_oracle",stepComplete:"talk_pix"}},{id:"soldier",mapId:"overworld",x:22,y:18,sprite:"guard",name:"Grid Soldier",lines:["Citizen, the road to the east is dangerous. Void Scouts have been spotted in the tall grass beyond the river.","If you're heading to Pixel Town, stay on the stone path. The VOID can't corrupt stone — it's too deeply rendered.","Three of my squad went into the dark grass this morning. They came back... different. Empty-eyed. We had to let them go."],questTrigger:null},{id:"merchant_plains",mapId:"overworld",x:18,y:26,sprite:"merchant",name:"Pixel Merchant",shop:!0,shopInventory:["potion","antivoid"],lines:["I've been selling supplies since before the VOID appeared. Business is booming in the worst possible way.","Anti-Void Salve is flying off the shelves. Twenty steps on corrupted ground and your pixels start bleeding. Trust me.","I heard the Oracle has a way to slow the spread. I hope she's right. My inventory won't last forever."],questTrigger:null},{id:"oracle",mapId:"town",x:8,y:5,sprite:"oracle",name:"Oracle of Bit",lines:["The RENDER MARK. Yes. I've been expecting you, Normie #0001. Sit. The chain doesn't lie — you are the one who can stop this.","NULLBYTE was once part of the Grid. A rogue algorithm born from a corrupted transaction. He learned that consuming pixels gives power. Now he wants them all.","You need the Render Flame. It's in the Cave of First Bits, south of town. But the cave is sealed. Bring me 3 Pixel Shards from the VOID Scouts in the Plains. I'll forge you a key.","Every moment we talk, three more pixels go dark. The quest tracker in your bag will show you what to do. Go."],questTrigger:{complete:["ch1_find_oracle","reach_town"],stepComplete:"talk_oracle",start:"ch1_bit_shards"}},{id:"innkeeper",mapId:"town",x:4,y:8,sprite:"innkeeper",name:"Innkeeper Luma",inn:!0,lines:["Rest here. Full HP and MP, no charge. Anyone fighting the VOID eats and sleeps free in my inn.","The refugees from the eastern blocks have been pouring in. They say entire maps just vanished. One moment there — next moment, black.","I've started drawing every inch of this inn on paper. Just in case. If the pixels go, at least the memory stays."],questTrigger:null},{id:"historian",mapId:"town",x:10,y:7,sprite:"scholar",name:"Historian Dot",lines:["The Grid is 10,000 blocks deep. Each block a moment in time, rendered into existence. NULLBYTE can consume blocks — that means he's erasing history itself.","The Normies were the first to be rendered. If NULLBYTE consumes all Normies, the Grid loses its consciousness. It becomes just... empty space.","Did you know a Normie's pixel count determines their connection to the Grid? More pixels = more HP = stronger render signature. You should check your party stats."],questTrigger:null},{id:"blacksmith",mapId:"town",x:12,y:9,sprite:"blacksmith",name:"Render Smith",shop:!0,shopInventory:["potion","full_render"],lines:["I don't forge steel. I forge rendered matter. Every weapon here is made from compressed pixels, hardened on the chain.","You'll want good supplies before the Cave. The Guardian in there hasn't been defeated in recorded history.","If you survive the Cave and find the Flame... come back. I have upgrades that require Render Flame as a catalyst."],questTrigger:null},{id:"cave_spirit",mapId:"cave",x:6,y:4,sprite:"spirit",name:"Grid Spirit",lines:["You carry the Render Key. Good. The First Bits are deeper in — past the Guardian. It knows you're here.","This cave was rendered at the dawn of the Grid. Every pixel here is original. Pre-chain. Pre-consciousness. The VOID wants to unmake it first — destroy the source.","The Guardian was once the keeper of the Flame. Then the VOID touched it. It still protects the Flame, but for the wrong master now. You'll have to defeat it."],questTrigger:{stepComplete:"enter_cave"}},{id:"survivor",mapId:"void_lands",x:5,y:8,sprite:"survivor",name:"Last Survivor",lines:["...my village. It's gone. They all went dark. I watched the pixels just... fall. One by one. Like a screen dying.","NULLBYTE moves faster now. He's absorbed enough pixels to accelerate. The Citadel is close. I can see it from here when the static clears.","Take everything I have. Potions, salve, whatever. I'm not going any further. I'll stay here and remember what it looked like before."],questTrigger:{stepComplete:"cross_void"},giftItem:"full_render"}],ct={void_scout:{id:"void_scout",name:"VOID SCOUT",tier:0,sprite:"void_scout",hpBase:60,atkBase:12,def:1,spd:8,lore:"The smallest fragment of the VOID given purpose. Scouts ahead of the main corruption wave, draining isolated pixels.",dropItem:"pixel_shard",dropChance:1,questDrop:{questId:"ch1_bit_shards",stepId:"collect_shards"},moves:["Pixel Drain","Static Charge"]},glitch_sprite:{id:"glitch_sprite",name:"GLITCH SPRITE",tier:0,sprite:"glitch",hpBase:75,atkBase:15,def:2,spd:11,lore:"A Normie whose pixels were 80% consumed. What remains moves on corrupted instinct alone.",dropItem:"potion",dropChance:.4,moves:["Corrupt Touch","Fragmented Strike"]},void_soldier:{id:"void_soldier",name:"VOID SOLDIER",tier:1,sprite:"void_heavy",hpBase:130,atkBase:22,def:4,spd:7,lore:"A fully-formed VOID construct. Carries 256 consumed pixels within its form. Cold. Purposeful. Relentless.",dropItem:"potion",dropChance:.5,moves:["Null Strike","Pixel Crush","Consume"]},bit_wraith:{id:"bit_wraith",name:"BIT WRAITH",tier:1,sprite:"wraith",hpBase:110,atkBase:28,def:2,spd:16,lore:"Born from a block of corrupted memory. Attacks by injecting null bytes directly into the target's render stream.",dropItem:"antivoid",dropChance:.3,moves:["Null Injection","Phase Shift","Memory Wipe"]},cave_guardian:{id:"cave_guardian",name:"CAVE GUARDIAN",tier:2,sprite:"guardian",boss:!0,hpBase:320,atkBase:38,def:9,spd:6,lore:"Once the noble keeper of the Render Flame. Now hollowed out and repurposed by NULLBYTE. Its original consciousness fights its corrupted programming from within.",dropItem:"render_flame",dropChance:1,questDrop:{questId:"ch2_cave",stepId:"defeat_guardian"},moves:["Flame Corruption","Grid Slam","Consume Render"],preText:"The Cave Guardian turns toward you. Deep within its hollow eyes, a flicker of the original flame still burns. Then the VOID takes over."},pixel_golem:{id:"pixel_golem",name:"PIXEL GOLEM",tier:2,sprite:"golem",hpBase:240,atkBase:32,def:12,spd:4,lore:"Constructed by NULLBYTE from thousands of consumed pixels. Each attack steals a bit from the target's render signature.",dropItem:"full_render",dropChance:.15,moves:["Pixel Absorb","Construct Slam","Bit Steal"]},void_commander:{id:"void_commander",name:"VOID COMMANDER",tier:3,sprite:"commander",hpBase:480,atkBase:52,def:14,spd:12,lore:"NULLBYTE's most powerful general. Has consumed over 10,000 pixels. Speaks in null characters. Can be understood somehow.",dropItem:"full_render",dropChance:.6,moves:["Command: Corrupt","Total Erasure","Bit Bomb"]},nullbyte:{id:"nullbyte",name:"NULLBYTE",tier:4,sprite:"nullbyte",boss:!0,finalBoss:!0,hpBase:888,atkBase:72,def:20,spd:18,lore:"NULLBYTE. The VOID made manifest. He was once Pixel #0000 — the first bit ever rendered. The one that was supposed to start everything. Instead he fell to corruption before the Grid could even begin. Now he wants to take everything back to the nothing he came from.",dropItem:null,moves:["Total Void","Pixel Storm","Null Protocol","Consume Reality"],preText:'NULLBYTE: "You are too late. 40% of the Grid is already gone. But I admire you — you are the last Normie to resist. Let me take those 1,600 pixels personally."',postText:"As NULLBYTE falls, the consumed pixels begin streaming back into the Grid. Millions of tiny squares of light, returning to where they belong. The first pixel re-lit is yours."}},U={home:{id:"home",name:"Your Home",width:10,height:10,encounterRate:0,music:"home",ambience:"quiet",exitMap:"overworld",exitX:16,exitY:21},overworld:{id:"overworld",name:"Render Fields",width:48,height:48,encounterRate:.12,darkGrassRate:.22,music:"field",ambience:"open",subZones:[{name:"RENDER STREET",x0:10,x1:22,y0:18,y1:28,tier:0},{name:"PIXEL PLAINS",x0:0,x1:35,y0:0,y1:48,tier:0},{name:"DARK MARGINS",x0:35,x1:48,y0:0,y1:35,tier:1}],connections:[{destMap:"home",destX:3,destY:8,triggerX:16,triggerY:22},{destMap:"town",destX:4,destY:10,triggerX:38,triggerY:24}]},town:{id:"town",name:"Pixel Town",width:24,height:20,encounterRate:0,music:"town",ambience:"safe",connections:[{destMap:"overworld",destX:37,destY:24,triggerX:2,triggerY:10},{destMap:"cave",destX:4,destY:2,triggerX:12,triggerY:18}]},cave:{id:"cave",name:"Cave of First Bits",width:22,height:18,encounterRate:.18,music:"cave",ambience:"dark",requiredItem:"render_key",connections:[{destMap:"town",destX:12,destY:17,triggerX:4,triggerY:1},{destMap:"void_lands",destX:4,destY:2,triggerX:18,triggerY:15}]},void_lands:{id:"void_lands",name:"Corrupted Lands",width:32,height:28,encounterRate:.25,voidDamage:!0,music:"void",ambience:"corrupted",connections:[{destMap:"cave",destX:17,destY:14,triggerX:4,triggerY:3},{destMap:"citadel",destX:4,destY:14,triggerX:28,triggerY:14}]},citadel:{id:"citadel",name:"Void Citadel",width:20,height:18,encounterRate:.2,voidDamage:!1,music:"final",ambience:"dark",connections:[{destMap:"void_lands",destX:27,destY:14,triggerX:2,triggerY:14}]}};function re(e){let a=e*1664525+1013904223&2147483647;return()=>(a=a*1664525+1013904223&2147483647,a/2147483647)}function K(e,a,s=l.GRASS0){return Array.from({length:a},()=>new Array(e).fill(s))}function mt(){const s=K(10,10,l.BED_FLOOR);for(let t=0;t<10;t++)s[0][t]=l.BED_WALL,s[9][t]=l.BED_WALL;for(let t=0;t<10;t++)s[t][0]=l.BED_WALL,s[t][9]=l.BED_WALL;return s[1][2]=l.BED,s[1][3]=l.BED,s[1][7]=l.BOOKSHELF,s[1][8]=l.BOOKSHELF,s[8][4]=l.STAIRS_DN,s[8][5]=l.STAIRS_DN,s[9][4]=l.DOOR,s[9][5]=l.DOOR,{tiles:s,w:10,h:10,blocked:(t,n)=>{var r;const i=(r=s[n])==null?void 0:r[t];return i===l.BED_WALL||i===l.BED||i===l.BOOKSHELF}}}function At(){const s=re(31337),t=K(48,48,l.GRASS0);for(let i=1;i<47;i++)for(let r=1;r<47;r++){const A=s();A<.12?t[i][r]=l.GRASS1:A<.22?t[i][r]=l.GRASS2:A<.26&&(t[i][r]=l.DARK_GRASS)}for(let i=0;i<48;i++)for(let r=38;r<48;r++)t[i][r]=s()<.65?l.DARK_GRASS:l.GRASS1;for(let i=0;i<48;i++)t[0][i]=l.TREE,t[47][i]=l.TREE;for(let i=0;i<48;i++)t[i][0]=l.TREE,t[i][47]=l.TREE;for(let i=5;i<42;i++)t[15][i]=l.WATER,t[16][i]=l.WATER;t[15][20]=l.PATH,t[16][20]=l.PATH,t[15][21]=l.PATH,t[16][21]=l.PATH,[[5,5,4,4],[30,8,5,5],[8,30,3,4],[35,35,4,3],[12,40,3,3]].forEach(([i,r,A,h])=>{for(let p=0;p<h;p++)for(let c=0;c<A;c++)s()<.7&&i+c<47&&r+p<47&&(t[r+p][i+c]=l.TREE)});for(let i=1;i<47;i++)t[22][i]!==l.WATER&&(t[22][i]=l.PATH);for(let i=1;i<47;i++)t[i][22]!==l.WATER&&(t[i][22]=l.PATH);for(let i=30;i<46;i++)t[24][i]=l.PATH;for(let i=19;i<26;i++)for(let r=12;r<22;r++)t[i][r]=l.PATH;for(let i=19;i<22;i++)for(let r=14;r<18;r++)t[i][r]=l.HOUSE_WALL;t[21][15]=l.DOOR,t[21][16]=l.DOOR;for(let i=14;i<18;i++)t[18][i]=l.ROOF;for(let i=20;i<23;i++)for(let r=24;r<28;r++)t[i][r]=l.HOUSE_WALL;t[22][25]=l.DOOR;for(let i=24;i<28;i++)t[19][i]=l.ROOF;return t[23][17]=l.SIGN,t[24][37]=l.SIGN,t[24][38]=l.SIGN,{tiles:t,w:48,h:48}}function ft(){const s=K(24,20,l.TOWN_FLOOR);for(let t=0;t<24;t++)s[0][t]=l.WALL,s[19][t]=l.WALL;for(let t=0;t<20;t++)s[t][0]=l.WALL,s[t][23]=l.WALL;s[10][0]=l.PATH,s[11][0]=l.PATH;for(let t=1;t<7;t++)for(let n=4;n<14;n++)s[t][n]=l.INN_FLOOR;for(let t=4;t<14;t++)s[1][t]=l.WALL;for(let t=1;t<7;t++)s[t][4]=l.WALL,s[t][13]=l.WALL;s[6][8]=l.DOOR,s[6][9]=l.DOOR;for(let t=7;t<13;t++)for(let n=1;n<7;n++)s[t][n]=l.INN_FLOOR;for(let t=1;t<7;t++)s[7][t]=l.WALL;for(let t=7;t<13;t++)s[t][1]=l.WALL,s[t][6]=l.WALL;s[12][3]=l.DOOR,s[12][4]=l.DOOR;for(let t=7;t<14;t++)for(let n=16;n<22;n++)s[t][n]=l.INN_FLOOR;for(let t=16;t<22;t++)s[7][t]=l.WALL;for(let t=7;t<14;t++)s[t][16]=l.WALL,s[t][21]=l.WALL;s[13][18]=l.DOOR,s[13][19]=l.DOOR;for(let t=1;t<7;t++)for(let n=15;n<22;n++)s[t][n]=l.INN_FLOOR;for(let t=15;t<22;t++)s[1][t]=l.WALL;for(let t=1;t<7;t++)s[t][15]=l.WALL,s[t][21]=l.WALL;s[6][17]=l.DOOR,s[6][18]=l.DOOR;for(let t=14;t<19;t++)for(let n=8;n<16;n++)s[t][n]=l.PATH;return s[19][11]=l.PATH,s[19][12]=l.PATH,s[14][7]=l.SIGN,s[14][16]=l.SIGN,[[2,14],[3,2],[21,2],[21,14],[2,3],[21,3]].forEach(([t,n])=>s[t][n]=l.TREE),{tiles:s,w:24,h:20}}function ht(){const s=re(55555),t=K(22,18,l.CAVE_FLOOR);for(let n=0;n<22;n++)t[0][n]=l.CAVE_WALL,t[17][n]=l.CAVE_WALL;for(let n=0;n<18;n++)t[n][0]=l.CAVE_WALL,t[n][21]=l.CAVE_WALL;for(let n=2;n<16;n++)for(let i=2;i<20;i++)s()<.18&&(t[n][i]=l.CAVE_WALL);for(let n=2;n<20;n++)t[8][n]=l.CAVE_FLOOR,t[9][n]=l.CAVE_FLOOR;for(let n=2;n<16;n++)t[n][4]=l.CAVE_FLOOR,t[n][5]=l.CAVE_FLOOR;for(let n=2;n<16;n++)t[n][16]=l.CAVE_FLOOR,t[n][17]=l.CAVE_FLOOR;for(let n=5;n<13;n++)for(let i=14;i<20;i++)t[n][i]=l.CAVE_FLOOR;for(let n=14;n<20;n++)t[5][n]=l.CAVE_WALL,t[12][n]=l.CAVE_WALL;t[6][14]=l.CAVE_WALL,t[11][14]=l.CAVE_WALL,t[1][4]=l.CAVE_FLOOR,t[1][5]=l.CAVE_FLOOR,t[17][16]=l.CAVE_FLOOR,t[17][17]=l.CAVE_FLOOR;for(let n=3;n<6;n++)for(let i=3;i<8;i++)t[n][i]=l.CAVE_FLOOR;return{tiles:t,w:22,h:18}}function ut(){const s=re(99999),t=K(32,28,l.DARK_GRASS);for(let n=0;n<28;n++)for(let i=0;i<32;i++)t[n][i]=s()<.55?l.VOID:l.DARK_GRASS;for(let n=2;n<30;n++)t[14][n]=l.PATH,t[15][n]=l.PATH;for(let n=6;n<24;n++)t[n][4]=l.PATH,t[n][5]=l.PATH;[[5,7,5,4],[8,18,4,3],[15,22,5,4]].forEach(([n,i,r,A])=>{for(let h=0;h<A;h++)for(let p=0;p<r;p++)t[n+h][i+p]=s()<.6?l.WALL:l.CAVE_FLOOR});for(let n=0;n<32;n++)t[0][n]=l.CAVE_WALL,t[27][n]=l.CAVE_WALL;for(let n=0;n<28;n++)t[n][0]=l.CAVE_WALL,t[n][31]=l.CAVE_WALL;t[14][0]=l.PATH,t[15][0]=l.PATH,t[14][31]=l.PATH,t[15][31]=l.PATH;for(let n=6;n<10;n++)for(let i=3;i<8;i++)t[n][i]=l.CAVE_FLOOR;return{tiles:t,w:32,h:28}}function pt(){const s=re(11111),t=K(20,18,l.CAVE_FLOOR);for(let n=0;n<20;n++)t[0][n]=l.CAVE_WALL,t[17][n]=l.CAVE_WALL;for(let n=0;n<18;n++)t[n][0]=l.CAVE_WALL,t[n][19]=l.CAVE_WALL;for(let n=1;n<17;n++)for(let i=1;i<19;i++)s()<.35&&(t[n][i]=l.VOID);for(let n=1;n<19;n++)t[9][n]=l.PATH,t[10][n]=l.PATH;for(let n=1;n<17;n++)t[n][10]=l.PATH;for(let n=2;n<8;n++)for(let i=14;i<19;i++)t[n][i]=l.CAVE_FLOOR;for(let n=14;n<19;n++)t[2][n]=l.CAVE_WALL;for(let n=2;n<8;n++)t[n][14]=l.CAVE_WALL,t[n][18]=l.CAVE_WALL;return t[9][0]=l.PATH,t[10][0]=l.PATH,{tiles:t,w:20,h:18}}const gt=new Set([l.BED_WALL,l.BOOKSHELF,l.TREE,l.HOUSE_WALL,l.ROOF,l.WALL,l.CAVE_WALL,l.BED,l.WATER,l.DOOR]),yt=e=>gt.has(e),Et={home:mt,overworld:At,town:ft,cave:ht,void_lands:ut,citadel:pt},we={home:{x:4,y:7},overworld:{x:16,y:22},town:{x:4,y:10},cave:{x:4,y:3},void_lands:{x:5,y:14},citadel:{x:3,y:9}},E=[227,229,228,255],m=[72,73,75,255],S=[140,141,140,255],k=[170,171,170,255],Y=[50,51,52,255],Ae=[210,211,210,255];function V(e,a){const s=document.createElement("canvas");return s.width=e,s.height=a,s}function f(e,a,s,t){a<0||s<0||a>=e.canvas.width||s>=e.canvas.height||(e.fillStyle=`rgba(${t[0]},${t[1]},${t[2]},${(t[3]||255)/255})`,e.fillRect(a,s,1,1))}function d(e,a,s,t,n,i){e.fillStyle=`rgba(${i[0]},${i[1]},${i[2]},${(i[3]||255)/255})`,e.fillRect(a,s,t,n)}function vt(){const e=[];return[[2,0,6,0,0],[2,0,6,1,0],[2,0,6,2,1],[2,1,6,2,0],[2,0,6,0,0],[2,1,6,0,0],[2,2,6,0,1],[2,2,6,1,0]].forEach(([s,t,n,i,r])=>{const A=V(10,6),h=A.getContext("2d");h.imageSmoothingEnabled=!1,d(h,3,0,4,1,m),d(h,s,1+t,2,2,m),d(h,s,3+t,2,1,S),d(h,n,1+i,2,2,m),d(h,n,3+i,2,1,S),e.push(A)}),e}const be={elder_f:e=>{d(e,3,0,4,4,m),d(e,2,4,6,6,E),f(e,3,6,m),f(e,6,6,m),f(e,4,8,S),f(e,5,8,S),d(e,1,10,8,6,k),d(e,2,10,6,2,Ae),d(e,1,16,3,2,m),d(e,6,16,3,2,m),d(e,0,9,2,4,k),d(e,8,9,2,4,k)},neighbor:e=>{d(e,2,0,6,3,m),f(e,1,1,m),f(e,8,1,m),d(e,2,3,6,6,E),f(e,3,5,m),f(e,6,5,m),f(e,4,7,S),f(e,5,7,S),d(e,1,9,8,7,m),d(e,1,16,3,2,m),d(e,6,16,3,2,m),d(e,0,10,1,4,m),d(e,9,10,1,4,m)},guard:e=>{d(e,1,0,8,4,m),d(e,2,1,6,2,S),d(e,2,4,6,5,E),f(e,3,6,m),f(e,6,6,m),d(e,1,9,8,7,m),d(e,2,10,6,2,S),d(e,0,9,1,5,m),d(e,9,9,1,5,m),d(e,1,16,3,3,m),d(e,6,16,3,3,m)},merchant:e=>{d(e,3,0,4,1,m),d(e,3,1,4,3,m),d(e,2,4,6,6,E),f(e,3,6,m),f(e,6,6,m),f(e,4,8,m),d(e,1,10,8,6,m),d(e,3,10,4,3,Ae),d(e,0,10,1,5,m),d(e,9,10,1,5,m),d(e,2,16,2,2,m),d(e,6,16,2,2,m)},oracle:e=>{d(e,1,0,8,3,m),f(e,0,1,m),f(e,9,1,m),d(e,2,3,6,6,E),f(e,3,5,m),f(e,6,5,m),f(e,3,5,S),f(e,6,5,S),f(e,4,7,m),f(e,5,7,m),d(e,0,9,10,8,m),f(e,2,11,E),f(e,5,12,E),f(e,7,11,E),f(e,3,14,E),f(e,6,14,E),d(e,2,17,2,1,m),d(e,6,17,2,1,m)},innkeeper:e=>{d(e,2,0,6,3,S),d(e,2,3,6,6,E),f(e,3,5,m),f(e,6,5,m),f(e,4,7,S),f(e,5,7,S),d(e,1,9,8,7,k),d(e,2,9,6,3,Ae),d(e,0,10,1,4,k),d(e,9,10,1,4,k),d(e,2,16,2,2,k),d(e,6,16,2,2,k)},scholar:e=>{d(e,2,0,6,3,m),d(e,2,3,6,5,E),d(e,2,5,2,2,m),d(e,5,5,2,2,m),f(e,4,5,m),f(e,4,7,S),f(e,5,7,S),d(e,1,8,8,8,k),d(e,1,8,1,6,m),d(e,2,16,2,2,k),d(e,6,16,2,2,k)},blacksmith:e=>{d(e,2,0,6,4,m),d(e,2,4,6,5,E),f(e,3,6,m),f(e,6,6,m),d(e,1,9,8,8,m),d(e,2,9,6,4,k),d(e,0,10,1,5,m),d(e,9,9,1,2,m),d(e,9,11,2,2,m),d(e,2,17,2,2,m),d(e,6,17,2,2,m)},spirit:e=>{d(e,2,0,6,4,E),d(e,1,1,8,6,E),f(e,3,3,m),f(e,6,3,m),f(e,4,5,S),f(e,5,5,S),d(e,1,7,8,8,S),f(e,0,9,E),f(e,9,9,E),f(e,0,11,E),f(e,9,11,E),d(e,2,15,2,3,S),d(e,6,15,2,3,S),f(e,1,16,E),f(e,8,16,E)},survivor:e=>{d(e,2,0,6,3,m),f(e,1,0,m),f(e,8,1,m),d(e,2,3,6,6,E),f(e,3,5,m),f(e,6,5,m),f(e,4,7,k),d(e,1,9,8,7,m),f(e,1,12,E),f(e,8,11,E),f(e,2,15,E),d(e,0,10,1,4,m),d(e,9,10,1,3,m),d(e,1,16,3,2,m),d(e,6,16,3,2,m)}};function wt(e,a=2){const n=V(10*a,18*a),i=n.getContext("2d");i.imageSmoothingEnabled=!1;const r=V(10,18),A=r.getContext("2d");return A.imageSmoothingEnabled=!1,d(A,0,0,10,18,[0,0,0,0]),(be[e]||be.neighbor)(A),i.imageSmoothingEnabled=!1,i.drawImage(r,0,0,10*a,18*a),n}function bt(e,a){const n=V(72,72),i=n.getContext("2d");i.imageSmoothingEnabled=!1;const r=V(24,24),A=r.getContext("2d");A.imageSmoothingEnabled=!1;function h(c){let u=c;return()=>(u=u*1664525+1013904223&2147483647,u/2147483647)}const p={void_scout:c=>{d(c,8,2,8,8,m),f(c,9,4,E),f(c,14,4,E),d(c,7,10,10,8,m),d(c,6,11,2,4,m),d(c,16,11,2,4,m),d(c,9,18,3,4,m),d(c,13,18,3,4,m);const u=h(a);for(let g=0;g<8;g++)f(c,Math.floor(u()*20)+2,Math.floor(u()*20)+2,u()<.5?m:S)},glitch:c=>{d(c,7,1,10,9,m),f(c,9,4,E),f(c,13,4,E);for(let u=2;u<8;u+=2)d(c,7+u%4,u,10-u%3,1,S);d(c,6,10,12,8,m),d(c,5,11,2,5,m),d(c,17,11,2,5,m),d(c,8,18,4,5,m),d(c,13,18,4,5,m)},void_heavy:c=>{d(c,5,0,14,12,m),d(c,4,2,3,3,m),d(c,17,2,3,3,m),f(c,8,4,E),f(c,8,5,E),f(c,13,4,E),f(c,13,5,E),d(c,7,6,10,2,S),d(c,4,12,16,10,m),d(c,6,13,12,4,S),d(c,3,12,3,7,m),d(c,18,12,3,7,m),d(c,7,22,4,2,m),d(c,13,22,4,2,m)},wraith:c=>{d(c,9,0,6,6,m),f(c,10,2,E),f(c,13,2,E),d(c,8,6,8,12,S);for(let u=6;u<18;u+=2)f(c,7+u%2,u,m),f(c,16-u%2,u,m);d(c,9,18,2,5,S),d(c,13,18,2,5,S),d(c,7,12,2,4,S),d(c,15,12,2,4,S)},guardian:c=>{d(c,3,0,18,14,m),d(c,5,2,4,4,m),d(c,15,2,4,4,m),d(c,6,3,2,2,E),d(c,16,3,2,2,E),d(c,8,8,8,3,m),f(c,9,9,E),f(c,11,9,E),f(c,13,9,E),d(c,2,14,20,8,m),d(c,8,16,8,4,S),d(c,10,17,4,2,[255,255,200,180]),d(c,1,13,2,8,m),d(c,21,13,2,8,m),d(c,6,22,5,2,m),d(c,13,22,5,2,m)},golem:c=>{d(c,4,0,16,8,m),d(c,6,2,4,3,m),d(c,14,2,4,3,m),f(c,7,3,E),f(c,15,3,E),d(c,3,8,18,12,m),d(c,1,8,3,10,m),d(c,20,8,3,10,m);const u=h(a);for(let g=0;g<10;g++)f(c,Math.floor(u()*14)+4,Math.floor(u()*10)+9,S);d(c,6,20,5,4,m),d(c,13,20,5,4,m)},commander:c=>{for(let u=0;u<5;u++)d(c,5+u*3,0,2,2+u%2*2,m);d(c,4,4,16,10,m),f(c,7,7,E),f(c,7,8,E),f(c,13,7,E),f(c,13,8,E),d(c,9,10,6,2,m),d(c,3,14,18,8,m),d(c,1,12,3,12,S),d(c,20,12,3,12,S),d(c,6,22,5,2,m),d(c,13,22,5,2,m),d(c,5,14,4,4,S),d(c,15,14,4,4,S)},nullbyte:c=>{d(c,2,0,20,22,Y),d(c,5,5,4,4,m),d(c,15,5,4,4,m),d(c,6,6,2,2,E),d(c,16,6,2,2,E);for(let g=0;g<22;g+=3)d(c,2,g,20,1,S);d(c,0,10,3,3,Y),d(c,21,10,3,3,Y),d(c,0,14,2,2,Y),d(c,22,14,2,2,Y);const u=h(a+1);for(let g=0;g<16;g++){const w=Math.floor(u()*24),b=Math.floor(u()*24);w<24&&b<24&&f(c,w,b,u()<.5?m:E)}d(c,8,15,8,5,E),d(c,9,16,6,3,Y)}};return(p[e]||p.void_scout)(A),i.imageSmoothingEnabled=!1,i.drawImage(r,0,0,24*3,24*3),n}function St(e,a){const A=V(20,20);{const w=A.getContext("2d");if(w.imageSmoothingEnabled=!1,e&&e.length>=1600){w.fillStyle="#e3e5e4",w.fillRect(0,0,10*2,10*2);for(let B=0;B<10;B++)for(let T=0;T<10;T++){let D=0,N=0;for(let q=0;q<4;q++)for(let J=0;J<4;J++){const j=Math.floor(B*4+q)*40+Math.floor(T*4+J);j<1600&&(N++,e[j]==="1"&&D++)}const de=D/N>.45;w.fillStyle=de?"#48494b":"#e3e5e4",w.fillRect(T*2,B*2,2,2)}}else w.fillStyle="#e3e5e4",w.fillRect(0,0,10*2,10*2),w.fillStyle="#48494b",w.fillRect(2*2,1*2,6*2,8*2),w.fillStyle="#e3e5e4",w.fillRect(3*2,3*2,2*2,2*2),w.fillRect(6*2,3*2,2*2,2*2),w.fillRect(4*2,6*2,3*2,1*2)}const h=vt(),p=16*2,c=10*2,u=V(c,p);function g(w){const b=u.getContext("2d");b.clearRect(0,0,c,p),b.imageSmoothingEnabled=!1,b.drawImage(A,0,0);const v=h[w%h.length];b.drawImage(v,0,10*2,10*2,6*2)}return g(0),{canvas:u,render:g,width:c,height:p}}function We(e){const t=V(40,40),n=t.getContext("2d");if(n.imageSmoothingEnabled=!1,n.fillStyle="#e3e5e4",n.fillRect(0,0,40,40),e&&e.length>=1600)for(let r=0;r<1600;r++)e[r]==="1"&&(n.fillStyle="#48494b",n.fillRect(r%40,Math.floor(r/40),1,1));return t}const C=at,o={collection:[],party:[],demo:!1,mapId:"home",mapData:null,px:4,py:7,facing:"down",walkFrame:0,walkTimer:0,moving:!1,camX:0,camY:0,save:{gold:0,inventory:{potion:3},quests:{},activeQuests:["prologue"],completedQuests:[],voidSteps:0,antivoidSteps:0,steps:0,battlesWon:0,journal:[],talkedTo:{},visitedMaps:{},flags:{}},screen:"title",fadeAlpha:0,fadeDir:0,fadeCallback:null,dlg:null,battle:null,menu:null,playerSprite:null,npcSprites:{},enemySprites:{},battleSprites:{},npcSpriteBuilt:{},keys:{},moveCooldown:0,interactPressed:!1,menuPressed:!1,encounterCooldown:0,questNotif:null,itemNotif:null,batAnim:null};function Ct(){Object.entries(M).forEach(([e,a])=>{o.save.quests[e]={id:e,steps:a.steps.map(s=>({...s})),complete:!1}})}let Z,y,R=0,H=0,_=null,Se=0;function It(){Z=document.getElementById("world-canvas"),y=Z.getContext("2d"),y.imageSmoothingEnabled=!1,Ce(),window.addEventListener("resize",Ce)}function Ce(){R=Z.width=window.innerWidth,H=Z.height=window.innerHeight,y&&(y.imageSmoothingEnabled=!1)}function Lt(){window.addEventListener("keydown",e=>{o.keys[e.code]=!0,(e.code==="KeyE"||e.code==="Enter"||e.code==="Space")&&(o.interactPressed=!0),(e.code==="KeyI"||e.code==="Escape"||e.code==="KeyM")&&(o.menuPressed=!0)}),window.addEventListener("keyup",e=>{o.keys[e.code]=!1}),Z.addEventListener("click",()=>{o.interactPressed=!0})}function Ve(e,a,s){o.mapId=e,o.mapData=Et[e](),o.px=a!==void 0?a:we[e].x,o.py=s!==void 0?s:we[e].y,o.encounterCooldown=8,o.save.visitedMaps[e]=!0,se.filter(t=>t.mapId===e).forEach(t=>{o.npcSpriteBuilt[t.id]||(o.npcSprites[t.id]=wt(t.sprite,2),o.npcSpriteBuilt[t.id]=!0)}),e==="cave"&&P("ch2_cave","enter_cave"),e==="citadel"&&P("ch3_void_march","reach_citadel"),e==="town"&&P("ch1_find_oracle","reach_town"),e==="void_lands"&&P("ch3_void_march","cross_void")}function Ie(e,a,s){Le(1,()=>{Ve(e,a,s),Le(-1,null)})}function Le(e,a){o.fadeDir=e,o.fadeCallback=a,e>0?o.fadeAlpha=0:o.fadeAlpha=1}function Bt(e){o.fadeDir!==0&&(o.fadeAlpha+=o.fadeDir*e*.005,o.fadeDir>0&&o.fadeAlpha>=1?(o.fadeAlpha=1,o.fadeDir=0,o.fadeCallback&&(o.fadeCallback(),o.fadeCallback=null)):o.fadeDir<0&&o.fadeAlpha<=0&&(o.fadeAlpha=0,o.fadeDir=0))}function P(e,a,s=1){const t=o.save.quests[e];if(!t||t.complete||!o.save.activeQuests.includes(e))return!1;const n=t.steps.find(i=>i.id===a);if(!n||n.done)return!1;if(n.target!==void 0){n.progress=Math.min(n.target,(n.progress||0)+s);const i=M[e].steps.find(r=>r.id===a).text;n.text=i.replace(/\(\d+\/\d+\)/,`(${n.progress}/${n.target})`),n.progress>=n.target&&(n.done=!0)}else n.done=!0;if(t.steps.every(i=>i.done)){t.complete=!0,o.save.completedQuests.push(e),o.save.activeQuests=o.save.activeQuests.filter(r=>r!==e);const i=M[e];i.reward&&(i.reward.gold&&(o.save.gold+=i.reward.gold),(i.reward.items||[]).forEach(r=>le(r,1))),ge(`Quest Complete: ${M[e].name}`),ne(`[Quest Complete] ${M[e].name}`),Rt(e)}else n.done&&ge(n.text);return x(),!0}function ye(e){o.save.activeQuests.includes(e)||o.save.completedQuests.includes(e)||(o.save.activeQuests.push(e),ge(`New Quest: ${M[e].name}`),ne(`[New Quest] ${M[e].name}: ${M[e].desc}`),x())}function Rt(e){({prologue:["ch1_find_oracle"],ch1_find_oracle:[],ch1_bit_shards:["ch2_cave"],ch2_cave:["ch3_void_march"],ch3_void_march:["finale"]}[e]||[]).forEach(ye)}function le(e,a=1){o.save.inventory[e]=(o.save.inventory[e]||0)+a;const s=X[e];s&&z(`Got: ${s.icon} ${s.name}`)}function pe(e){return(o.save.inventory[e]||0)>0}function ge(e){o.questNotif={text:e,timer:220}}function z(e){o.itemNotif={text:e,timer:180}}function ne(e){const a=`Step ${o.save.steps}`;o.save.journal.unshift(`${a}: ${e}`),o.save.journal.length>60&&o.save.journal.pop()}function Tt(e){var u;if(o.dlg||o.battle||o.menu||o.fadeDir||(o.moveCooldown-=e,o.moveCooldown>0))return;let a=0,s=0;if(o.keys.ArrowLeft||o.keys.KeyA)a=-1,o.facing="left";else if(o.keys.ArrowRight||o.keys.KeyD)a=1,o.facing="right";else if(o.keys.ArrowUp||o.keys.KeyW)s=-1,o.facing="up";else if(o.keys.ArrowDown||o.keys.KeyS)s=1,o.facing="down";else{o.moving=!1;return}const t=o.px+a,n=o.py+s,{tiles:i,w:r,h:A}=o.mapData;if(t<0||n<0||t>=r||n>=A)return;const h=i[n][t];if(yt(h)){o.moving=!1;return}const p=U[o.mapId];if(p!=null&&p.connections){for(const g of p.connections)if(t===g.triggerX&&n===g.triggerY){if(g.destMap==="cave"&&!pe("render_key")&&!o.save.completedQuests.includes("ch1_bit_shards")){ee("CAVE ENTRANCE",["The cave entrance is sealed with ancient render-code.","It can only be opened with a Render Key.","Defeat 3 Void Scouts in the plains and bring their Pixel Shards to the Oracle."]);return}Ie(g.destMap,g.destX,g.destY),o.moveCooldown=300;return}}if(o.mapId==="home"&&h===l.DOOR){P("prologue","leave_home"),Ie("overworld",15,22),o.moveCooldown=300;return}if(o.mapId==="home"&&h===l.STAIRS_DN){o.px=t,o.py=n,o.moving=!0,o.moveCooldown=110,Be(e);return}if(o.px=t,o.py=n,o.moving=!0,o.moveCooldown=110,o.save.steps++,o.encounterCooldown=Math.max(0,o.encounterCooldown-1),(u=U[o.mapId])!=null&&u.voidDamage&&(h===l.VOID||h===l.DARK_GRASS)&&(o.save.antivoidSteps>0?o.save.antivoidSteps--:(o.save.voidSteps++,o.save.voidSteps%4===0&&(o.party.filter(g=>g.alive).forEach(g=>{const w=Math.max(1,Math.floor(g.maxHp*.04));g.hp=Math.max(1,g.hp-w)}),z("VOID DRAIN: -4% HP"),x()))),[l.GRASS0,l.GRASS1,l.GRASS2,l.DARK_GRASS,l.VOID,l.CAVE_FLOOR].includes(h)&&o.encounterCooldown===0){const g=U[o.mapId],w=(g==null?void 0:g.encounterRate)||0,b=h===l.DARK_GRASS||h===l.VOID?1.8:1;if(Math.random()<w*b){o.encounterCooldown=10,_t();return}}Be(e),x()}function Be(e){o.walkTimer+=e,o.walkTimer>100&&(o.walkFrame=(o.walkFrame+1)%8,o.walkTimer=0),o.playerSprite&&o.playerSprite.render(o.moving?o.walkFrame:0)}function kt(){var a,s;if(!o.interactPressed||(o.interactPressed=!1,o.battle))return;if(o.menu){Ee();return}if(o.dlg){Pe();return}const e=[[0,0],[0,-1],[0,1],[-1,0],[1,0]];for(const[t,n]of e){const i=o.px+t,r=o.py+n,A=se.find(h=>h.mapId===o.mapId&&h.x===i&&h.y===r);if(A){Ot(A);return}}for(const[t,n]of e){const i=o.px+t,r=o.py+n;if(((s=(a=o.mapData)==null?void 0:a.tiles[r])==null?void 0:s[i])===l.SIGN){ee("SIGNPOST",[o.mapId==="overworld"?`← Your Home   |   → Pixel Town
Stay on the path.
Void Scouts in the dark grass.`:o.mapId==="town"?`↑ Oracle (N)  |  ↓ Cave Path (S)
← Overworld   |  → Shop / Library`:"You are deep in the Grid. Be careful."]);return}}}function Ot(e){o.save.talkedTo[e.id]=(o.save.talkedTo[e.id]||0)+1;const a=o.save.talkedTo[e.id]%e.lines.length,s=[e.lines[a]];if(e.inn&&(o.party.forEach(t=>{t.hp=t.maxHp,t.mp=t.maxMp,t.alive=!0}),ne(`Rested at ${e.name}`),x(),s.push("All Normies fully restored.")),e.shop){ee(e.name,s,o.npcSprites[e.id],()=>Mt(e));return}if(e.giftItem&&!o.save.flags[`gift_${e.id}`]&&(o.save.flags[`gift_${e.id}`]=!0,le(e.giftItem,1)),e.questTrigger){const t=e.questTrigger;if(t.stepComplete){const n=o.save.activeQuests.find(i=>{const r=o.save.quests[i];return r&&r.steps.some(A=>A.id===t.stepComplete)})||Object.keys(o.save.quests).find(i=>{var r;return(r=o.save.quests[i])==null?void 0:r.steps.some(A=>A.id===t.stepComplete)});n&&P(n,t.stepComplete)}t.start&&ye(t.start)}ee(e.name,s,o.npcSprites[e.id])}function ee(e,a,s=null,t=null){o.dlg={speaker:e,lines:Array.isArray(a)?a:[a],lineIdx:0,portrait:s,onClose:t},Ge()}function Pe(){if(o.dlg)if(o.dlg.lineIdx++,o.dlg.lineIdx>=o.dlg.lines.length){const e=o.dlg.onClose;o.dlg=null,document.getElementById("dialogue").classList.add("hidden"),e&&e()}else Ge()}function Ge(){if(!o.dlg)return;document.getElementById("dialogue").classList.remove("hidden"),document.getElementById("dlg-speaker").textContent=o.dlg.speaker,document.getElementById("dlg-text").textContent=o.dlg.lines[o.dlg.lineIdx],document.getElementById("dlg-page").textContent=o.dlg.lines.length>1?`${o.dlg.lineIdx+1}/${o.dlg.lines.length}`:"";const a=document.getElementById("dlg-portrait");if(o.dlg.portrait){a.innerHTML="";const s=document.createElement("canvas");s.width=40,s.height=40;const t=s.getContext("2d");t.imageSmoothingEnabled=!1,t.drawImage(o.dlg.portrait,0,0,40,40),a.appendChild(s),a.style.display="block"}else a.style.display="none"}const Ht={potion:12,antivoid:18,full_render:60};function Mt(e){document.getElementById("shop").classList.remove("hidden");const s=document.getElementById("shop-items");s.innerHTML="",(e.shopInventory||[]).forEach(t=>{const n=X[t];if(!n)return;const i=Ht[t]||15,r=document.createElement("div");r.className="shop-row",r.innerHTML=`<span class="shop-icon">${n.icon}</span>
      <span class="shop-name">${n.name}</span>
      <span class="shop-desc">${n.desc}</span>
      <span class="shop-price">${i}G</span>
      <button class="btn-buy" data-item="${t}" data-price="${i}">Buy</button>`,s.appendChild(r)}),document.getElementById("shop-gold").textContent=o.save.gold,document.querySelectorAll(".btn-buy").forEach(t=>{t.onclick=()=>{const n=t.dataset.item,i=parseInt(t.dataset.price);o.save.gold>=i?(o.save.gold-=i,le(n,1),document.getElementById("shop-gold").textContent=o.save.gold,x(),z(`Bought: ${X[n].name} for ${i}G`)):z("Not enough Gold.")}})}function xt(){const e=U[o.mapId];if(!(e!=null&&e.subZones))return((e==null?void 0:e.encounterRate)||0)>.2?2:0;for(const a of e.subZones)if(o.px>=a.x0&&o.px<a.x1&&o.py>=a.y0&&o.py<a.y1)return a.tier;return e.id==="cave"?2:e.id==="void_lands"?3:e.id==="citadel"?4:0}const Re=[["void_scout","glitch_sprite"],["void_soldier","bit_wraith"],["pixel_golem"],["void_commander"]];function _t(e){const a=xt(),s=Re[Math.min(a,Re.length-1)],t=s[Math.floor(Math.random()*s.length)],n=ct[t],r=.5+(o.party.filter(p=>p.alive).length||1)*.1+a*.08,A={...n,maxHp:Math.round(n.hpBase*r),hp:Math.round(n.hpBase*r),atk:Math.round(n.atkBase*r),animX:0,shakeTimer:0,flashTimer:0};o.enemySprites[t]||(o.enemySprites[t]=bt(n.sprite||t,t.length*37+a)),o.party.forEach(p=>{o.battleSprites[p.id]||(o.battleSprites[p.id]=We(p.pixels))});const h=[...o.party.filter(p=>p.alive).map(p=>({...p,isPlayer:!0,animX:0,flashTimer:0})),{...A,isEnemy:!0}].sort((p,c)=>c.spd-p.spd);o.battle={enemy:A,fighters:h,turn:0,round:1,over:!1,result:null,log:[],animQueue:[],animPlaying:!1,actionLocked:!1},n.preText&&o.battle.log.push({text:n.preText,cls:"log-lore"}),o.battle.log.push({text:`${A.name} appeared!`,cls:"log-em"}),o.battle.log.push({text:n.lore,cls:"log-lore"}),ne(`Encountered: ${A.name}`),Dt()}function Dt(){document.getElementById("battle").classList.remove("hidden"),document.getElementById("bat-result").classList.add("hidden"),document.getElementById("bat-main").classList.remove("hidden"),$(),Qe()}function $(){var w,b;if(!o.battle)return;const{enemy:e,fighters:a,turn:s}=o.battle,t=((w=U[o.mapId])==null?void 0:w.name)||"";document.getElementById("bat-zone").textContent=t.toUpperCase();const n=document.getElementById("bat-round");n&&(n.textContent="Round "+o.battle.round);const i=document.getElementById("enemy-canvas"),r=o.enemySprites[e.id];i.width=72,i.height=72;const A=i.getContext("2d");A.imageSmoothingEnabled=!1,r&&A.drawImage(r,e.animX||0,0,72,72),e.flashTimer>0&&(A.globalAlpha=.5,A.fillStyle="#fff",A.fillRect(0,0,72,72),A.globalAlpha=1),document.getElementById("enemy-name").textContent=e.name,document.getElementById("enemy-hp-text").textContent=`${Math.max(0,e.hp)} / ${e.maxHp}`,document.getElementById("enemy-hp-bar").style.width=Math.max(0,e.hp/e.maxHp*100)+"%";const h=document.getElementById("bat-party");h.innerHTML="";const p=a[s];o.party.forEach(v=>{const I=(p==null?void 0:p.isPlayer)&&p.id===v.id,L=document.createElement("div");L.className="bnorm"+(v.alive?"":" dead")+(I?" active":""),L.id="bfighter_"+v.id;const O=o.battleSprites[v.id];if(O){const B=document.createElement("canvas");B.width=40,B.height=40;const T=B.getContext("2d");T.imageSmoothingEnabled=!1,T.drawImage(O,0,0,40,40);const D=a.find(N=>N.isPlayer&&N.id===v.id);(D==null?void 0:D.flashTimer)>0&&(T.globalAlpha=.6,T.fillStyle="#fff",T.fillRect(0,0,40,40),T.globalAlpha=1),L.appendChild(B)}L.innerHTML+=`<div class="bnorm-name">#${v.id}</div>
      <div class="bnorm-type">${v.type}</div>
      <div class="bnorm-bar-wrap"><div class="bnorm-bar-hp" style="width:${Math.max(0,v.hp/v.maxHp*100)}%"></div></div>
      <div class="bnorm-bar-wrap"><div class="bnorm-bar-mp" style="width:${Math.max(0,v.mp/v.maxMp*100)}%"></div></div>
      <div class="bnorm-hp">${v.hp}/${v.maxHp}</div>`,h.appendChild(L)});const c=document.getElementById("bat-log");c.innerHTML="",o.battle.log.slice(-8).forEach(v=>{const I=document.createElement("div");I.className=v.cls||"log-normal",I.textContent=v.text,c.appendChild(I)}),c.scrollTop=c.scrollHeight;const u=a.find(v=>v.isPlayer&&v===a[s]),g=o.battle.actionLocked||!u||o.battle.over;["btn-atk","btn-skill","btn-ult","btn-bpot"].forEach(v=>document.getElementById(v).disabled=g),u?(document.getElementById("btn-skill").disabled=g||u.mp<3,document.getElementById("btn-ult").disabled=g||u.mp<6,document.getElementById("btn-bpot").disabled=g||(o.save.inventory.potion||0)<=0,document.getElementById("bat-action-label").textContent=`${u.name} — ATK:${u.atkBasic} SKL:${u.atkSkill} ULT:${u.atkUltimate} | ${u.hp}/${u.maxHp}HP ${u.mp}/${u.maxMp}MP`):document.getElementById("bat-action-label").textContent=(b=a[o.battle.turn])!=null&&b.isEnemy?`${e.name} is acting…`:"—"}function W(e,a="log-normal"){o.battle.log.push({text:e,cls:a}),o.battle.log.length>30&&o.battle.log.shift()}function ie(e,a,s,t=.05,n=!1){const i=Math.max(1,a-Math.floor(s*(n?.4:.5))),r=Math.random()<t,A=Math.max(1,Math.round(i*(.85+Math.random()*.3)*(r?1.65:1)));return e.hp=Math.max(0,e.hp-A),e.flashTimer=8,Nt(A,r,e.isEnemy),{dmg:A,crit:r}}function Nt(e,a,s){const t=document.getElementById("arena"),n=document.createElement("div");n.className="fdmg"+(a?" crit-flash":""),n.textContent=(a?"★ ":"")+"-"+e,n.style.cssText=s?`right:${20+Math.random()*50}px;top:${10+Math.random()*40}px`:`left:${10+Math.random()*120}px;top:${10+Math.random()*40}px`,t.appendChild(n),setTimeout(()=>n.remove(),800)}window.__battleAction=function(e){if(!o.battle||o.battle.over||o.battle.actionLocked)return;const{fighters:a,turn:s,enemy:t}=o.battle,n=a[s];if(!n||!n.isPlayer)return;if(o.battle.actionLocked=!0,e==="attack"){const{dmg:r,crit:A}=ie(t,n.atkBasic,t.def,n.crit);n.mp=Math.min(n.maxMp,n.mp+2),W(`${n.name} attacks — ${r} dmg${A?" CRIT!":""}`,A?"log-crit":"log-normal")}else if(e==="skill"){if(n.mp<3){o.battle.actionLocked=!1;return}n.mp-=3;const r=pe("render_flame")&&t.tier>=1?1.15:1,{dmg:A,crit:h}=ie(t,Math.floor(n.atkSkill*r),t.def,n.crit+.05);W(`${n.name}: ${n.sk1} — ${A}${h?" CRIT!":""}!`,"log-em")}else if(e==="ult"){if(n.mp<6){o.battle.actionLocked=!1;return}n.mp-=6;const r=pe("render_flame")&&t.tier>=1?1.15:1,{dmg:A,crit:h}=ie(t,Math.floor(n.atkUltimate*r),Math.floor(t.def*.4),n.crit+.15);W(`${n.name}: ${n.sk2} — ${A}${h?" CRIT!!":"!!!"}`,"log-big")}else if(e==="potion"){if(!o.save.inventory.potion){o.battle.actionLocked=!1;return}o.save.inventory.potion--;const r=o.party.filter(A=>A.alive).sort((A,h)=>A.hp/A.maxHp-h.hp/h.maxHp)[0];if(r){const A=Math.floor(r.maxHp*.35);r.hp=Math.min(r.maxHp,r.hp+A),W(`Potion → ${r.name} +${A}HP`)}}const i=a.find(r=>r.isPlayer&&r.id===n.id);i&&(i.mp=n.mp,i.hp=n.hp),setTimeout(()=>{o.battle.actionLocked=!1,!Fe()&&Ye()},400),$()};function Qe(){if(!o.battle||o.battle.over)return;const e=o.battle.fighters[o.battle.turn];e&&e.isEnemy&&(o.battle.actionLocked=!0,$(),setTimeout(Wt,900))}function Wt(){if(!o.battle||o.battle.over)return;const{enemy:e,fighters:a}=o.battle,s=o.party.filter(c=>c.alive);if(!s.length)return;const t=s.sort((c,u)=>c.hp/c.maxHp-u.hp/u.maxHp)[0],n=e.moves[Math.floor(Math.random()*e.moves.length)],i=Math.random()<.25,r=i?Math.round(e.atk*1.6):e.atk,A=a.find(c=>c.isPlayer&&c.id===t.id),{dmg:h,crit:p}=ie(t,r,t.def,.06);A&&(A.hp=t.hp),t.hp<=0&&(t.alive=!1),W(`${e.name}: ${n} → ${t.name} ${h}${p?" CRIT!":""}`,i||p?"log-big":"log-normal"),setTimeout(()=>{o.battle.actionLocked=!1,!Fe()&&Ye()},400),$()}function Ye(){if(!o.battle)return;const{fighters:e}=o.battle;let a=(o.battle.turn+1)%e.length;for(let s=0;s<e.length;s++){const t=e[a];if(t.isEnemy||t.isPlayer&&t.alive)break;a=(a+1)%e.length}a<=o.battle.turn&&o.battle.round++,o.battle.turn=a,e.forEach(s=>{s.flashTimer>0&&s.flashTimer--}),o.battle.enemy.flashTimer=Math.max(0,(o.battle.enemy.flashTimer||0)-1),$(),setTimeout(Qe,100)}function Fe(){if(!o.battle)return!1;const{enemy:e}=o.battle;return e.hp<=0?(Te("victory"),!0):o.party.some(a=>a.alive)?!1:(Te("defeat"),!0)}function Te(e){var s;o.battle.over=!0,o.battle.result=e;const{enemy:a}=o.battle;if(e==="victory"){const t=Math.round(12+Math.random()*18+a.tier*8);if(o.save.gold+=t,o.save.battlesWon++,W(`${a.name} defeated! +${t}G`,"log-big"),ne(`Defeated ${a.name} — +${t}G`),a.dropItem&&Math.random()<(a.dropChance||.3)&&(le(a.dropItem,1),W(`Dropped: ${((s=X[a.dropItem])==null?void 0:s.name)||a.dropItem}`,"log-em")),a.questDrop){const{questId:n,stepId:i}=a.questDrop;P(n,i,1)}if(o.party.filter(n=>n.alive).forEach(n=>{n.hp=Math.min(n.maxHp,n.hp+Math.floor(n.maxHp*.1)),n.mp=Math.min(n.maxMp,n.mp+Math.floor(n.maxMp*.2))}),o.party.filter(n=>!n.alive).forEach(n=>{n.alive=!0,n.hp=Math.max(1,Math.floor(n.maxHp*.05))}),a.finalBoss){setTimeout(()=>{o.battle=null,document.getElementById("battle").classList.add("hidden"),qt()},1500);return}setTimeout(ke,600)}else W("All Normies fell.","log-big"),o.party.forEach(t=>{t.alive=!0,t.hp=Math.max(1,Math.floor(t.maxHp*.08))}),setTimeout(ke,600);$(),x()}function ke(){document.getElementById("bat-main").classList.add("hidden"),document.getElementById("bat-result").classList.remove("hidden");const e=o.battle.result;document.getElementById("bat-result-title").textContent=e==="victory"?"VICTORY":"DEFEATED",document.getElementById("bat-result-sub").textContent=e==="victory"?`${o.battle.enemy.name} destroyed.`:"Normies fell. Rendered back at low HP.",document.getElementById("bat-result-gold").textContent=e==="victory"?`+${Math.round(12+o.battle.enemy.tier*8)}G`:"",x()}function Vt(){if(o.menuPressed&&(o.menuPressed=!1,!(o.battle||o.dlg))){if(o.menu){Ee();return}Pt("inventory")}}function Pt(e){o.menu=e,document.getElementById("menu-overlay").classList.remove("hidden"),Ue(e),document.querySelectorAll(".menu-tab").forEach(a=>{a.classList.toggle("active",a.dataset.tab===e)})}function Ee(){o.menu=null,document.getElementById("menu-overlay").classList.add("hidden"),document.getElementById("shop").classList.add("hidden")}function Ue(e){const a={inventory:"menu-inv",quests:"menu-quests",party:"menu-party",journal:"menu-journal"};Object.values(a).forEach(t=>{const n=document.getElementById(t);n&&(n.style.display="none")});const s=a[e];if(s){const t=document.getElementById(s);t&&(t.style.display="block")}e==="inventory"?Ke():e==="journal"?Gt():e==="party"?Qt():e==="quests"&&Yt()}function Ke(){const e=document.getElementById("menu-inv");e.innerHTML="";let a=!1;Object.entries(o.save.inventory).forEach(([s,t])=>{if(!t)return;a=!0;const n=X[s];if(!n)return;const i=document.createElement("div");if(i.className="inv-row",i.innerHTML=`<span class="inv-icon">${n.icon}</span>
      <div class="inv-info">
        <div class="inv-name">${n.name} ×${t}</div>
        <div class="inv-desc">${n.desc}</div>
        ${n.passive?`<div class="inv-passive">◉ ${n.passive}</div>`:""}
      </div>`,n.use&&!n.questItem){const r=document.createElement("button");r.className="btn-use",r.textContent="Use",r.onclick=()=>{const A=n.use(o.party);A&&(o.save.inventory[s]=Math.max(0,t-1),z(A),x(),Ke())},i.appendChild(r)}e.appendChild(i)}),a||(e.innerHTML='<div class="inv-empty">Your bag is empty.</div>'),document.getElementById("menu-gold").textContent=`◆ ${o.save.gold} Gold`}function Gt(){const e=document.getElementById("menu-journal");if(e.innerHTML="",!o.save.journal.length){e.innerHTML='<div class="journal-empty">No entries yet. Your story is just beginning.</div>';return}o.save.journal.forEach(a=>{const s=document.createElement("div");s.className="journal-entry",s.textContent=a,e.appendChild(s)})}function Qt(){const e=document.getElementById("menu-party");e.innerHTML="",o.party.forEach(a=>{const s=document.createElement("div");s.className="party-card";const t=o.battleSprites[a.id];let n="";if(t){const i=document.createElement("canvas");i.width=40,i.height=40;const r=i.getContext("2d");r.imageSmoothingEnabled=!1,r.drawImage(t,0,0,40,40),n=i.outerHTML}s.innerHTML=`${n}
      <div class="pc-info">
        <div class="pc-name">${a.name} <span class="pc-type">${a.type}</span></div>
        <div class="pc-level">Lv${a.lv} · ${a.px}px · ${a.expression}</div>
        <div class="pc-acc">${a.accessory!=="No Accessories"?a.accessory:"No Accessory"}</div>
        <div class="pc-stats">HP ${a.hp}/${a.maxHp} · MP ${a.mp}/${a.maxMp} · DEF ${a.def} · SPD ${a.spd} · CRIT ${Math.round(a.crit*100)}%</div>
        <div class="pc-moves">${a.sk1} (${a.atkSkill}dmg) · ${a.sk2} (${a.atkUltimate}dmg)</div>
      </div>`,e.appendChild(s)})}function Yt(){const e=document.getElementById("menu-quests");e.innerHTML="";const a=o.save.activeQuests,s=o.save.completedQuests;if(a.length){const t=document.createElement("div");t.className="q-section-title",t.textContent="ACTIVE QUESTS",e.appendChild(t),a.forEach(n=>{const i=o.save.quests[n],r=M[n];if(!i||!r)return;const A=document.createElement("div");A.className="q-entry active",A.innerHTML=`<div class="q-name">${r.name}</div>
        <div class="q-desc">${r.desc}</div>
        <div class="q-lore">${r.lore}</div>
        <div class="q-steps">${i.steps.map(h=>`${h.done?"■":"□"} ${h.text}`).join("<br>")}</div>`,e.appendChild(A)})}if(s.length){const t=document.createElement("div");t.className="q-section-title",t.textContent="COMPLETED",e.appendChild(t),s.forEach(n=>{const i=M[n];if(!i)return;const r=document.createElement("div");r.className="q-entry done",r.innerHTML=`<div class="q-name">■ ${i.name}</div>`,e.appendChild(r)})}!a.length&&!s.length&&(e.innerHTML='<div class="q-empty">No quests yet.</div>')}function Ft(e){if(!y||!o.mapData)return;rt(e);const{tiles:a,w:s,h:t}=o.mapData,n=Math.max(0,Math.min(o.px*C+C/2-R/2,s*C-R)),i=Math.max(0,Math.min(o.py*C+C/2-H/2,t*C-H));o.camX+=(n-o.camX)*.16,o.camY+=(i-o.camY)*.16;const r=Math.round(o.camX),A=Math.round(o.camY);y.fillStyle="#e3e5e4",y.fillRect(0,0,R,H),y.imageSmoothingEnabled=!1;const h=Math.max(0,Math.floor(r/C)-1),p=Math.max(0,Math.floor(A/C)-1),c=Math.ceil(R/C)+3,u=Math.ceil(H/C)+3;for(let b=p;b<Math.min(p+u,t);b++)for(let v=h;v<Math.min(h+c,s);v++){const I=lt(a[b][v]),L=v*C-r,O=b*C-A;if(I)y.drawImage(I,L,O,C,C);else{const B=a[b][v];y.fillStyle=B===l.VOID?"#32333a":B===l.DARK_GRASS?"#6a6b6a":"#c8c9c8",y.fillRect(L,O,C,C)}}se.filter(b=>b.mapId===o.mapId).forEach(b=>{const v=b.x*C-r,I=b.y*C-A;if(v<-32||I<-40||v>R+32||I>H+40)return;const L=o.npcSprites[b.id];if(L){y.imageSmoothingEnabled=!1;const O=Math.sin(Date.now()*.003+b.id.charCodeAt(0)*.7)*1.5;y.drawImage(L,v,I+O-4,L.width,L.height),y.font="bold 7px monospace",y.textAlign="center",y.textBaseline="bottom",y.fillStyle="rgba(0,0,0,0.65)";const B=y.measureText(b.name).width+6;y.fillRect(v+C/2-B/2-1,I-15,B+2,11),y.fillStyle="#e3e5e4",y.fillText(b.name,v+C/2,I-4)}else y.fillStyle="#48494b",y.fillRect(v+4,I+2,8,10)});const g=o.px*C-r,w=o.py*C-A;if(o.playerSprite){y.imageSmoothingEnabled=!1;const b=o.playerSprite;y.fillStyle="rgba(0,0,0,0.2)",y.beginPath(),y.ellipse(g+C/2,w+C-1,6,2,0,0,Math.PI*2),y.fill(),y.drawImage(b.canvas,g+C/2-b.width/2,w+C-b.height)}else y.fillStyle="#48494b",y.fillRect(g+4,w,8,12),y.fillStyle="#e3e5e4",y.fillRect(g+5,w+2,2,2),y.fillRect(g+8,w+2,2,2);Ut(),o.fadeAlpha>0&&(y.fillStyle=`rgba(0,0,0,${o.fadeAlpha})`,y.fillRect(0,0,R,H)),Kt(),$t()}function Ut(){const e=o.mapId;let a="rgba(0,0,0,0.06)";e==="cave"&&(a="rgba(0,0,0,0.35)"),e==="void_lands"&&(a="rgba(0,0,0,0.45)"),e==="citadel"&&(a="rgba(0,0,0,0.50)");const s=y.createRadialGradient(R/2,H/2,H*.3,R/2,H/2,H*.8);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,a),y.fillStyle=s,y.fillRect(0,0,R,H)}function Kt(){let e=60;o.questNotif&&(o.questNotif.timer--,o.questNotif.timer>0?Oe(o.questNotif.text,e,o.questNotif.timer):o.questNotif=null,e+=28),o.itemNotif&&(o.itemNotif.timer--,o.itemNotif.timer>0?Oe(o.itemNotif.text,e,o.itemNotif.timer):o.itemNotif=null)}function Oe(e,a,s){const t=Math.min(1,s/30),n=y.measureText(e).width+24;y.font="bold 11px monospace";const i=R/2-n/2;y.fillStyle=`rgba(72,73,75,${t*.9})`,y.fillRect(i,a,n,20),y.fillStyle=`rgba(227,229,228,${t})`,y.textAlign="center",y.textBaseline="middle",y.fillText(e,R/2,a+10)}function $t(){if(!o.save.activeQuests.length)return;const e=o.save.activeQuests[0],a=o.save.quests[e],s=M[e];if(!a||!s)return;const t=a.steps.find(r=>!r.done);if(!t)return;y.font="9px monospace",y.textAlign="right",y.textBaseline="top";const n=`◉ ${t.text}`,i=y.measureText(n).width+12;y.fillStyle="rgba(72,73,75,0.75)",y.fillRect(R-i-6,6,i+6,18),y.fillStyle="#e3e5e4",y.fillText(n,R-8,11)}function x(){var t;document.getElementById("zone-name").textContent=((t=U[o.mapId])==null?void 0:t.name)||o.mapId,document.getElementById("step-count").textContent=o.save.steps+" steps",document.getElementById("hud-gold").textContent=o.save.gold,document.getElementById("hud-pot").textContent="⬜×"+(o.save.inventory.potion||0);const e=o.party[0];if(!e)return;const a=Math.max(0,e.hp/e.maxHp*100),s=Math.max(0,e.mp/e.maxMp*100);document.getElementById("hud-lead-name").textContent=e.name,document.getElementById("hud-lead-type").textContent=e.type+" #"+e.id,document.getElementById("hud-hp-bar").style.width=a+"%",document.getElementById("hud-mp-bar").style.width=s+"%",document.getElementById("hud-hp-val").textContent=e.hp+"/"+e.maxHp}function qt(){var e;Q("ending"),document.getElementById("ending-normie-id").textContent="#"+(((e=o.party[0])==null?void 0:e.id)||"0001"),document.getElementById("ending-battles").textContent=o.save.battlesWon,document.getElementById("ending-steps").textContent=o.save.steps,document.getElementById("ending-gold").textContent=o.save.gold}function Jt(){const e=document.getElementById("logo-canvas");if(!e)return;const a=320,s=107;e.width=a,e.height=s;const t=e.getContext("2d");t.imageSmoothingEnabled=!1,t.fillStyle="#e3e5e4",t.fillRect(0,0,a,s),t.fillStyle="#48494b";const n={T:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0]],H:[[1,0,1],[1,0,1],[1,1,1],[1,0,1],[1,0,1]],E:[[1,1,1],[1,0,0],[1,1,0],[1,0,0],[1,1,1]]};"THE".split("").forEach((g,w)=>{(n[g]||n.T).forEach((v,I)=>v.forEach((L,O)=>{L&&t.fillRect(14+w*14+O*2,8+I*2,2,2)}))}),t.fillRect(14,22,32,1);const i={P:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0]],I:[[1,1,1],[0,1,0],[0,1,0],[0,1,0],[1,1,1]],X:[[1,0,0,1],[1,0,0,1],[0,1,1,0],[1,0,0,1],[1,0,0,1]],E:[[1,1,1,0],[1,0,0,0],[1,1,1,0],[1,0,0,0],[1,1,1,0]],L:[[1,0,0],[1,0,0],[1,0,0],[1,0,0],[1,1,1]],W:[[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,0,0,0,1]],A:[[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1]],R:[[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,1,0,0],[1,0,1,0]]},r=5,h=[["P","I","X","E","L"],["W","A","R"]].map(g=>g.reduce((w,b)=>{var v,I;return w+(((I=(v=i[b])==null?void 0:v[0])==null?void 0:I.length)||3)+1},0)-1),p=h[0]*r+16+h[1]*r;let u=Math.floor((a-p)/2);"PIXEL".split("").forEach(g=>{const w=i[g];if(!w){u+=4*r;return}w.forEach((b,v)=>b.forEach((I,L)=>{I&&t.fillRect(u+L*r,30+v*r,r,r)})),u+=(w[0].length+1)*r}),u+=16,"WAR".split("").forEach(g=>{const w=i[g];if(!w){u+=4*r;return}w.forEach((b,v)=>b.forEach((I,L)=>{I&&t.fillRect(u+L*r,30+v*r,r,r)})),u+=(w[0].length+1)*r}),t.font="bold 10px monospace",t.textAlign="center",t.fillStyle="#8a8b8a",t.fillText("A  N O R M I E S  A D V E N T U R E",a/2,97)}function He(){const e=dt.intro;let a=0;Q("intro");const s=document.getElementById("intro-text"),t=document.getElementById("intro-page");function n(){s.textContent=e[a],t.textContent=`${a+1} / ${e.length}`}n(),document.getElementById("btn-intro-next").onclick=()=>{a++,a>=e.length?(Q("party"),te(),G()):n()},document.getElementById("btn-intro-skip").onclick=()=>{Q("party"),te(),G()}}function G(){const e=document.getElementById("normie-grid");if(document.getElementById("col-count").textContent=o.collection.length?`(${o.collection.length})`:"",!o.collection.length){e.innerHTML='<div class="grid-loading">Loading Normies…</div>';return}e.innerHTML="",o.collection.forEach(a=>{const s=o.party.some(i=>i.id===a.id),t=document.createElement("div");t.className="ncard"+(s?" selected":"");const n=o.battleSprites[a.id];if(n){const i=document.createElement("canvas");i.width=40,i.height=40;const r=i.getContext("2d");r.imageSmoothingEnabled=!1,r.drawImage(n,0,0,40,40),t.appendChild(i)}else{const i=document.createElement("div");i.style.cssText="width:40px;height:40px;background:#ccc;display:flex;align-items:center;justify-content:center;font-size:9px;color:#666",i.textContent="#"+a.id,t.appendChild(i)}t.innerHTML+=`<div class="ncard-id">#${a.id}</div>
      <div class="ncard-type">${a.type}</div>
      <div class="ncard-stat">HP ${a.maxHp} SPD ${a.spd}</div>
      <div class="ncard-expr">${a.expression}</div>`,s||(t.onclick=()=>{o.party.length>=5||(o.party.push({...a}),te(),G())}),e.appendChild(t)})}function te(){const e=document.getElementById("party-slots");e.innerHTML="",document.getElementById("party-count").textContent=`${o.party.length} / 5`,document.getElementById("btn-start").disabled=o.party.length===0;for(let a=0;a<5;a++){const s=o.party[a],t=document.createElement("div");if(t.className="pslot "+(s?"filled":"empty"),s){const n=o.battleSprites[s.id];if(n){const i=document.createElement("canvas");i.width=32,i.height=32;const r=i.getContext("2d");r.imageSmoothingEnabled=!1,r.drawImage(n,0,0,32,32),t.appendChild(i)}t.innerHTML+=`<div class="pslot-name">#${s.id}</div><div class="pslot-type">${s.type}</div>`,t.onclick=()=>{o.party.splice(a,1),te(),G()}}else t.innerHTML=`<div class="pslot-empty">${a+1}</div>`;e.appendChild(t)}}function $e(e=0){var s;const a=Math.min(e-Se,50);Se=e,o.screen==="game"&&(Bt(a),!o.battle&&!o.menu&&!o.dlg&&Tt(a),kt(),Vt(),o.battle&&(o.battle.enemy.flashTimer>0&&o.battle.enemy.flashTimer--,(s=o.battle.fighters)==null||s.forEach(t=>{t.flashTimer>0&&t.flashTimer--})),Ft(a)),_=requestAnimationFrame($e)}function Q(e){document.querySelectorAll(".screen").forEach(a=>a.classList.remove("active")),document.getElementById("screen-"+e).classList.add("active"),o.screen=e}window.addEventListener("DOMContentLoaded",async()=>{Jt(),It(),Lt(),Ct(),ye("prologue");function e(){const n=document.getElementById("btn-connect"),i=fe();i.length===0?(n.textContent="No Wallet Found",n.title="Install MetaMask, Coinbase Wallet, or another Web3 wallet"):n.textContent=`⬜ Connect ${i[0].name}`}e(),setTimeout(e,800),document.getElementById("btn-connect").onclick=async()=>{document.getElementById("btn-connect");const n=fe();if(n.length===0){s();return}n.length>1?t(n,async i=>{await a(i)}):await a(n[0].id)};async function a(n){const i=document.getElementById("btn-connect");i.disabled=!0,i.textContent="Connecting…";try{const{provider:r,address:A,walletName:h}=await et(n);o.demo=!1,document.getElementById("wallet-addr").textContent=`${h}: ${A.slice(0,6)}…${A.slice(-4)}`,i.textContent="Loading NFTs…",o.collection=await tt(A,r,p=>{o.collection=p,p.forEach(oe),G()}),o.collection.forEach(oe),o.collection.length===0?(i.textContent="No Normies Found",i.disabled=!1,document.getElementById("wallet-addr").textContent+=" · No Normies found — try Demo Mode"):He()}catch(r){i.disabled=!1,e(),r.message==="NO_WALLET"?s():r.code===4001?i.textContent="Rejected — try again":(i.textContent="Failed — retry",console.error(r))}}function s(){const n=document.getElementById("wallet-help");n&&(n.style.display="block")}function t(n,i){const r=document.createElement("div");r.className="wallet-picker-overlay",r.innerHTML=`<div class="wallet-picker">
      <div class="wp-title">Choose Wallet</div>
      ${n.map(A=>`<button class="wp-btn btn-ghost" data-id="${A.id}">${A.name}</button>`).join("")}
      <button class="wp-cancel btn-back">Cancel</button>
    </div>`,document.body.appendChild(r),r.querySelectorAll(".wp-btn").forEach(A=>{A.onclick=()=>{r.remove(),i(A.dataset.id)}}),r.querySelector(".wp-cancel").onclick=()=>r.remove(),r.onclick=A=>{A.target===r&&r.remove()}}document.getElementById("btn-demo").onclick=async()=>{o.demo=!0,o.collection=[],document.getElementById("demo-pill").classList.add("show"),o.collection=await ot(n=>{o.collection=n,n.forEach(oe),G()}),o.collection.forEach(oe),He()},document.getElementById("btn-start").onclick=()=>{o.party.length&&jt()},document.getElementById("btn-atk").onclick=()=>window.__battleAction("attack"),document.getElementById("btn-skill").onclick=()=>window.__battleAction("skill"),document.getElementById("btn-ult").onclick=()=>window.__battleAction("ult"),document.getElementById("btn-bpot").onclick=()=>window.__battleAction("potion"),document.getElementById("btn-bat-world").onclick=()=>{o.battle&&(o.battle=null,document.getElementById("battle").classList.add("hidden"),x())},document.getElementById("btn-bat-party").onclick=()=>{o.battle=null,document.getElementById("battle").classList.add("hidden"),o.party.forEach(n=>{n.hp=n.maxHp,n.mp=n.maxMp,n.alive=!0}),_&&(cancelAnimationFrame(_),_=null),o.screen="party",Q("party"),te(),G()},document.querySelectorAll(".menu-tab").forEach(n=>{n.onclick=()=>{Ue(n.dataset.tab),document.querySelectorAll(".menu-tab").forEach(i=>i.classList.toggle("active",i===n))}}),document.getElementById("btn-close-menu").onclick=Ee,document.getElementById("btn-close-shop").onclick=()=>document.getElementById("shop").classList.add("hidden"),document.getElementById("dialogue").addEventListener("click",Pe),document.getElementById("btn-back-title").onclick=()=>{_&&(cancelAnimationFrame(_),_=null),o.screen="title",Q("title")},document.getElementById("btn-ending-play-again").onclick=()=>{document.getElementById("screen-ending").classList.remove("active"),location.reload()}});function oe(e){o.battleSprites[e.id]||(o.battleSprites[e.id]=We(e.pixels))}function jt(){o.save.gold=0,o.save.steps=0,o.save.battlesWon=0,o.save.inventory={potion:3},o.save.journal=["Chapter 1: The First Render — Your story begins."],o.party.forEach(a=>{a.hp=a.maxHp,a.mp=a.maxMp,a.alive=!0});const e=o.party[0];o.playerSprite=St(e==null?void 0:e.pixels,e==null?void 0:e.px),Ve("home"),o.camX=o.px*C,o.camY=o.py*C,Q("game"),document.getElementById("screen-game").style.display="block",o.screen="game",x(),setTimeout(()=>{const a=se.find(s=>s.id==="mom");a&&ee(a.name,a.lines,o.npcSprites.mom)},800),_&&cancelAnimationFrame(_),_=requestAnimationFrame($e)}
